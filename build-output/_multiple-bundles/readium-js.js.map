{
  "version": 3,
  "file": "readium-js.js",
  "sources": [
    "text.js",
    "version.json!text",
    "cfi_parser_gen.js",
    "cfi_parser.js",
    "cfi_runtime_errors.js",
    "cfi_instructions.js",
    "cfi_interpreter.js",
    "cfi_generator.js",
    "cfi_API.js",
    "readium-cfi-js.js",
    "epubCfi.js",
    "../../js/epub-fetch/markup_parser.js",
    "../../js/epub-fetch/discover_content_type.js",
    "../../js/epub-fetch/plain_resource_fetcher.js",
    "zip.js",
    "mime-types.js",
    "zip-fs.js",
    "zip-ext.js",
    "../../js/epub-fetch/zip_resource_fetcher.js",
    "../../js/epub-fetch/content_document_fetcher.js",
    "../../js/epub-fetch/resource_cache.js",
    "../../node_modules/crypto-js/core.js",
    "../../node_modules/crypto-js/sha1.js",
    "../../js/epub-fetch/encryption_handler.js",
    "../../js/epub-fetch/publication_fetcher.js",
    "../../js/epub-model/package_document.js",
    "../../js/epub-model/smil_document_parser.js",
    "../../js/epub-model/metadata.js",
    "../../js/epub-model/manifest.js",
    "../../js/epub-model/package_document_parser.js",
    "../../js/epub-fetch/iframe_zip_loader.js",
    "Readium.js",
    "readium-js.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvYA;AACA;AACA;ACFA,ADGA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACx6CA,ADy6CA;ACx6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpHA,ADqHA;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtbA,ADubA;ACtbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjeA,ADkeA;ACjeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA,ADiBA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA,ADiBA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA,ADkCA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACj8BA,ADk8BA;ACj8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACl/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpiBA,ADqiBA;ACpiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzPA,AD0PA;ACzPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtHA,ADuHA;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC1LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC3uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrJA,ADsJA;ACrJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACvSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxPA,ADyPA;ACxPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5DA,AD6DA;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzeA,AD0eA;ACzeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "sourcesContent": [
    "/**\n * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.\n * Available via the MIT or new BSD license.\n * see: http://github.com/requirejs/text for details\n */\n/*jslint regexp: true */\n/*global require, XMLHttpRequest, ActiveXObject,\n  define, window, process, Packages,\n  java, location, Components, FileUtils */\n\ndefine('text',['module'], function (module) {\n    'use strict';\n\n    var text, fs, Cc, Ci, xpcIsWindows,\n        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],\n        xmlRegExp = /^\\s*<\\?xml(\\s)+version=[\\'\\\"](\\d)*.(\\d)*[\\'\\\"](\\s)*\\?>/im,\n        bodyRegExp = /<body[^>]*>\\s*([\\s\\S]+)\\s*<\\/body>/im,\n        hasLocation = typeof location !== 'undefined' && location.href,\n        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\\:/, ''),\n        defaultHostName = hasLocation && location.hostname,\n        defaultPort = hasLocation && (location.port || undefined),\n        buildMap = {},\n        masterConfig = (module.config && module.config()) || {};\n\n    text = {\n        version: '2.0.12',\n\n        strip: function (content) {\n            //Strips <?xml ...?> declarations so that external SVG and XML\n            //documents can be added to a document without worry. Also, if the string\n            //is an HTML document, only the part inside the body tag is returned.\n            if (content) {\n                content = content.replace(xmlRegExp, \"\");\n                var matches = content.match(bodyRegExp);\n                if (matches) {\n                    content = matches[1];\n                }\n            } else {\n                content = \"\";\n            }\n            return content;\n        },\n\n        jsEscape: function (content) {\n            return content.replace(/(['\\\\])/g, '\\\\$1')\n                .replace(/[\\f]/g, \"\\\\f\")\n                .replace(/[\\b]/g, \"\\\\b\")\n                .replace(/[\\n]/g, \"\\\\n\")\n                .replace(/[\\t]/g, \"\\\\t\")\n                .replace(/[\\r]/g, \"\\\\r\")\n                .replace(/[\\u2028]/g, \"\\\\u2028\")\n                .replace(/[\\u2029]/g, \"\\\\u2029\");\n        },\n\n        createXhr: masterConfig.createXhr || function () {\n            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.\n            var xhr, i, progId;\n            if (typeof XMLHttpRequest !== \"undefined\") {\n                return new XMLHttpRequest();\n            } else if (typeof ActiveXObject !== \"undefined\") {\n                for (i = 0; i < 3; i += 1) {\n                    progId = progIds[i];\n                    try {\n                        xhr = new ActiveXObject(progId);\n                    } catch (e) {}\n\n                    if (xhr) {\n                        progIds = [progId];  // so faster next time\n                        break;\n                    }\n                }\n            }\n\n            return xhr;\n        },\n\n        /**\n         * Parses a resource name into its component parts. Resource names\n         * look like: module/name.ext!strip, where the !strip part is\n         * optional.\n         * @param {String} name the resource name\n         * @returns {Object} with properties \"moduleName\", \"ext\" and \"strip\"\n         * where strip is a boolean.\n         */\n        parseName: function (name) {\n            var modName, ext, temp,\n                strip = false,\n                index = name.indexOf(\".\"),\n                isRelative = name.indexOf('./') === 0 ||\n                             name.indexOf('../') === 0;\n\n            if (index !== -1 && (!isRelative || index > 1)) {\n                modName = name.substring(0, index);\n                ext = name.substring(index + 1, name.length);\n            } else {\n                modName = name;\n            }\n\n            temp = ext || modName;\n            index = temp.indexOf(\"!\");\n            if (index !== -1) {\n                //Pull off the strip arg.\n                strip = temp.substring(index + 1) === \"strip\";\n                temp = temp.substring(0, index);\n                if (ext) {\n                    ext = temp;\n                } else {\n                    modName = temp;\n                }\n            }\n\n            return {\n                moduleName: modName,\n                ext: ext,\n                strip: strip\n            };\n        },\n\n        xdRegExp: /^((\\w+)\\:)?\\/\\/([^\\/\\\\]+)/,\n\n        /**\n         * Is an URL on another domain. Only works for browser use, returns\n         * false in non-browser environments. Only used to know if an\n         * optimized .js version of a text resource should be loaded\n         * instead.\n         * @param {String} url\n         * @returns Boolean\n         */\n        useXhr: function (url, protocol, hostname, port) {\n            var uProtocol, uHostName, uPort,\n                match = text.xdRegExp.exec(url);\n            if (!match) {\n                return true;\n            }\n            uProtocol = match[2];\n            uHostName = match[3];\n\n            uHostName = uHostName.split(':');\n            uPort = uHostName[1];\n            uHostName = uHostName[0];\n\n            return (!uProtocol || uProtocol === protocol) &&\n                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&\n                   ((!uPort && !uHostName) || uPort === port);\n        },\n\n        finishLoad: function (name, strip, content, onLoad) {\n            content = strip ? text.strip(content) : content;\n            if (masterConfig.isBuild) {\n                buildMap[name] = content;\n            }\n            onLoad(content);\n        },\n\n        load: function (name, req, onLoad, config) {\n            //Name has format: some.module.filext!strip\n            //The strip part is optional.\n            //if strip is present, then that means only get the string contents\n            //inside a body tag in an HTML string. For XML/SVG content it means\n            //removing the <?xml ...?> declarations so the content can be inserted\n            //into the current doc without problems.\n\n            // Do not bother with the work if a build and text will\n            // not be inlined.\n            if (config && config.isBuild && !config.inlineText) {\n                onLoad();\n                return;\n            }\n\n            masterConfig.isBuild = config && config.isBuild;\n\n            var parsed = text.parseName(name),\n                nonStripName = parsed.moduleName +\n                    (parsed.ext ? '.' + parsed.ext : ''),\n                url = req.toUrl(nonStripName),\n                useXhr = (masterConfig.useXhr) ||\n                         text.useXhr;\n\n            // Do not load if it is an empty: url\n            if (url.indexOf('empty:') === 0) {\n                onLoad();\n                return;\n            }\n\n            //Load the text. Use XHR if possible and in a browser.\n            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {\n                text.get(url, function (content) {\n                    text.finishLoad(name, parsed.strip, content, onLoad);\n                }, function (err) {\n                    if (onLoad.error) {\n                        onLoad.error(err);\n                    }\n                });\n            } else {\n                //Need to fetch the resource across domains. Assume\n                //the resource has been optimized into a JS module. Fetch\n                //by the module name + extension, but do not include the\n                //!strip part to avoid file system issues.\n                req([nonStripName], function (content) {\n                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,\n                                    parsed.strip, content, onLoad);\n                });\n            }\n        },\n\n        write: function (pluginName, moduleName, write, config) {\n            if (buildMap.hasOwnProperty(moduleName)) {\n                var content = text.jsEscape(buildMap[moduleName]);\n                write.asModule(pluginName + \"!\" + moduleName,\n                               \"define(function () { return '\" +\n                                   content +\n                               \"';});\\n\");\n            }\n        },\n\n        writeFile: function (pluginName, moduleName, req, write, config) {\n            var parsed = text.parseName(moduleName),\n                extPart = parsed.ext ? '.' + parsed.ext : '',\n                nonStripName = parsed.moduleName + extPart,\n                //Use a '.js' file name so that it indicates it is a\n                //script that can be loaded across domains.\n                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';\n\n            //Leverage own load() method to load plugin value, but only\n            //write out values that do not have the strip argument,\n            //to avoid any potential issues with ! in file names.\n            text.load(nonStripName, req, function (value) {\n                //Use own write() method to construct full module value.\n                //But need to create shell that translates writeFile's\n                //write() to the right interface.\n                var textWrite = function (contents) {\n                    return write(fileName, contents);\n                };\n                textWrite.asModule = function (moduleName, contents) {\n                    return write.asModule(moduleName, fileName, contents);\n                };\n\n                text.write(pluginName, nonStripName, textWrite, config);\n            }, config);\n        }\n    };\n\n    if (masterConfig.env === 'node' || (!masterConfig.env &&\n            typeof process !== \"undefined\" &&\n            process.versions &&\n            !!process.versions.node &&\n            !process.versions['node-webkit'])) {\n        //Using special require.nodeRequire, something added by r.js.\n        fs = require.nodeRequire('fs');\n\n        text.get = function (url, callback, errback) {\n            try {\n                var file = fs.readFileSync(url, 'utf8');\n                //Remove BOM (Byte Mark Order) from utf8 files if it is there.\n                if (file.indexOf('\\uFEFF') === 0) {\n                    file = file.substring(1);\n                }\n                callback(file);\n            } catch (e) {\n                if (errback) {\n                    errback(e);\n                }\n            }\n        };\n    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&\n            text.createXhr())) {\n        text.get = function (url, callback, errback, headers) {\n            var xhr = text.createXhr(), header;\n            xhr.open('GET', url, true);\n\n            //Allow plugins direct access to xhr headers\n            if (headers) {\n                for (header in headers) {\n                    if (headers.hasOwnProperty(header)) {\n                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);\n                    }\n                }\n            }\n\n            //Allow overrides specified in config\n            if (masterConfig.onXhr) {\n                masterConfig.onXhr(xhr, url);\n            }\n\n            xhr.onreadystatechange = function (evt) {\n                var status, err;\n                //Do not explicitly handle errors, those should be\n                //visible via console output in the browser.\n                if (xhr.readyState === 4) {\n                    status = xhr.status || 0;\n                    if (status > 399 && status < 600) {\n                        //An http 4xx or 5xx error. Signal an error.\n                        err = new Error(url + ' HTTP status: ' + status);\n                        err.xhr = xhr;\n                        if (errback) {\n                            errback(err);\n                        }\n                    } else {\n                        callback(xhr.responseText);\n                    }\n\n                    if (masterConfig.onXhrComplete) {\n                        masterConfig.onXhrComplete(xhr, url);\n                    }\n                }\n            };\n            xhr.send(null);\n        };\n    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&\n            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {\n        //Why Java, why is this so awkward?\n        text.get = function (url, callback) {\n            var stringBuffer, line,\n                encoding = \"utf-8\",\n                file = new java.io.File(url),\n                lineSeparator = java.lang.System.getProperty(\"line.separator\"),\n                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),\n                content = '';\n            try {\n                stringBuffer = new java.lang.StringBuffer();\n                line = input.readLine();\n\n                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324\n                // http://www.unicode.org/faq/utf_bom.html\n\n                // Note that when we use utf-8, the BOM should appear as \"EF BB BF\", but it doesn't due to this bug in the JDK:\n                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058\n                if (line && line.length() && line.charAt(0) === 0xfeff) {\n                    // Eat the BOM, since we've already found the encoding on this file,\n                    // and we plan to concatenating this buffer with others; the BOM should\n                    // only appear at the top of a file.\n                    line = line.substring(1);\n                }\n\n                if (line !== null) {\n                    stringBuffer.append(line);\n                }\n\n                while ((line = input.readLine()) !== null) {\n                    stringBuffer.append(lineSeparator);\n                    stringBuffer.append(line);\n                }\n                //Make sure we return a JavaScript string and not a Java string.\n                content = String(stringBuffer.toString()); //String\n            } finally {\n                input.close();\n            }\n            callback(content);\n        };\n    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&\n            typeof Components !== 'undefined' && Components.classes &&\n            Components.interfaces)) {\n        //Avert your gaze!\n        Cc = Components.classes;\n        Ci = Components.interfaces;\n        Components.utils['import']('resource://gre/modules/FileUtils.jsm');\n        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);\n\n        text.get = function (url, callback) {\n            var inStream, convertStream, fileObj,\n                readData = {};\n\n            if (xpcIsWindows) {\n                url = url.replace(/\\//g, '\\\\');\n            }\n\n            fileObj = new FileUtils.File(url);\n\n            //XPCOM, you so crazy\n            try {\n                inStream = Cc['@mozilla.org/network/file-input-stream;1']\n                           .createInstance(Ci.nsIFileInputStream);\n                inStream.init(fileObj, 1, 0, false);\n\n                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']\n                                .createInstance(Ci.nsIConverterInputStream);\n                convertStream.init(inStream, \"utf-8\", inStream.available(),\n                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);\n\n                convertStream.readString(inStream.available(), readData);\n                convertStream.close();\n                inStream.close();\n                callback(readData.value);\n            } catch (e) {\n                throw new Error((fileObj && fileObj.path || '') + ': ' + e);\n            }\n        };\n    }\n    return text;\n});\n\n",
    "\ndefine('text!version.json',[],function () { return '{\"readiumJs\":{\"sha\":\"241cbc376bdb28b7179348cbd5519d664deeb9ed\",\"tag\":\"0.15-114-g241cbc3\",\"clean\":false},\"readiumSharedJs\":{\"sha\":\"c754becf1f4c5e7fc6342be625ddeb8255607003\",\"tag\":\"0.16-107-gc754bec\",\"clean\":false}}';});\n\n",
    "EPUBcfiParser = (function() {\n  /*\n   * Generated by PEG.js 0.8.0.\n   *\n   * http://pegjs.majda.cz/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function SyntaxError(message, expected, found, offset, line, column) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.offset   = offset;\n    this.line     = line;\n    this.column   = column;\n\n    this.name     = \"SyntaxError\";\n  }\n\n  peg$subclass(SyntaxError, Error);\n\n  function parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n\n        peg$FAILED = {},\n\n        peg$startRuleFunctions = { fragment: peg$parsefragment },\n        peg$startRuleFunction  = peg$parsefragment,\n\n        peg$c0 = peg$FAILED,\n        peg$c1 = \"epubcfi(\",\n        peg$c2 = { type: \"literal\", value: \"epubcfi(\", description: \"\\\"epubcfi(\\\"\" },\n        peg$c3 = \")\",\n        peg$c4 = { type: \"literal\", value: \")\", description: \"\\\")\\\"\" },\n        peg$c5 = function(fragmentVal) { \r\n                \r\n                return { type:\"CFIAST\", cfiString:fragmentVal };\r\n            },\n        peg$c6 = \",\",\n        peg$c7 = { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n        peg$c8 = function(stepVal, localPathVal, rangeLocalPath1Val, rangeLocalPath2Val) {\r\n\r\n                return { type:\"range\", path:stepVal, localPath:localPathVal, range1:rangeLocalPath1Val, range2:rangeLocalPath2Val };\r\n          },\n        peg$c9 = function(stepVal, localPathVal) { \r\n\r\n                return { type:\"path\", path:stepVal, localPath:localPathVal }; \r\n            },\n        peg$c10 = [],\n        peg$c11 = null,\n        peg$c12 = function(localPathStepVal, termStepVal) { \r\n\r\n                return { steps:localPathStepVal, termStep:termStepVal?termStepVal:\"\" }; \r\n            },\n        peg$c13 = \"/\",\n        peg$c14 = { type: \"literal\", value: \"/\", description: \"\\\"/\\\"\" },\n        peg$c15 = \"[\",\n        peg$c16 = { type: \"literal\", value: \"[\", description: \"\\\"[\\\"\" },\n        peg$c17 = \"]\",\n        peg$c18 = { type: \"literal\", value: \"]\", description: \"\\\"]\\\"\" },\n        peg$c19 = function(stepLengthVal, assertVal) { \r\n\r\n                return { type:\"indexStep\", stepLength:stepLengthVal, idAssertion:assertVal?assertVal[1]:undefined };\r\n            },\n        peg$c20 = \"!/\",\n        peg$c21 = { type: \"literal\", value: \"!/\", description: \"\\\"!/\\\"\" },\n        peg$c22 = function(stepLengthVal, assertVal) { \r\n\r\n                return { type:\"indirectionStep\", stepLength:stepLengthVal, idAssertion:assertVal?assertVal[1]:undefined };\r\n            },\n        peg$c23 = \":\",\n        peg$c24 = { type: \"literal\", value: \":\", description: \"\\\":\\\"\" },\n        peg$c25 = function(textOffsetValue, textLocAssertVal) { \r\n\r\n                return { type:\"textTerminus\", offsetValue:textOffsetValue, textAssertion: textLocAssertVal?textLocAssertVal[1]:undefined };\r\n            },\n        peg$c26 = function(idVal) { \r\n\r\n                return idVal; \r\n            },\n        peg$c27 = function(csvVal, paramVal) { \r\n\r\n                return { type:\"textLocationAssertion\", csv:csvVal?csvVal:\"\", parameter:paramVal?paramVal:\"\" }; \r\n            },\n        peg$c28 = \";\",\n        peg$c29 = { type: \"literal\", value: \";\", description: \"\\\";\\\"\" },\n        peg$c30 = \"=\",\n        peg$c31 = { type: \"literal\", value: \"=\", description: \"\\\"=\\\"\" },\n        peg$c32 = function(paramLHSVal, paramRHSVal) { \r\n\r\n                return { type:\"parameter\", LHSValue:paramLHSVal?paramLHSVal:\"\", RHSValue:paramRHSVal?paramRHSVal:\"\" }; \r\n            },\n        peg$c33 = function(preAssertionVal, postAssertionVal) { \r\n\r\n                return { type:\"csv\", preAssertion:preAssertionVal?preAssertionVal:\"\", postAssertion:postAssertionVal?postAssertionVal:\"\" }; \r\n            },\n        peg$c34 = function(stringVal) { \r\n\r\n                return stringVal.join(''); \r\n            },\n        peg$c35 = function(escSpecCharVal) { \r\n                \r\n                return escSpecCharVal[1]; \r\n            },\n        peg$c36 = /^[1-9]/,\n        peg$c37 = { type: \"class\", value: \"[1-9]\", description: \"[1-9]\" },\n        peg$c38 = /^[0-9]/,\n        peg$c39 = { type: \"class\", value: \"[0-9]\", description: \"[0-9]\" },\n        peg$c40 = \".\",\n        peg$c41 = { type: \"literal\", value: \".\", description: \"\\\".\\\"\" },\n        peg$c42 = function(intPartVal, fracPartVal) { \r\n\r\n                return intPartVal.join('') + \".\" + fracPartVal.join(''); \r\n            },\n        peg$c43 = \"0\",\n        peg$c44 = { type: \"literal\", value: \"0\", description: \"\\\"0\\\"\" },\n        peg$c45 = function(integerVal) { \r\n\r\n                if (integerVal === \"0\") { \r\n                  return \"0\";\r\n                } \r\n                else { \r\n                  return integerVal[0].concat(integerVal[1].join(''));\r\n                }\r\n            },\n        peg$c46 = \" \",\n        peg$c47 = { type: \"literal\", value: \" \", description: \"\\\" \\\"\" },\n        peg$c48 = function() { return \" \"; },\n        peg$c49 = \"^\",\n        peg$c50 = { type: \"literal\", value: \"^\", description: \"\\\"^\\\"\" },\n        peg$c51 = function() { return \"^\"; },\n        peg$c52 = \"\\\"\",\n        peg$c53 = { type: \"literal\", value: \"\\\"\", description: \"\\\"\\\\\\\"\\\"\" },\n        peg$c54 = function() { return '\"'; },\n        peg$c55 = function(bracketVal) { return bracketVal; },\n        peg$c56 = \"(\",\n        peg$c57 = { type: \"literal\", value: \"(\", description: \"\\\"(\\\"\" },\n        peg$c58 = function(paraVal) { return paraVal; },\n        peg$c59 = function() { return \",\"; },\n        peg$c60 = function() { return \";\"; },\n        peg$c61 = function() { return \"=\"; },\n        peg$c62 = /^[a-z]/,\n        peg$c63 = { type: \"class\", value: \"[a-z]\", description: \"[a-z]\" },\n        peg$c64 = /^[A-Z]/,\n        peg$c65 = { type: \"class\", value: \"[A-Z]\", description: \"[A-Z]\" },\n        peg$c66 = \"-\",\n        peg$c67 = { type: \"literal\", value: \"-\", description: \"\\\"-\\\"\" },\n        peg$c68 = \"_\",\n        peg$c69 = { type: \"literal\", value: \"_\", description: \"\\\"_\\\"\" },\n        peg$c70 = function(charVal) { return charVal; },\n\n        peg$currPos          = 0,\n        peg$reportedPos      = 0,\n        peg$cachedPos        = 0,\n        peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleFunctions)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$reportedPos, peg$currPos);\n    }\n\n    function offset() {\n      return peg$reportedPos;\n    }\n\n    function line() {\n      return peg$computePosDetails(peg$reportedPos).line;\n    }\n\n    function column() {\n      return peg$computePosDetails(peg$reportedPos).column;\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        peg$reportedPos\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(message, null, peg$reportedPos);\n    }\n\n    function peg$computePosDetails(pos) {\n      function advance(details, startPos, endPos) {\n        var p, ch;\n\n        for (p = startPos; p < endPos; p++) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n        }\n      }\n\n      if (peg$cachedPos !== pos) {\n        if (peg$cachedPos > pos) {\n          peg$cachedPos = 0;\n          peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n        }\n        advance(peg$cachedPosDetails, peg$cachedPos, pos);\n        peg$cachedPos = pos;\n      }\n\n      return peg$cachedPosDetails;\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, pos) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      var posDetails = peg$computePosDetails(pos),\n          found      = pos < input.length ? input.charAt(pos) : null;\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        pos,\n        posDetails.line,\n        posDetails.column\n      );\n    }\n\n    function peg$parsefragment() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 8) === peg$c1) {\n        s1 = peg$c1;\n        peg$currPos += 8;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c2); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parserange();\n        if (s2 === peg$FAILED) {\n          s2 = peg$parsepath();\n        }\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c3;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c5(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parserange() {\n      var s0, s1, s2, s3, s4, s5, s6;\n\n      s0 = peg$currPos;\n      s1 = peg$parseindexStep();\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parselocal_path();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s3 = peg$c6;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c7); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = peg$parselocal_path();\n            if (s4 !== peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 44) {\n                s5 = peg$c6;\n                peg$currPos++;\n              } else {\n                s5 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c7); }\n              }\n              if (s5 !== peg$FAILED) {\n                s6 = peg$parselocal_path();\n                if (s6 !== peg$FAILED) {\n                  peg$reportedPos = s0;\n                  s1 = peg$c8(s1, s2, s4, s6);\n                  s0 = s1;\n                } else {\n                  peg$currPos = s0;\n                  s0 = peg$c0;\n                }\n              } else {\n                peg$currPos = s0;\n                s0 = peg$c0;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c0;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parsepath() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = peg$parseindexStep();\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parselocal_path();\n        if (s2 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c9(s1, s2);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parselocal_path() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      s2 = peg$parseindexStep();\n      if (s2 === peg$FAILED) {\n        s2 = peg$parseindirectionStep();\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          s2 = peg$parseindexStep();\n          if (s2 === peg$FAILED) {\n            s2 = peg$parseindirectionStep();\n          }\n        }\n      } else {\n        s1 = peg$c0;\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseterminus();\n        if (s2 === peg$FAILED) {\n          s2 = peg$c11;\n        }\n        if (s2 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c12(s1, s2);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parseindexStep() {\n      var s0, s1, s2, s3, s4, s5, s6;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 47) {\n        s1 = peg$c13;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c14); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseinteger();\n        if (s2 !== peg$FAILED) {\n          s3 = peg$currPos;\n          if (input.charCodeAt(peg$currPos) === 91) {\n            s4 = peg$c15;\n            peg$currPos++;\n          } else {\n            s4 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c16); }\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = peg$parseidAssertion();\n            if (s5 !== peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 93) {\n                s6 = peg$c17;\n                peg$currPos++;\n              } else {\n                s6 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c18); }\n              }\n              if (s6 !== peg$FAILED) {\n                s4 = [s4, s5, s6];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$c0;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$c0;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$c0;\n          }\n          if (s3 === peg$FAILED) {\n            s3 = peg$c11;\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c19(s2, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parseindirectionStep() {\n      var s0, s1, s2, s3, s4, s5, s6;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 2) === peg$c20) {\n        s1 = peg$c20;\n        peg$currPos += 2;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c21); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseinteger();\n        if (s2 !== peg$FAILED) {\n          s3 = peg$currPos;\n          if (input.charCodeAt(peg$currPos) === 91) {\n            s4 = peg$c15;\n            peg$currPos++;\n          } else {\n            s4 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c16); }\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = peg$parseidAssertion();\n            if (s5 !== peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 93) {\n                s6 = peg$c17;\n                peg$currPos++;\n              } else {\n                s6 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c18); }\n              }\n              if (s6 !== peg$FAILED) {\n                s4 = [s4, s5, s6];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$c0;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$c0;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$c0;\n          }\n          if (s3 === peg$FAILED) {\n            s3 = peg$c11;\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c22(s2, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parseterminus() {\n      var s0, s1, s2, s3, s4, s5, s6;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 58) {\n        s1 = peg$c23;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c24); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseinteger();\n        if (s2 !== peg$FAILED) {\n          s3 = peg$currPos;\n          if (input.charCodeAt(peg$currPos) === 91) {\n            s4 = peg$c15;\n            peg$currPos++;\n          } else {\n            s4 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c16); }\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = peg$parsetextLocationAssertion();\n            if (s5 !== peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 93) {\n                s6 = peg$c17;\n                peg$currPos++;\n              } else {\n                s6 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c18); }\n              }\n              if (s6 !== peg$FAILED) {\n                s4 = [s4, s5, s6];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$c0;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$c0;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$c0;\n          }\n          if (s3 === peg$FAILED) {\n            s3 = peg$c11;\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c25(s2, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parseidAssertion() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      s1 = peg$parsevalue();\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c26(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsetextLocationAssertion() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = peg$parsecsv();\n      if (s1 === peg$FAILED) {\n        s1 = peg$c11;\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseparameter();\n        if (s2 === peg$FAILED) {\n          s2 = peg$c11;\n        }\n        if (s2 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c27(s1, s2);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parseparameter() {\n      var s0, s1, s2, s3, s4;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 59) {\n        s1 = peg$c28;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c29); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalueNoSpace();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 61) {\n            s3 = peg$c30;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c31); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = peg$parsevalueNoSpace();\n            if (s4 !== peg$FAILED) {\n              peg$reportedPos = s0;\n              s1 = peg$c32(s2, s4);\n              s0 = s1;\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c0;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parsecsv() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$parsevalue();\n      if (s1 === peg$FAILED) {\n        s1 = peg$c11;\n      }\n      if (s1 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 44) {\n          s2 = peg$c6;\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c7); }\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parsevalue();\n          if (s3 === peg$FAILED) {\n            s3 = peg$c11;\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c33(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parsevalueNoSpace() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      s2 = peg$parseescapedSpecialChars();\n      if (s2 === peg$FAILED) {\n        s2 = peg$parsecharacter();\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          s2 = peg$parseescapedSpecialChars();\n          if (s2 === peg$FAILED) {\n            s2 = peg$parsecharacter();\n          }\n        }\n      } else {\n        s1 = peg$c0;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c34(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsevalue() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      s2 = peg$parseescapedSpecialChars();\n      if (s2 === peg$FAILED) {\n        s2 = peg$parsecharacter();\n        if (s2 === peg$FAILED) {\n          s2 = peg$parsespace();\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          s2 = peg$parseescapedSpecialChars();\n          if (s2 === peg$FAILED) {\n            s2 = peg$parsecharacter();\n            if (s2 === peg$FAILED) {\n              s2 = peg$parsespace();\n            }\n          }\n        }\n      } else {\n        s1 = peg$c0;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c34(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parseescapedSpecialChars() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$currPos;\n      s2 = peg$parsecircumflex();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsecircumflex();\n        if (s3 !== peg$FAILED) {\n          s2 = [s2, s3];\n          s1 = s2;\n        } else {\n          peg$currPos = s1;\n          s1 = peg$c0;\n        }\n      } else {\n        peg$currPos = s1;\n        s1 = peg$c0;\n      }\n      if (s1 === peg$FAILED) {\n        s1 = peg$currPos;\n        s2 = peg$parsecircumflex();\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parsesquareBracket();\n          if (s3 !== peg$FAILED) {\n            s2 = [s2, s3];\n            s1 = s2;\n          } else {\n            peg$currPos = s1;\n            s1 = peg$c0;\n          }\n        } else {\n          peg$currPos = s1;\n          s1 = peg$c0;\n        }\n        if (s1 === peg$FAILED) {\n          s1 = peg$currPos;\n          s2 = peg$parsecircumflex();\n          if (s2 !== peg$FAILED) {\n            s3 = peg$parseparentheses();\n            if (s3 !== peg$FAILED) {\n              s2 = [s2, s3];\n              s1 = s2;\n            } else {\n              peg$currPos = s1;\n              s1 = peg$c0;\n            }\n          } else {\n            peg$currPos = s1;\n            s1 = peg$c0;\n          }\n          if (s1 === peg$FAILED) {\n            s1 = peg$currPos;\n            s2 = peg$parsecircumflex();\n            if (s2 !== peg$FAILED) {\n              s3 = peg$parsecomma();\n              if (s3 !== peg$FAILED) {\n                s2 = [s2, s3];\n                s1 = s2;\n              } else {\n                peg$currPos = s1;\n                s1 = peg$c0;\n              }\n            } else {\n              peg$currPos = s1;\n              s1 = peg$c0;\n            }\n            if (s1 === peg$FAILED) {\n              s1 = peg$currPos;\n              s2 = peg$parsecircumflex();\n              if (s2 !== peg$FAILED) {\n                s3 = peg$parsesemicolon();\n                if (s3 !== peg$FAILED) {\n                  s2 = [s2, s3];\n                  s1 = s2;\n                } else {\n                  peg$currPos = s1;\n                  s1 = peg$c0;\n                }\n              } else {\n                peg$currPos = s1;\n                s1 = peg$c0;\n              }\n              if (s1 === peg$FAILED) {\n                s1 = peg$currPos;\n                s2 = peg$parsecircumflex();\n                if (s2 !== peg$FAILED) {\n                  s3 = peg$parseequal();\n                  if (s3 !== peg$FAILED) {\n                    s2 = [s2, s3];\n                    s1 = s2;\n                  } else {\n                    peg$currPos = s1;\n                    s1 = peg$c0;\n                  }\n                } else {\n                  peg$currPos = s1;\n                  s1 = peg$c0;\n                }\n              }\n            }\n          }\n        }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c35(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsenumber() {\n      var s0, s1, s2, s3, s4, s5;\n\n      s0 = peg$currPos;\n      s1 = peg$currPos;\n      if (peg$c36.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c37); }\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = [];\n        if (peg$c38.test(input.charAt(peg$currPos))) {\n          s4 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c39); }\n        }\n        if (s4 !== peg$FAILED) {\n          while (s4 !== peg$FAILED) {\n            s3.push(s4);\n            if (peg$c38.test(input.charAt(peg$currPos))) {\n              s4 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s4 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c39); }\n            }\n          }\n        } else {\n          s3 = peg$c0;\n        }\n        if (s3 !== peg$FAILED) {\n          s2 = [s2, s3];\n          s1 = s2;\n        } else {\n          peg$currPos = s1;\n          s1 = peg$c0;\n        }\n      } else {\n        peg$currPos = s1;\n        s1 = peg$c0;\n      }\n      if (s1 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 46) {\n          s2 = peg$c40;\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c41); }\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$currPos;\n          s4 = [];\n          if (peg$c38.test(input.charAt(peg$currPos))) {\n            s5 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c39); }\n          }\n          while (s5 !== peg$FAILED) {\n            s4.push(s5);\n            if (peg$c38.test(input.charAt(peg$currPos))) {\n              s5 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c39); }\n            }\n          }\n          if (s4 !== peg$FAILED) {\n            if (peg$c36.test(input.charAt(peg$currPos))) {\n              s5 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c37); }\n            }\n            if (s5 !== peg$FAILED) {\n              s4 = [s4, s5];\n              s3 = s4;\n            } else {\n              peg$currPos = s3;\n              s3 = peg$c0;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$c0;\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c42(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c0;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c0;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c0;\n      }\n\n      return s0;\n    }\n\n    function peg$parseinteger() {\n      var s0, s1, s2, s3, s4;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 48) {\n        s1 = peg$c43;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c44); }\n      }\n      if (s1 === peg$FAILED) {\n        s1 = peg$currPos;\n        if (peg$c36.test(input.charAt(peg$currPos))) {\n          s2 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c37); }\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = [];\n          if (peg$c38.test(input.charAt(peg$currPos))) {\n            s4 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s4 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c39); }\n          }\n          while (s4 !== peg$FAILED) {\n            s3.push(s4);\n            if (peg$c38.test(input.charAt(peg$currPos))) {\n              s4 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s4 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c39); }\n            }\n          }\n          if (s3 !== peg$FAILED) {\n            s2 = [s2, s3];\n            s1 = s2;\n          } else {\n            peg$currPos = s1;\n            s1 = peg$c0;\n          }\n        } else {\n          peg$currPos = s1;\n          s1 = peg$c0;\n        }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c45(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsespace() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 32) {\n        s1 = peg$c46;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c47); }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c48();\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsecircumflex() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 94) {\n        s1 = peg$c49;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c50); }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c51();\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsedoubleQuote() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 34) {\n        s1 = peg$c52;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c53); }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c54();\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsesquareBracket() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 91) {\n        s1 = peg$c15;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c16); }\n      }\n      if (s1 === peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 93) {\n          s1 = peg$c17;\n          peg$currPos++;\n        } else {\n          s1 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c18); }\n        }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c55(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parseparentheses() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s1 = peg$c56;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c57); }\n      }\n      if (s1 === peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s1 = peg$c3;\n          peg$currPos++;\n        } else {\n          s1 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c4); }\n        }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c58(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsecomma() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 44) {\n        s1 = peg$c6;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c7); }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c59();\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsesemicolon() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 59) {\n        s1 = peg$c28;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c29); }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c60();\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parseequal() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 61) {\n        s1 = peg$c30;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c31); }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c61();\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsecharacter() {\n      var s0, s1;\n\n      s0 = peg$currPos;\n      if (peg$c62.test(input.charAt(peg$currPos))) {\n        s1 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c63); }\n      }\n      if (s1 === peg$FAILED) {\n        if (peg$c64.test(input.charAt(peg$currPos))) {\n          s1 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s1 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c65); }\n        }\n        if (s1 === peg$FAILED) {\n          if (peg$c38.test(input.charAt(peg$currPos))) {\n            s1 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c39); }\n          }\n          if (s1 === peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 45) {\n              s1 = peg$c66;\n              peg$currPos++;\n            } else {\n              s1 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c67); }\n            }\n            if (s1 === peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 95) {\n                s1 = peg$c68;\n                peg$currPos++;\n              } else {\n                s1 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c69); }\n              }\n              if (s1 === peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 46) {\n                  s1 = peg$c40;\n                  peg$currPos++;\n                } else {\n                  s1 = peg$FAILED;\n                  if (peg$silentFails === 0) { peg$fail(peg$c41); }\n                }\n              }\n            }\n          }\n        }\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c70(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    peg$result = peg$startRuleFunction();\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n    }\n  }\n\n  return {\n    SyntaxError: SyntaxError,\n    parse:       parse\n  };\n})();\n\ndefine(\"cfi_parser_gen\", (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.EPUBcfiParser;\n    };\n}(this)));\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\n//  \n//  Redistribution and use in source and binary forms, with or without modification, \n//  are permitted provided that the following conditions are met:\n//  1. Redistributions of source code must retain the above copyright notice, this \n//  list of conditions and the following disclaimer.\n//  2. Redistributions in binary form must reproduce the above copyright notice, \n//  this list of conditions and the following disclaimer in the documentation and/or \n//  other materials provided with the distribution.\n//  3. Neither the name of the organization nor the names of its contributors may be \n//  used to endorse or promote products derived from this software without specific \n//  prior written permission.\n\ndefine('cfi_parser',[\"./cfi_parser_gen\"], function (cfi_parser_gen) {\nreturn cfi_parser_gen;\n});\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\n(function(global) {\r\n\r\n\r\n// Description: This is a set of runtime errors that the CFI interpreter can throw. \r\n// Rationale: These error types extend the basic javascript error object so error things like the stack trace are \r\n//   included with the runtime errors. \r\n\r\n// REFACTORING CANDIDATE: This type of error may not be required in the long run. The parser should catch any syntax errors, \r\n//   provided it is error-free, and as such, the AST should never really have any node type errors, which are essentially errors\r\n//   in the structure of the AST. This error should probably be refactored out when the grammar and interpreter are more stable.\r\n\r\nvar obj = {\r\n\r\nNodeTypeError: function (node, message) {\r\n\r\n    function NodeTypeError () {\r\n\r\n        this.node = node;\r\n    }\r\n\r\n    NodeTypeError.prototype = new Error(message);\r\n    NodeTypeError.constructor = NodeTypeError;\r\n\r\n    return new NodeTypeError();\r\n},\r\n\r\n// REFACTORING CANDIDATE: Might make sense to include some more specifics about the out-of-rangeyness.\r\nOutOfRangeError: function (targetIndex, maxIndex, message) {\r\n\r\n    function OutOfRangeError () {\r\n\r\n        this.targetIndex = targetIndex;\r\n        this.maxIndex = maxIndex;\r\n    }\r\n\r\n    OutOfRangeError.prototype = new Error(message);\r\n    OutOfRangeError.constructor = OutOfRangeError()\r\n\r\n    return new OutOfRangeError();\r\n},\r\n\r\n// REFACTORING CANDIDATE: This is a bit too general to be useful. When I have a better understanding of the type of errors\r\n//   that can occur with the various terminus conditions, it'll make more sense to revisit this. \r\nTerminusError: function (terminusType, terminusCondition, message) {\r\n\r\n    function TerminusError () {\r\n\r\n        this.terminusType = terminusType;\r\n        this.terminusCondition = terminusCondition;\r\n    }\r\n\r\n    TerminusError.prototype = new Error(message);\r\n    TerminusError.constructor = TerminusError();\r\n\r\n    return new TerminusError();\r\n},\r\n\r\nCFIAssertionError: function (expectedAssertion, targetElementAssertion, message) {\r\n\r\n    function CFIAssertionError () {\r\n\r\n        this.expectedAssertion = expectedAssertion;\r\n        this.targetElementAssertion = targetElementAssertion;\r\n    }\r\n\r\n    CFIAssertionError.prototype = new Error(message);\r\n    CFIAssertionError.constructor = CFIAssertionError();\r\n\r\n    return new CFIAssertionError();\r\n}\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (typeof define == 'function' && typeof define.amd == 'object') {\r\n    console.log(\"RequireJS ... cfi_errors\");\r\n    \r\n    define('cfi_runtime_errors',[],\r\n    function () {\r\n        return obj;\r\n    });\r\n} else {\r\n    console.log(\"!RequireJS ... cfi_errors\");\r\n    \r\n    if (!global[\"EPUBcfi\"]) {\r\n        throw new Error(\"EPUBcfi not initialised on global object?! (window or this context)\");\r\n    }\r\n    \r\n    global.EPUBcfi.NodeTypeError = obj.NodeTypeError;\r\n    global.EPUBcfi.OutOfRangeError = obj.OutOfRangeError;\r\n    global.EPUBcfi.TerminusError = obj.TerminusError;\r\n    global.EPUBcfi.CFIAssertionError = obj.CFIAssertionError;\r\n}\r\n\r\n})(typeof window !== \"undefined\" ? window : this);\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\n(function(global) {\r\n\r\nvar init = function($, cfiRuntimeErrors) {\r\n    \r\nvar obj = {\r\n\r\n// Description: This model contains the implementation for \"instructions\" included in the EPUB CFI domain specific language (DSL). \r\n//   Lexing and parsing a CFI produces a set of executable instructions for processing a CFI (represented in the AST). \r\n//   This object contains a set of functions that implement each of the executable instructions in the AST. \r\n\r\n\t// ------------------------------------------------------------------------------------ //\r\n\t//  \"PUBLIC\" METHODS (THE API)                                                          //\r\n\t// ------------------------------------------------------------------------------------ //\r\n\r\n\t// Description: Follows a step\r\n\t// Rationale: The use of children() is important here, as this jQuery method returns a tree of xml nodes, EXCLUDING\r\n\t//   CDATA and text nodes. When we index into the set of child elements, we are assuming that text nodes have been \r\n\t//   excluded.\r\n\t// REFACTORING CANDIDATE: This should be called \"followIndexStep\"\r\n\tgetNextNode : function (CFIStepValue, $currNode, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n\t\t// Find the jquery index for the current node\r\n\t\tvar $targetNode;\r\n\t\tif (CFIStepValue % 2 == 0) {\r\n\r\n\t\t\t$targetNode = this.elementNodeStep(CFIStepValue, $currNode, classBlacklist, elementBlacklist, idBlacklist);\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t$targetNode = this.inferTargetTextNode(CFIStepValue, $currNode, classBlacklist, elementBlacklist, idBlacklist);\r\n\t\t}\r\n\r\n\t\treturn $targetNode;\r\n\t},\r\n\r\n\t// Description: This instruction executes an indirection step, where a resource is retrieved using a \r\n\t//   link contained on a attribute of the target element. The attribute that contains the link differs\r\n\t//   depending on the target. \r\n\t// Note: Iframe indirection will (should) fail if the iframe is not from the same domain as its containing script due to \r\n\t//   the cross origin security policy\r\n\tfollowIndirectionStep : function (CFIStepValue, $currNode, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n\t\tvar that = this;\r\n\t\tvar $contentDocument; \r\n\t\tvar $blacklistExcluded;\r\n\t\tvar $startElement;\r\n\t\tvar $targetNode;\r\n\r\n\t\t// TODO: This check must be expanded to all the different types of indirection step\r\n\t\t// Only expects iframes, at the moment\r\n\t\tif ($currNode === undefined || !$currNode.is(\"iframe\")) {\r\n\r\n\t\t\tthrow cfiRuntimeErrors.NodeTypeError($currNode, \"expected an iframe element\");\r\n\t\t}\r\n\r\n\t\t// Check node type; only iframe indirection is handled, at the moment\r\n\t\tif ($currNode.is(\"iframe\")) {\r\n\r\n\t\t\t// Get content\r\n\t\t\t$contentDocument = $currNode.contents();\r\n\r\n\t\t\t// Go to the first XHTML element, which will be the first child of the top-level document object\r\n\t\t\t$blacklistExcluded = this.applyBlacklist($contentDocument.children(), classBlacklist, elementBlacklist, idBlacklist);\r\n\t\t\t$startElement = $($blacklistExcluded[0]);\r\n\r\n\t\t\t// Follow an index step\r\n\t\t\t$targetNode = this.getNextNode(CFIStepValue, $startElement, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n\t\t\t// Return that shit!\r\n\t\t\treturn $targetNode; \r\n\t\t}\r\n\r\n\t\t// TODO: Other types of indirection\r\n\t\t// TODO: $targetNode.is(\"embed\")) : src\r\n\t\t// TODO: ($targetNode.is(\"object\")) : data\r\n\t\t// TODO: ($targetNode.is(\"image\") || $targetNode.is(\"xlink:href\")) : xlink:href\r\n\t},\r\n\r\n\t// Description: Injects an element at the specified text node\r\n\t// Arguments: a cfi text termination string, a jquery object to the current node\r\n\t// REFACTORING CANDIDATE: Rename this to indicate that it injects into a text terminus\r\n\ttextTermination : function ($currNode, textOffset, elementToInject) {\r\n\r\n\t\tvar $injectedElement;\r\n\t\t// Get the first node, this should be a text node\r\n\t\tif ($currNode === undefined) {\r\n\r\n\t\t\tthrow cfiRuntimeErrors.NodeTypeError($currNode, \"expected a terminating node, or node list\");\r\n\t\t} \r\n\t\telse if ($currNode.length === 0) {\r\n\r\n\t\t\tthrow cfiRuntimeErrors.TerminusError(\"Text\", \"Text offset:\" + textOffset, \"no nodes found for termination condition\");\r\n\t\t}\r\n\r\n\t\t$injectedElement = this.injectCFIMarkerIntoText($currNode, textOffset, elementToInject);\r\n\t\treturn $injectedElement;\r\n\t},\r\n\r\n\t// Description: Checks that the id assertion for the node target matches that on \r\n\t//   the found node. \r\n\ttargetIdMatchesIdAssertion : function ($foundNode, idAssertion) {\r\n\r\n\t\tif ($foundNode.attr(\"id\") === idAssertion) {\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\r\n\t// ------------------------------------------------------------------------------------ //\r\n\t//  \"PRIVATE\" HELPERS                                                                   //\r\n\t// ------------------------------------------------------------------------------------ //\r\n\r\n\t// Description: Step reference for xml element node. Expected that CFIStepValue is an even integer\r\n\telementNodeStep : function (CFIStepValue, $currNode, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n\t\tvar $targetNode;\r\n\t\tvar $blacklistExcluded;\r\n\t\tvar numElements;\r\n\t\tvar jqueryTargetNodeIndex = (CFIStepValue / 2) - 1;\r\n\r\n\t\t$blacklistExcluded = this.applyBlacklist($currNode.children(), classBlacklist, elementBlacklist, idBlacklist);\r\n\t\tnumElements = $blacklistExcluded.length;\r\n\r\n\t\tif (this.indexOutOfRange(jqueryTargetNodeIndex, numElements)) {\r\n\r\n\t\t\tthrow cfiRuntimeErrors.OutOfRangeError(jqueryTargetNodeIndex, numElements - 1, \"\");\r\n\t\t}\r\n\r\n\t    $targetNode = $($blacklistExcluded[jqueryTargetNodeIndex]);\r\n\t\treturn $targetNode;\r\n\t},\r\n\r\n\tretrieveItemRefHref : function ($itemRefElement, $packageDocument) {\r\n\r\n\t\treturn $(\"#\" + $itemRefElement.attr(\"idref\"), $packageDocument).attr(\"href\");\r\n\t},\r\n\r\n\tindexOutOfRange : function (targetIndex, numChildElements) {\r\n\r\n\t\treturn (targetIndex > numChildElements - 1) ? true : false;\r\n\t},\r\n\r\n\t// Rationale: In order to inject an element into a specific position, access to the parent object \r\n\t//   is required. This is obtained with the jquery parent() method. An alternative would be to \r\n\t//   pass in the parent with a filtered list containing only children that are part of the target text node.\r\n    injectCFIMarkerIntoText : function ($textNodeList, textOffset, elementToInject) {\r\n        var document = $textNodeList[0].ownerDocument;\r\n\r\n        var nodeNum;\r\n        var currNodeLength;\r\n        var currTextPosition = 0;\r\n        var nodeOffset;\r\n        var originalText;\r\n        var $injectedNode;\r\n        var $newTextNode;\r\n        // The iteration counter may be incorrect here (should be $textNodeList.length - 1 ??)\r\n        for (nodeNum = 0; nodeNum <= $textNodeList.length; nodeNum++) {\r\n\r\n            if ($textNodeList[nodeNum].nodeType === Node.TEXT_NODE) {\r\n\r\n                currNodeMaxIndex = $textNodeList[nodeNum].nodeValue.length  + currTextPosition;\r\n                nodeOffset = textOffset - currTextPosition;\r\n\r\n                if (currNodeMaxIndex > textOffset) {\r\n\r\n                    // This node is going to be split and the components re-inserted\r\n                    originalText = $textNodeList[nodeNum].nodeValue;\t\r\n\r\n                    // Before part\r\n                    $textNodeList[nodeNum].nodeValue = originalText.slice(0, nodeOffset);\r\n\r\n                    // Injected element\r\n                    $injectedNode = $(elementToInject).insertAfter($textNodeList.eq(nodeNum));\r\n\r\n                    // After part\r\n                    $newTextNode = $(document.createTextNode(originalText.slice(nodeOffset, originalText.length)));\r\n                    $($newTextNode).insertAfter($injectedNode);\r\n\r\n                    return $injectedNode;\r\n                } else if (currNodeMaxIndex == textOffset){\r\n                    $injectedNode = $(elementToInject).insertAfter($textNodeList.eq(nodeNum));\r\n                    return $injectedNode;\r\n                }\r\n                else {\r\n                    currTextPosition = currNodeMaxIndex;\r\n                }\r\n            } else if($textNodeList[nodeNum].nodeType === Node.COMMENT_NODE){\r\n            \tcurrNodeMaxIndex = $textNodeList[nodeNum].nodeValue.length + 7 + currTextPosition;\r\n                currTextPosition = currNodeMaxIndex;\r\n            } else if($textNodeList[nodeNum].nodeType === Node.PROCESSING_INSTRUCTION_NODE){\r\n            \tcurrNodeMaxIndex = $textNodeList[nodeNum].nodeValue.length + $textNodeList[nodeNum].target.length + 5\r\n                currTextPosition = currNodeMaxIndex;\r\n            }\r\n        }\r\n\r\n        throw cfiRuntimeErrors.TerminusError(\"Text\", \"Text offset:\" + textOffset, \"The offset exceeded the length of the text\");\r\n    },\r\n\r\n\t// Rationale: In order to inject an element into a specific position, access to the parent object \r\n\t//   is required. This is obtained with the jquery parent() method. An alternative would be to \r\n\t//   pass in the parent with a filtered list containing only children that are part of the target text node.\r\n\r\n\t// Description: This method finds a target text node and then injects an element into the appropriate node\r\n\t// Rationale: The possibility that cfi marker elements have been injected into a text node at some point previous to \r\n\t//   this method being called (and thus splitting the original text node into two separate text nodes) necessitates that\r\n\t//   the set of nodes that compromised the original target text node are inferred and returned.\r\n\t// Notes: Passed a current node. This node should have a set of elements under it. This will include at least one text node, \r\n\t//   element nodes (maybe), or possibly a mix. \r\n\t// REFACTORING CANDIDATE: This method is pretty long (and confusing). Worth investigating to see if it can be refactored into something clearer.\r\n\tinferTargetTextNode : function (CFIStepValue, $currNode, classBlacklist, elementBlacklist, idBlacklist) {\r\n\t\t\r\n\t\tvar $elementsWithoutMarkers;\r\n\t\tvar currLogicalTextNodeIndex;\r\n\t\tvar targetLogicalTextNodeIndex;\r\n\t\tvar nodeNum;\r\n\t\tvar $targetTextNodeList;\r\n\t\tvar prevNodeWasTextNode;\r\n\r\n\t\t// Remove any cfi marker elements from the set of elements. \r\n\t\t// Rationale: A filtering function is used, as simply using a class selector with jquery appears to \r\n\t\t//   result in behaviour where text nodes are also filtered out, along with the class element being filtered.\r\n\t\t$elementsWithoutMarkers = this.applyBlacklist($currNode.contents(), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n\t\t// Convert CFIStepValue to logical index; assumes odd integer for the step value\r\n\t\ttargetLogicalTextNodeIndex = ((parseInt(CFIStepValue) + 1) / 2) - 1;\r\n\r\n\t\t// Set text node position counter\r\n\t\tcurrLogicalTextNodeIndex = 0;\r\n\t\tprevNodeWasTextNode = false;\r\n\t\t$targetTextNodeList = $elementsWithoutMarkers.filter(\r\n\t\t\tfunction () {\r\n\r\n\t\t\t\tif (currLogicalTextNodeIndex === targetLogicalTextNodeIndex) {\r\n\r\n\t\t\t\t\t// If it's a text node\r\n\t\t\t\t\tif (this.nodeType === Node.TEXT_NODE || this.nodeType === Node.COMMENT_NODE || this.nodeType === Node.PROCESSING_INSTRUCTION_NODE) {\r\n\t\t\t\t\t\tprevNodeWasTextNode = true;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Rationale: The logical text node position is only incremented once a group of text nodes (a single logical\r\n\t\t\t\t\t//   text node) has been passed by the loop. \r\n\t\t\t\t\telse if (prevNodeWasTextNode && (this.nodeType !== Node.TEXT_NODE)) {\r\n\t\t\t\t\t\tcurrLogicalTextNodeIndex++;\r\n\t\t\t\t\t\tprevNodeWasTextNode = false;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// Don't return any elements\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\tif (this.nodeType === Node.TEXT_NODE || this.nodeType === Node.COMMENT_NODE || this.nodeType === Node.PROCESSING_INSTRUCTION_NODE) {\r\n\t\t\t\t\t\tprevNodeWasTextNode = true;\r\n\t\t\t\t\t}else if (!prevNodeWasTextNode && this.nodeType === Node.ELEMENT_NODE){\r\n                        currLogicalTextNodeIndex++;\r\n\t\t\t\t\t\tprevNodeWasTextNode = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (prevNodeWasTextNode && (this.nodeType !== Node.TEXT_NODE) && (this !== $elementsWithoutMarkers.lastChild)) {\r\n\t\t\t\t\t\tcurrLogicalTextNodeIndex++;\r\n\t\t\t\t\t\tprevNodeWasTextNode = false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\t// The filtering above should have counted the number of \"logical\" text nodes; this can be used to \r\n\t\t// detect out of range errors\r\n\t\tif ($targetTextNodeList.length === 0) {\r\n\t\t\tthrow cfiRuntimeErrors.OutOfRangeError(targetLogicalTextNodeIndex, currLogicalTextNodeIndex, \"Index out of range\");\r\n\t\t}\r\n\r\n\t\t// return the text node list\r\n\t\treturn $targetTextNodeList;\r\n\t},\r\n\r\n\tapplyBlacklist : function ($elements, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var $filteredElements;\r\n\r\n        $filteredElements = $elements.filter(\r\n            function () {\r\n\r\n                var $currElement = $(this);\r\n                var includeInList = true;\r\n\r\n                if (classBlacklist) {\r\n\r\n                \t// Filter each element with the class type\r\n                \t$.each(classBlacklist, function (index, value) {\r\n\r\n\t                    if ($currElement.hasClass(value)) {\r\n\t                    \tincludeInList = false;\r\n\r\n\t                    \t// Break this loop\r\n\t                        return false;\r\n\t                    }\r\n                \t});\r\n                }\r\n\r\n                if (elementBlacklist) {\r\n                \t\r\n\t                // For each type of element\r\n\t                $.each(elementBlacklist, function (index, value) {\r\n\r\n\t                    if ($currElement.is(value)) {\r\n\t                    \tincludeInList = false;\r\n\r\n\t                    \t// Break this loop\r\n\t                        return false;\r\n\t                    }\r\n\t                });\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (idBlacklist) {\r\n                \t\r\n\t                // For each type of element\r\n\t                $.each(idBlacklist, function (index, value) {\r\n\r\n\t                    if ($currElement.attr(\"id\") === value) {\r\n\t                    \tincludeInList = false;\r\n\r\n\t                    \t// Break this loop\r\n\t                        return false;\r\n\t                    }\r\n\t                });\r\n\t\t\t\t}\r\n\r\n                return includeInList;\r\n            }\r\n        );\r\n\r\n        return $filteredElements;\r\n    }\r\n};\r\n\r\nreturn obj;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (typeof define == 'function' && typeof define.amd == 'object') {\r\n    console.log(\"RequireJS ... cfi_instructions\");\r\n    \r\n    define('cfi_instructions',['jquery', './cfi_runtime_errors'],\r\n    function ($, cfiRuntimeErrors) {\r\n        return init($, cfiRuntimeErrors);\r\n    });\r\n} else {\r\n    console.log(\"!RequireJS ... cfi_instructions\");\r\n    \r\n    if (!global[\"EPUBcfi\"]) {\r\n        throw new Error(\"EPUBcfi not initialised on global object?! (window or this context)\");\r\n    }\r\n    global.EPUBcfi.CFIInstructions = \r\n    init($,\r\n        {\r\n            NodeTypeError: global.EPUBcfi.NodeTypeError,\r\n            OutOfRangeError: global.EPUBcfi.OutOfRangeError,\r\n            TerminusError: global.EPUBcfi.TerminusError,\r\n            CFIAssertionError: global.EPUBcfi.CFIAssertionError\r\n        });\r\n}\r\n\r\n})(typeof window !== \"undefined\" ? window : this);\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\n(function(global) {\r\n\r\nvar init = function($, cfiParser, cfiInstructions, cfiRuntimeErrors) {\r\n    \r\n    if (typeof cfiParser === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiParser\");\r\n    }\r\n    \r\n    if (typeof cfiInstructions === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiInstructions\");\r\n    }\r\n    \r\n    if (typeof cfiRuntimeErrors === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiRuntimeErrors\");\r\n    }\r\n    \r\nvar obj = {\r\n\r\n// Description: This is an interpreter that inteprets an Abstract Syntax Tree (AST) for a CFI. The result of executing the interpreter\r\n//   is to inject an element, or set of elements, into an EPUB content document (which is just an XHTML document). These element(s) will\r\n//   represent the position or area in the EPUB referenced by a CFI.\r\n// Rationale: The AST is a clean and readable expression of the step-terminus structure of a CFI. Although building an interpreter adds to the\r\n//   CFI infrastructure, it provides a number of benefits. First, it emphasizes a clear separation of concerns between lexing/parsing a\r\n//   CFI, which involves some complexity related to escaped and special characters, and the execution of the underlying set of steps \r\n//   represented by the CFI. Second, it will be easier to extend the interpreter to account for new/altered CFI steps (say for references\r\n//   to vector objects or multiple CFIs) than if lexing, parsing and interpretation were all handled in a single step. Finally, Readium's objective is \r\n//   to demonstrate implementation of the EPUB 3.0 spec. An implementation with a strong separation of concerns that conforms to \r\n//   well-understood patterns for DSL processing should be easier to communicate, analyze and understand. \r\n// REFACTORING CANDIDATE: node type errors shouldn't really be possible if the CFI syntax is correct and the parser is error free. \r\n//   Might want to make the script die in those instances, once the grammar and interpreter are more stable. \r\n// REFACTORING CANDIDATE: The use of the 'nodeType' property is confusing as this is a DOM node property and the two are unrelated. \r\n//   Whoops. There shouldn't be any interference, however, I think this should be changed. \r\n\r\n    // ------------------------------------------------------------------------------------ //\r\n    //  \"PUBLIC\" METHODS (THE API)                                                          //\r\n    // ------------------------------------------------------------------------------------ //\r\n\r\n    // Description: Find the content document referenced by the spine item. This should be the spine item \r\n    //   referenced by the first indirection step in the CFI.\r\n    // Rationale: This method is a part of the API so that the reading system can \"interact\" the content document \r\n    //   pointed to by a CFI. If this is not a separate step, the processing of the CFI must be tightly coupled with \r\n    //   the reading system, as it stands now. \r\n    getContentDocHref : function (CFI, packageDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var $packageDocument = $(packageDocument);\r\n        var decodedCFI = decodeURI(CFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n\r\n        if (!CFIAST || CFIAST.type !== \"CFIAST\") { \r\n            throw cfiRuntimeErrors.NodeTypeError(CFIAST, \"expected CFI AST root node\");\r\n        }\r\n\r\n        // Interpet the path node (the package document step)\r\n        var $packageElement = $($(\"package\", $packageDocument)[0]);\r\n        var $currElement = this.interpretIndexStepNode(CFIAST.cfiString.path, $packageElement, classBlacklist, elementBlacklist, idBlacklist);\r\n        foundHref = this.searchLocalPathForHref($currElement, $packageDocument, CFIAST.cfiString.localPath, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        if (foundHref) {\r\n            return foundHref;\r\n        }\r\n        else {\r\n            return undefined;\r\n        }\r\n    },\r\n\r\n    // Description: Inject an arbitrary html element into a position in a content document referenced by a CFI\r\n    injectElement : function (CFI, contentDocument, elementToInject, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var decodedCFI = decodeURI(CFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n        var indirectionNode;\r\n        var indirectionStepNum;\r\n        var $currElement;\r\n\r\n        // Rationale: Since the correct content document for this CFI is already being passed, we can skip to the beginning \r\n        //   of the indirection step that referenced the content document.\r\n        // Note: This assumes that indirection steps and index steps conform to an interface: an object with stepLength, idAssertion\r\n        indirectionStepNum = this.getFirstIndirectionStepNum(CFIAST);\r\n        indirectionNode = CFIAST.cfiString.localPath.steps[indirectionStepNum];\r\n        indirectionNode.type = \"indexStep\";\r\n\r\n        // Interpret the rest of the steps\r\n        $currElement = this.interpretLocalPath(CFIAST.cfiString.localPath, indirectionStepNum, $(\"html\", contentDocument), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // TODO: detect what kind of terminus; for now, text node termini are the only kind implemented\r\n        $currElement = this.interpretTextTerminusNode(CFIAST.cfiString.localPath.termStep, $currElement, elementToInject);\r\n\r\n        // Return the element that was injected into\r\n        return $currElement;\r\n    },\r\n\r\n    // Description: Inject an arbitrary html element into a position in a content document referenced by a CFI\r\n    injectRangeElements : function (rangeCFI, contentDocument, startElementToInject, endElementToInject, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var decodedCFI = decodeURI(rangeCFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n        var indirectionNode;\r\n        var indirectionStepNum;\r\n        var $currElement;\r\n        var $range1TargetElement;\r\n        var $range2TargetElement;\r\n\r\n        // Rationale: Since the correct content document for this CFI is already being passed, we can skip to the beginning \r\n        //   of the indirection step that referenced the content document.\r\n        // Note: This assumes that indirection steps and index steps conform to an interface: an object with stepLength, idAssertion\r\n        indirectionStepNum = this.getFirstIndirectionStepNum(CFIAST);\r\n        indirectionNode = CFIAST.cfiString.localPath.steps[indirectionStepNum];\r\n        indirectionNode.type = \"indexStep\";\r\n\r\n        // Interpret the rest of the steps in the first local path\r\n        $currElement = this.interpretLocalPath(CFIAST.cfiString.localPath, indirectionStepNum, $(\"html\", contentDocument), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Interpret the first range local_path\r\n        $range1TargetElement = this.interpretLocalPath(CFIAST.cfiString.range1, 0, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n        $range1TargetElement = this.interpretTextTerminusNode(CFIAST.cfiString.range1.termStep, $range1TargetElement, startElementToInject);\r\n\r\n        // Interpret the second range local_path\r\n        $range2TargetElement = this.interpretLocalPath(CFIAST.cfiString.range2, 0, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n        $range2TargetElement = this.interpretTextTerminusNode(CFIAST.cfiString.range2.termStep, $range2TargetElement, endElementToInject);\r\n\r\n        // Return the element that was injected into\r\n        return {\r\n            startElement : $range1TargetElement[0],\r\n            endElement : $range2TargetElement[0]\r\n        };\r\n    },\r\n\r\n    // Description: This method will return the element or node (say, a text node) that is the final target of the \r\n    //   the CFI.\r\n    getTargetElement : function (CFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var decodedCFI = decodeURI(CFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n        var indirectionNode;\r\n        var indirectionStepNum;\r\n        var $currElement;\r\n        \r\n        // Rationale: Since the correct content document for this CFI is already being passed, we can skip to the beginning \r\n        //   of the indirection step that referenced the content document.\r\n        // Note: This assumes that indirection steps and index steps conform to an interface: an object with stepLength, idAssertion\r\n        indirectionStepNum = this.getFirstIndirectionStepNum(CFIAST);\r\n        indirectionNode = CFIAST.cfiString.localPath.steps[indirectionStepNum];\r\n        indirectionNode.type = \"indexStep\";\r\n\r\n        // Interpret the rest of the steps\r\n        $currElement = this.interpretLocalPath(CFIAST.cfiString.localPath, indirectionStepNum, $(\"html\", contentDocument), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Return the element at the end of the CFI\r\n        return $currElement;\r\n    },\r\n\r\n    // Description: This method will return the start and end elements (along with their char offsets) that are the final targets of the range CFI.\r\n    getRangeTargetElements : function (rangeCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var decodedCFI = decodeURI(rangeCFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n        var indirectionNode;\r\n        var indirectionStepNum;\r\n        var $currElement;\r\n        var $range1TargetElement;\r\n        var $range2TargetElement;\r\n        \r\n        // Rationale: Since the correct content document for this CFI is already being passed, we can skip to the beginning \r\n        //   of the indirection step that referenced the content document.\r\n        // Note: This assumes that indirection steps and index steps conform to an interface: an object with stepLength, idAssertion\r\n        indirectionStepNum = this.getFirstIndirectionStepNum(CFIAST);\r\n        indirectionNode = CFIAST.cfiString.localPath.steps[indirectionStepNum];\r\n        indirectionNode.type = \"indexStep\";\r\n\r\n        // Interpret the rest of the steps\r\n        $currElement = this.interpretLocalPath(CFIAST.cfiString.localPath, indirectionStepNum, $(\"html\", contentDocument), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Interpret first range local_path\r\n        $range1TargetElement = this.interpretLocalPath(CFIAST.cfiString.range1, 0, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Interpret second range local_path\r\n        $range2TargetElement = this.interpretLocalPath(CFIAST.cfiString.range2, 0, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Get the start and end character offsets\r\n        var startOffset = parseInt(CFIAST.cfiString.range1.termStep.offsetValue) || undefined;\r\n        var endOffset = parseInt(CFIAST.cfiString.range2.termStep.offsetValue) || undefined;\r\n\r\n        // Return the element (and char offsets) at the end of the CFI\r\n        return {\r\n            startElement: $range1TargetElement[0],\r\n            startOffset: startOffset,\r\n            endElement: $range2TargetElement[0],\r\n            endOffset: endOffset\r\n        };\r\n    },\r\n\r\n    // Description: This method allows a \"partial\" CFI to be used to reference a target in a content document, without a \r\n    //   package document CFI component. \r\n    // Arguments: {\r\n    //     contentDocumentCFI : This is a partial CFI that represents a path in a content document only. This partial must be \r\n    //        syntactically valid, even though it references a path starting at the top of a content document (which is a CFI that\r\n    //        that has no defined meaning in the spec.)\r\n    //     contentDocument : A DOM representation of the content document to which the partial CFI refers. \r\n    // }\r\n    // Rationale: This method exists to meet the requirements of the Readium-SDK and should be used with care\r\n    getTargetElementWithPartialCFI : function (contentDocumentCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var decodedCFI = decodeURI(contentDocumentCFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n        var indirectionNode;\r\n        \r\n        // Interpret the path node \r\n        var $currElement = this.interpretIndexStepNode(CFIAST.cfiString.path, $(\"html\", contentDocument), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Interpret the rest of the steps\r\n        $currElement = this.interpretLocalPath(CFIAST.cfiString.localPath, 0, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Return the element at the end of the CFI\r\n        return $currElement;        \r\n    },\r\n\r\n    // Description: This method allows a \"partial\" CFI to be used, with a content document, to return the text node and offset \r\n    //    referenced by the partial CFI.\r\n    // Arguments: {\r\n    //     contentDocumentCFI : This is a partial CFI that represents a path in a content document only. This partial must be \r\n    //        syntactically valid, even though it references a path starting at the top of a content document (which is a CFI that\r\n    //        that has no defined meaning in the spec.)\r\n    //     contentDocument : A DOM representation of the content document to which the partial CFI refers. \r\n    // }\r\n    // Rationale: This method exists to meet the requirements of the Readium-SDK and should be used with care\r\n    getTextTerminusInfoWithPartialCFI : function (contentDocumentCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var decodedCFI = decodeURI(contentDocumentCFI);\r\n        var CFIAST = cfiParser.parse(decodedCFI);\r\n        var indirectionNode;\r\n        var textOffset;\r\n        \r\n        // Interpret the path node \r\n        var $currElement = this.interpretIndexStepNode(CFIAST.cfiString.path, $(\"html\", contentDocument), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Interpret the rest of the steps\r\n        $currElement = this.interpretLocalPath(CFIAST.cfiString.localPath, 0, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Return the element at the end of the CFI\r\n        textOffset = parseInt(CFIAST.cfiString.localPath.termStep.offsetValue);\r\n        return { textNode : $currElement,\r\n                 textOffset : textOffset\r\n            };\r\n    },\r\n    // Description: This function will determine if the input CFI is expressed as a range\r\n    isRangeCfi: function (cfi) {\r\n        var CFIAST = cfiParser.parse(cfi);\r\n        return CFIAST.cfiString.range1 ? true : false;\r\n    },\r\n\r\n    // ------------------------------------------------------------------------------------ //\r\n    //  \"PRIVATE\" HELPERS                                                                   //\r\n    // ------------------------------------------------------------------------------------ //\r\n\r\n    getFirstIndirectionStepNum : function (CFIAST) {\r\n\r\n        // Find the first indirection step in the local path; follow it like a regular step, as the step in the content document it \r\n        //   references is already loaded and has been passed to this method\r\n        var stepNum = 0;\r\n        for (stepNum; stepNum <= CFIAST.cfiString.localPath.steps.length - 1 ; stepNum++) {\r\n        \r\n            nextStepNode = CFIAST.cfiString.localPath.steps[stepNum];\r\n            if (nextStepNode.type === \"indirectionStep\") {\r\n                return stepNum;\r\n            }\r\n        }\r\n    },\r\n\r\n    // REFACTORING CANDIDATE: cfiString node and start step num could be merged into one argument, by simply passing the \r\n    //   starting step... probably a good idea, this would make the meaning of this method clearer.\r\n    interpretLocalPath : function (localPathNode, startStepNum, $currElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var stepNum = startStepNum;\r\n        var nextStepNode;\r\n        for (stepNum; stepNum <= localPathNode.steps.length - 1 ; stepNum++) {\r\n        \r\n            nextStepNode = localPathNode.steps[stepNum];\r\n            if (nextStepNode.type === \"indexStep\") {\r\n\r\n                $currElement = this.interpretIndexStepNode(nextStepNode, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n            }\r\n            else if (nextStepNode.type === \"indirectionStep\") {\r\n\r\n                $currElement = this.interpretIndirectionStepNode(nextStepNode, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n            }\r\n        }\r\n\r\n        return $currElement;\r\n    },\r\n\r\n    interpretIndexStepNode : function (indexStepNode, $currElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        // Check node type; throw error if wrong type\r\n        if (indexStepNode === undefined || indexStepNode.type !== \"indexStep\") {\r\n\r\n            throw cfiRuntimeErrors.NodeTypeError(indexStepNode, \"expected index step node\");\r\n        }\r\n\r\n        // Index step\r\n        var $stepTarget = cfiInstructions.getNextNode(indexStepNode.stepLength, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Check the id assertion, if it exists\r\n        if (indexStepNode.idAssertion) {\r\n\r\n            if (!cfiInstructions.targetIdMatchesIdAssertion($stepTarget, indexStepNode.idAssertion)) {\r\n\r\n                throw cfiRuntimeErrors.CFIAssertionError(indexStepNode.idAssertion, $stepTarget.attr('id'), \"Id assertion failed\");\r\n            }\r\n        }\r\n\r\n        return $stepTarget;\r\n    },\r\n\r\n    interpretIndirectionStepNode : function (indirectionStepNode, $currElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        // Check node type; throw error if wrong type\r\n        if (indirectionStepNode === undefined || indirectionStepNode.type !== \"indirectionStep\") {\r\n\r\n            throw cfiRuntimeErrors.NodeTypeError(indirectionStepNode, \"expected indirection step node\");\r\n        }\r\n\r\n        // Indirection step\r\n        var $stepTarget = cfiInstructions.followIndirectionStep(\r\n            indirectionStepNode.stepLength, \r\n            $currElement, \r\n            classBlacklist, \r\n            elementBlacklist);\r\n\r\n        // Check the id assertion, if it exists\r\n        if (indirectionStepNode.idAssertion) {\r\n\r\n            if (!cfiInstructions.targetIdMatchesIdAssertion($stepTarget, indirectionStepNode.idAssertion)) {\r\n\r\n                throw cfiRuntimeErrors.CFIAssertionError(indirectionStepNode.idAssertion, $stepTarget.attr('id'), \"Id assertion failed\");\r\n            }\r\n        }\r\n\r\n        return $stepTarget;\r\n    },\r\n\r\n    // REFACTORING CANDIDATE: The logic here assumes that a user will always want to use this terminus\r\n    //   to inject content into the found node. This will not always be the case, and different types of interpretation\r\n    //   are probably desired. \r\n    interpretTextTerminusNode : function (terminusNode, $currElement, elementToInject) {\r\n\r\n        if (terminusNode === undefined || terminusNode.type !== \"textTerminus\") {\r\n\r\n            throw cfiRuntimeErrors.NodeTypeError(terminusNode, \"expected text terminus node\");\r\n        }\r\n\r\n        var $injectedElement = cfiInstructions.textTermination(\r\n            $currElement, \r\n            terminusNode.offsetValue, \r\n            elementToInject\r\n            );\r\n\r\n        return $injectedElement;\r\n    },\r\n\r\n    searchLocalPathForHref : function ($currElement, $packageDocument, localPathNode, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        // Interpret the first local_path node, which is a set of steps and and a terminus condition\r\n        var stepNum = 0;\r\n        var nextStepNode;\r\n        for (stepNum = 0 ; stepNum <= localPathNode.steps.length - 1 ; stepNum++) {\r\n        \r\n            nextStepNode = localPathNode.steps[stepNum];\r\n            if (nextStepNode.type === \"indexStep\") {\r\n                \r\n                $currElement = this.interpretIndexStepNode(nextStepNode, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n            }\r\n            else if (nextStepNode.type === \"indirectionStep\") {\r\n\r\n                $currElement = this.interpretIndirectionStepNode(nextStepNode, $currElement, classBlacklist, elementBlacklist, idBlacklist);\r\n            }\r\n\r\n            // Found the content document href referenced by the spine item \r\n            if ($currElement.is(\"itemref\")) {\r\n\r\n                return cfiInstructions.retrieveItemRefHref($currElement, $packageDocument);\r\n            }\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n};\r\n\r\nreturn obj;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (typeof define == 'function' && typeof define.amd == 'object') {\r\n    console.log(\"RequireJS ... cfi_interpreter\");\r\n    \r\n    define('cfi_interpreter',['jquery', './cfi_parser', './cfi_instructions', './cfi_runtime_errors'],\r\n    function ($, cfiParser, cfiInstructions, cfiRuntimeErrors) {\r\n        return init($, cfiParser, cfiInstructions, cfiRuntimeErrors);\r\n    });\r\n} else {\r\n    console.log(\"!RequireJS ... cfi_interpreter\");\r\n    \r\n    if (!global[\"EPUBcfi\"]) {\r\n        throw new Error(\"EPUBcfi not initialised on global object?! (window or this context)\");\r\n    }\r\n    global.EPUBcfi.Interpreter = \r\n    init($,\r\n        global.EPUBcfi.Parser,\r\n        global.EPUBcfi.CFIInstructions,\r\n        {\r\n            NodeTypeError: global.EPUBcfi.NodeTypeError,\r\n            OutOfRangeError: global.EPUBcfi.OutOfRangeError,\r\n            TerminusError: global.EPUBcfi.TerminusError,\r\n            CFIAssertionError: global.EPUBcfi.CFIAssertionError\r\n        });\r\n}\r\n\r\n})(typeof window !== \"undefined\" ? window : this);\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\n(function(global) {\r\n\r\nvar init = function($, cfiInstructions, cfiRuntimeErrors) {\r\n    \r\n    if (typeof cfiInstructions === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiInstructions\");\r\n    }\r\n    \r\n    if (typeof cfiRuntimeErrors === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiRuntimeErrors\");\r\n    }\r\n    \r\nvar obj = {\r\n\r\n    // ------------------------------------------------------------------------------------ //\r\n    //  \"PUBLIC\" METHODS (THE API)                                                          //\r\n    // ------------------------------------------------------------------------------------ //\r\n\r\n    generateCharOffsetRangeComponent : function (rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n        var document = rangeStartElement.ownerDocument;\r\n\r\n        var docRange;\r\n        var commonAncestor;\r\n        var range1OffsetStep;\r\n        var range1CFI;\r\n        var range2OffsetStep;\r\n        var range2CFI;\r\n        var commonCFIComponent;\r\n\r\n        this.validateStartTextNode(rangeStartElement);\r\n        this.validateStartTextNode(rangeEndElement);\r\n\r\n        // Parent element is the same\r\n        if ($(rangeStartElement).parent()[0] === $(rangeEndElement).parent()[0]) {\r\n            range1OffsetStep = this.createCFITextNodeStep($(rangeStartElement), startOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n            range2OffsetStep = this.createCFITextNodeStep($(rangeEndElement), endOffset, classBlacklist, elementBlacklist, idBlacklist);          \r\n            commonCFIComponent = this.createCFIElementSteps($(rangeStartElement).parent(), \"html\", classBlacklist, elementBlacklist, idBlacklist);\r\n            return commonCFIComponent.substring(1, commonCFIComponent.length) + \",\" + range1OffsetStep + \",\" + range2OffsetStep;\r\n        }\r\n        else {\r\n\r\n            // Create a document range to find the common ancestor\r\n            docRange = document.createRange();\r\n            docRange.setStart(rangeStartElement, startOffset);\r\n            docRange.setEnd(rangeEndElement, endOffset);\r\n            commonAncestor = docRange.commonAncestorContainer;\r\n\r\n            // Generate terminating offset and range 1\r\n            range1OffsetStep = this.createCFITextNodeStep($(rangeStartElement), startOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n            range1CFI = this.createCFIElementSteps($(rangeStartElement).parent(), commonAncestor, classBlacklist, elementBlacklist, idBlacklist) + range1OffsetStep;\r\n\r\n            // Generate terminating offset and range 2\r\n            range2OffsetStep = this.createCFITextNodeStep($(rangeEndElement), endOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n            range2CFI = this.createCFIElementSteps($(rangeEndElement).parent(), commonAncestor, classBlacklist, elementBlacklist, idBlacklist) + range2OffsetStep;\r\n\r\n            // Generate shared component\r\n            commonCFIComponent = this.createCFIElementSteps($(commonAncestor), \"html\", classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n            // Return the result\r\n            return commonCFIComponent.substring(1, commonCFIComponent.length) + \",\" + range1CFI + \",\" + range2CFI;\r\n        }\r\n    },\r\n\r\n    generateElementRangeComponent : function (rangeStartElement, rangeEndElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n        var document = rangeStartElement.ownerDocument;\r\n\r\n        var docRange;\r\n        var commonAncestor;\r\n        var range1CFI;\r\n        var range2CFI;\r\n        var commonCFIComponent;\r\n\r\n        this.validateStartElement(rangeStartElement);\r\n        this.validateStartElement(rangeEndElement);\r\n\r\n        if (rangeStartElement === rangeEndElement) {\r\n            throw new Error(\"Start and end element cannot be the same for a CFI range\");\r\n        }\r\n\r\n        // Create a document range to find the common ancestor\r\n        docRange = document.createRange();\r\n        docRange.setStart(rangeStartElement, 0);\r\n        docRange.setEnd(rangeEndElement, rangeEndElement.childNodes.length);\r\n        commonAncestor = docRange.commonAncestorContainer;\r\n\r\n        // Generate range 1\r\n        range1CFI = this.createCFIElementSteps($(rangeStartElement), commonAncestor, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Generate range 2\r\n        range2CFI = this.createCFIElementSteps($(rangeEndElement), commonAncestor, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Generate shared component\r\n        commonCFIComponent = this.createCFIElementSteps($(commonAncestor), \"html\", classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Return the result\r\n        return commonCFIComponent.substring(1, commonCFIComponent.length) + \",\" + range1CFI + \",\" + range2CFI;\r\n    },\r\n\r\n    generateRangeComponent : function (rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n        var document = rangeStartElement.ownerDocument;\r\n\r\n        if(rangeStartElement.nodeType === Node.ELEMENT_NODE && rangeEndElement.nodeType === Node.ELEMENT_NODE){\r\n            return this.generateElementRangeComponent(rangeStartElement, rangeEndElement, classBlacklist, elementBlacklist, idBlacklist);\r\n        } else if(rangeStartElement.nodeType === Node.TEXT_NODE && rangeEndElement.nodeType === Node.TEXT_NODE){\r\n            return this.generateCharOffsetRangeComponent(rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n        } else {\r\n            var docRange;\r\n            var range1CFI;\r\n            var range1OffsetStep;\r\n            var range2CFI;\r\n            var range2OffsetStep;\r\n            var commonAncestor;\r\n            var commonCFIComponent;\r\n\r\n            // Create a document range to find the common ancestor\r\n            docRange = document.createRange();\r\n            docRange.setStart(rangeStartElement, startOffset);\r\n            docRange.setEnd(rangeEndElement, endOffset);\r\n            commonAncestor = docRange.commonAncestorContainer;\r\n\r\n            if(rangeStartElement.nodeType === Node.ELEMENT_NODE){\r\n                this.validateStartElement(rangeStartElement);\r\n                range1CFI = this.createCFIElementSteps($(rangeStartElement), commonAncestor, classBlacklist, elementBlacklist, idBlacklist);\r\n            } else {\r\n                this.validateStartTextNode(rangeStartElement);\r\n                // Generate terminating offset and range 1\r\n                range1OffsetStep = this.createCFITextNodeStep($(rangeStartElement), startOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n                if($(rangeStartElement).parent().is(commonAncestor)){\r\n                    range1CFI = range1OffsetStep;\r\n                } else {\r\n                    range1CFI = this.createCFIElementSteps($(rangeStartElement).parent(), commonAncestor, classBlacklist, elementBlacklist, idBlacklist) + range1OffsetStep;    \r\n                }\r\n            }\r\n\r\n            if(rangeEndElement.nodeType === Node.ELEMENT_NODE){\r\n                this.validateStartElement(rangeEndElement);\r\n                range2CFI = this.createCFIElementSteps($(rangeEndElement), commonAncestor, classBlacklist, elementBlacklist, idBlacklist);\r\n            } else {\r\n                this.validateStartTextNode(rangeEndElement);\r\n                // Generate terminating offset and range 2\r\n                range2OffsetStep = this.createCFITextNodeStep($(rangeEndElement), endOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n                if($(rangeEndElement).parent().is(commonAncestor)){\r\n                    range2CFI = range2OffsetStep;\r\n                } else {\r\n                    range2CFI = this.createCFIElementSteps($(rangeEndElement).parent(), commonAncestor, classBlacklist, elementBlacklist, idBlacklist) + range2OffsetStep;    \r\n                }                \r\n            }\r\n\r\n            // Generate shared component\r\n            commonCFIComponent = this.createCFIElementSteps($(commonAncestor), \"html\", classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n            // Return the result\r\n            return commonCFIComponent.substring(1, commonCFIComponent.length) + \",\" + range1CFI + \",\" + range2CFI;\r\n        }\r\n    },\r\n\r\n    // Description: Generates a character offset CFI \r\n    // Arguments: The text node that contains the offset referenced by the cfi, the offset value, the name of the \r\n    //   content document that contains the text node, the package document for this EPUB.\r\n    generateCharacterOffsetCFIComponent : function (startTextNode, characterOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var textNodeStep;\r\n        var contentDocCFI;\r\n        var $itemRefStartNode;\r\n        var packageDocCFI;\r\n\r\n        this.validateStartTextNode(startTextNode, characterOffset);\r\n\r\n        // Create the text node step\r\n        textNodeStep = this.createCFITextNodeStep($(startTextNode), characterOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Call the recursive method to create all the steps up to the head element of the content document (the \"html\" element)\r\n        contentDocCFI = this.createCFIElementSteps($(startTextNode).parent(), \"html\", classBlacklist, elementBlacklist, idBlacklist) + textNodeStep;\r\n        return contentDocCFI.substring(1, contentDocCFI.length);\r\n    },\r\n\r\n    generateElementCFIComponent : function (startElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var contentDocCFI;\r\n        var $itemRefStartNode;\r\n        var packageDocCFI;\r\n\r\n        this.validateStartElement(startElement);\r\n\r\n        // Call the recursive method to create all the steps up to the head element of the content document (the \"html\" element)\r\n        contentDocCFI = this.createCFIElementSteps($(startElement), \"html\", classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Remove the ! \r\n        return contentDocCFI.substring(1, contentDocCFI.length);\r\n    },\r\n\r\n    generatePackageDocumentCFIComponent : function (contentDocumentName, packageDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        this.validateContentDocumentName(contentDocumentName);\r\n        this.validatePackageDocument(packageDocument, contentDocumentName);\r\n\r\n        // Get the start node (itemref element) that references the content document\r\n        $itemRefStartNode = $(\"itemref[idref='\" + contentDocumentName + \"']\", $(packageDocument));\r\n\r\n        // Create the steps up to the top element of the package document (the \"package\" element)\r\n        packageDocCFIComponent = this.createCFIElementSteps($itemRefStartNode, \"package\", classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Append an !; this assumes that a CFI content document CFI component will be appended at some point\r\n        return packageDocCFIComponent + \"!\";\r\n    },\r\n\r\n    generatePackageDocumentCFIComponentWithSpineIndex : function (spineIndex, packageDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        // Get the start node (itemref element) that references the content document\r\n        $itemRefStartNode = $($(\"spine\", packageDocument).children()[spineIndex]);\r\n\r\n        // Create the steps up to the top element of the package document (the \"package\" element)\r\n        packageDocCFIComponent = this.createCFIElementSteps($itemRefStartNode, \"package\", classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Append an !; this assumes that a CFI content document CFI component will be appended at some point\r\n        return packageDocCFIComponent + \"!\";\r\n    },\r\n\r\n    generateCompleteCFI : function (packageDocumentCFIComponent, contentDocumentCFIComponent) {\r\n\r\n        return \"epubcfi(\" + packageDocumentCFIComponent + contentDocumentCFIComponent + \")\";  \r\n    },\r\n\r\n    // ------------------------------------------------------------------------------------ //\r\n    //  \"PRIVATE\" HELPERS                                                                   //\r\n    // ------------------------------------------------------------------------------------ //\r\n\r\n    validateStartTextNode : function (startTextNode, characterOffset) {\r\n        \r\n        // Check that the text node to start from IS a text node\r\n        if (!startTextNode) {\r\n            throw new cfiRuntimeErrors.NodeTypeError(startTextNode, \"Cannot generate a character offset from a starting point that is not a text node\");\r\n        } else if (startTextNode.nodeType != 3) {\r\n            throw new cfiRuntimeErrors.NodeTypeError(startTextNode, \"Cannot generate a character offset from a starting point that is not a text node\");\r\n        }\r\n\r\n        // Check that the character offset is within a valid range for the text node supplied\r\n        if (characterOffset < 0) {\r\n            throw new cfiRuntimeErrors.OutOfRangeError(characterOffset, 0, \"Character offset cannot be less than 0\");\r\n        }\r\n        else if (characterOffset > startTextNode.nodeValue.length) {\r\n            throw new cfiRuntimeErrors.OutOfRangeError(characterOffset, startTextNode.nodeValue.length - 1, \"character offset cannot be greater than the length of the text node\");\r\n        }\r\n    },\r\n\r\n    validateStartElement : function (startElement) {\r\n\r\n        if (!startElement) {\r\n            throw new cfiRuntimeErrors.NodeTypeError(startElement, \"CFI target element is undefined\");\r\n        }\r\n\r\n        if (!(startElement.nodeType && startElement.nodeType === 1)) {\r\n            throw new cfiRuntimeErrors.NodeTypeError(startElement, \"CFI target element is not an HTML element\");\r\n        }\r\n    },\r\n\r\n    validateContentDocumentName : function (contentDocumentName) {\r\n\r\n        // Check that the idref for the content document has been provided\r\n        if (!contentDocumentName) {\r\n            throw new Error(\"The idref for the content document, as found in the spine, must be supplied\");\r\n        }\r\n    },\r\n\r\n    validatePackageDocument : function (packageDocument, contentDocumentName) {\r\n        \r\n        // Check that the package document is non-empty and contains an itemref element for the supplied idref\r\n        if (!packageDocument) {\r\n            throw new Error(\"A package document must be supplied to generate a CFI\");\r\n        }\r\n        else if ($($(\"itemref[idref='\" + contentDocumentName + \"']\", packageDocument)[0]).length === 0) {\r\n            throw new Error(\"The idref of the content document could not be found in the spine\");\r\n        }\r\n    },\r\n\r\n    // Description: Creates a CFI terminating step to a text node, with a character offset\r\n    // REFACTORING CANDIDATE: Some of the parts of this method could be refactored into their own methods\r\n    createCFITextNodeStep : function ($startTextNode, characterOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var $parentNode;\r\n        var $contentsExcludingMarkers;\r\n        var CFIIndex;\r\n        var indexOfTextNode;\r\n        var preAssertion;\r\n        var preAssertionStartIndex;\r\n        var textLength;\r\n        var postAssertion;\r\n        var postAssertionEndIndex;\r\n\r\n        // Find text node position in the set of child elements, ignoring any blacklisted elements \r\n        $parentNode = $startTextNode.parent();\r\n        $contentsExcludingMarkers = cfiInstructions.applyBlacklist($parentNode.contents(), classBlacklist, elementBlacklist, idBlacklist);\r\n\r\n        // Find the text node index in the parent list, inferring nodes that were originally a single text node\r\n        var prevNodeWasTextNode;\r\n        var indexOfFirstInSequence;\r\n        var textNodeOnlyIndex = 0;\r\n        var characterOffsetSinceUnsplit = 0;\r\n        var finalCharacterOffsetInSequence = 0;\r\n        $.each($contentsExcludingMarkers, \r\n            function (index) {\r\n\r\n            // If this is a text node, check if it matches and return the current index\r\n            if (this.nodeType === Node.TEXT_NODE || !prevNodeWasTextNode) {\r\n\r\n                if (this.nodeType === Node.TEXT_NODE) {\r\n                    if (this === $startTextNode[0]) {\r\n\r\n                        // Set index as the first in the adjacent sequence of text nodes, or as the index of the current node if this \r\n                        //   node is a standard one sandwiched between two element nodes. \r\n                        if (prevNodeWasTextNode) {\r\n                            indexOfTextNode = indexOfFirstInSequence;\r\n                            finalCharacterOffsetInSequence = characterOffsetSinceUnsplit;\r\n                        } else {\r\n                            indexOfTextNode = textNodeOnlyIndex;\r\n                        }\r\n                        \r\n                        // Break out of .each loop\r\n                        return false; \r\n                    }\r\n\r\n                    // Save this index as the first in sequence of adjacent text nodes, if it is not already set by this point\r\n                    prevNodeWasTextNode = true;\r\n                    characterOffsetSinceUnsplit = characterOffsetSinceUnsplit + this.length;\r\n                    if (indexOfFirstInSequence === undefined) {\r\n                        indexOfFirstInSequence = textNodeOnlyIndex;\r\n                        textNodeOnlyIndex = textNodeOnlyIndex + 1;\r\n                    }\r\n                } else if (this.nodeType === Node.ELEMENT_NODE) {\r\n                    textNodeOnlyIndex = textNodeOnlyIndex + 1;\r\n                } else if (this.nodeType === Node.COMMENT_NODE) {\r\n                    prevNodeWasTextNode = true;\r\n                    characterOffsetSinceUnsplit = characterOffsetSinceUnsplit + this.length + 7; // 7 is the size of the html comment tag <!--[comment]-->\r\n                    if (indexOfFirstInSequence === undefined) {\r\n                        indexOfFirstInSequence = textNodeOnlyIndex;\r\n                    }\r\n                } else if (this.nodeType === Node.PROCESSING_INSTRUCTION_NODE) {\r\n                    prevNodeWasTextNode = true;\r\n                    characterOffsetSinceUnsplit = characterOffsetSinceUnsplit + this.data.length + this.target.length + 5; // 5 is the size of the instruction processing tag including the required space between the target and the data <?[target] [data]?>\r\n                    if (indexOfFirstInSequence === undefined) {\r\n                        indexOfFirstInSequence = textNodeOnlyIndex;\r\n                    }\r\n                }\r\n            }\r\n            // This node is not a text node\r\n            else if (this.nodeType === Node.ELEMENT_NODE) {\r\n                prevNodeWasTextNode = false;\r\n                indexOfFirstInSequence = undefined;\r\n                characterOffsetSinceUnsplit  = 0;\r\n            } else if (this.nodeType === Node.COMMENT_NODE) {\r\n                characterOffsetSinceUnsplit = characterOffsetSinceUnsplit + this.length + 7; // <!--[comment]-->\r\n            } else if (this.nodeType === Node.PROCESSING_INSTRUCTION_NODE) {\r\n                characterOffsetSinceUnsplit = characterOffsetSinceUnsplit + this.data.length + this.target.length + 5; // <?[target] [data]?>\r\n            }\r\n        });\r\n\r\n        // Convert the text node index to a CFI odd-integer representation\r\n        CFIIndex = (indexOfTextNode * 2) + 1;\r\n\r\n        // TODO: text assertions are not in the grammar yet, I think, or they're just causing problems. This has\r\n        //   been temporarily removed. \r\n\r\n        // Add pre- and post- text assertions\r\n        // preAssertionStartIndex = (characterOffset - 3 >= 0) ? characterOffset - 3 : 0;\r\n        // preAssertion = $startTextNode[0].nodeValue.substring(preAssertionStartIndex, characterOffset);\r\n\r\n        // textLength = $startTextNode[0].nodeValue.length;\r\n        // postAssertionEndIndex = (characterOffset + 3 <= textLength) ? characterOffset + 3 : textLength;\r\n        // postAssertion = $startTextNode[0].nodeValue.substring(characterOffset, postAssertionEndIndex);\r\n\r\n        // Gotta infer the correct character offset, as well\r\n\r\n        // Return the constructed CFI text node step\r\n        return \"/\" + CFIIndex + \":\" + (finalCharacterOffsetInSequence + characterOffset);\r\n         // + \"[\" + preAssertion + \",\" + postAssertion + \"]\";\r\n    },\r\n\r\n    createCFIElementSteps : function ($currNode, topLevelElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n\r\n        var $blacklistExcluded;\r\n        var $parentNode;\r\n        var currNodePosition;\r\n        var CFIPosition;\r\n        var idAssertion;\r\n        var elementStep; \r\n\r\n        // Find position of current node in parent list\r\n        $blacklistExcluded = cfiInstructions.applyBlacklist($currNode.parent().children(), classBlacklist, elementBlacklist, idBlacklist);\r\n        $.each($blacklistExcluded, \r\n            function (index, value) {\r\n\r\n                if (this === $currNode[0]) {\r\n\r\n                    currNodePosition = index;\r\n\r\n                    // Break loop\r\n                    return false;\r\n                }\r\n        });\r\n\r\n        // Convert position to the CFI even-integer representation\r\n        CFIPosition = (currNodePosition + 1) * 2;\r\n\r\n        // Create CFI step with id assertion, if the element has an id\r\n        if ($currNode.attr(\"id\")) {\r\n            elementStep = \"/\" + CFIPosition + \"[\" + $currNode.attr(\"id\") + \"]\";\r\n        }\r\n        else {\r\n            elementStep = \"/\" + CFIPosition;\r\n        }\r\n\r\n        // If a parent is an html element return the (last) step for this content document, otherwise, continue.\r\n        //   Also need to check if the current node is the top-level element. This can occur if the start node is also the\r\n        //   top level element.\r\n        $parentNode = $currNode.parent();\r\n        if ($parentNode.is(topLevelElement) || $currNode.is(topLevelElement)) {\r\n            \r\n            // If the top level node is a type from which an indirection step, add an indirection step character (!)\r\n            // REFACTORING CANDIDATE: It is possible that this should be changed to: if (topLevelElement = 'package') do\r\n            //   not return an indirection character. Every other type of top-level element may require an indirection\r\n            //   step to navigate to, thus requiring that ! is always prepended. \r\n            if (topLevelElement === 'html') {\r\n                return \"!\" + elementStep;\r\n            }\r\n            else {\r\n                return elementStep;\r\n            }\r\n        }\r\n        else {\r\n            return this.createCFIElementSteps($parentNode, topLevelElement, classBlacklist, elementBlacklist, idBlacklist) + elementStep;\r\n        }\r\n    }\r\n};\r\n\r\nreturn obj;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (typeof define == 'function' && typeof define.amd == 'object') {\r\n    console.log(\"RequireJS ... cfi_generator\");\r\n    \r\n    define('cfi_generator',['jquery', './cfi_instructions', './cfi_runtime_errors'],\r\n    function ($, cfiInstructions, cfiRuntimeErrors) {\r\n        return init($, cfiInstructions, cfiRuntimeErrors);\r\n    });\r\n} else {\r\n    console.log(\"!RequireJS ... cfi_generator\");\r\n    \r\n    if (!global[\"EPUBcfi\"]) {\r\n        throw new Error(\"EPUBcfi not initialised on global object?! (window or this context)\");\r\n    }\r\n    global.EPUBcfi.Generator = \r\n    init($,\r\n        global.EPUBcfi.CFIInstructions,\r\n        {\r\n            NodeTypeError: global.EPUBcfi.NodeTypeError,\r\n            OutOfRangeError: global.EPUBcfi.OutOfRangeError,\r\n            TerminusError: global.EPUBcfi.TerminusError,\r\n            CFIAssertionError: global.EPUBcfi.CFIAssertionError\r\n        });\r\n}\r\n\r\n})(typeof window !== \"undefined\" ? window : this);\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\n(function(global) {\r\n\r\nvar init = function(cfiParser, cfiInterpreter, cfiInstructions, cfiRuntimeErrors, cfiGenerator) {\r\n    \r\n    if (typeof cfiParser === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiParser\");\r\n    }\r\n    \r\n    if (typeof cfiInterpreter === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiInterpreter\");\r\n    }\r\n    \r\n    if (typeof cfiInstructions === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiInstructions\");\r\n    }\r\n    \r\n    if (typeof cfiRuntimeErrors === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiRuntimeErrors\");\r\n    }\r\n    \r\n    if (typeof cfiGenerator === \"undefined\") {\r\n        throw new Error(\"UNDEFINED?! cfiGenerator\");\r\n    }\r\n    \r\n    var obj = {\r\n    \r\n        getContentDocHref : function (CFI, packageDocument) {\r\n            return cfiInterpreter.getContentDocHref(CFI, packageDocument);\r\n        },\r\n        injectElement : function (CFI, contentDocument, elementToInject, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiInterpreter.injectElement(CFI, contentDocument, elementToInject, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        getTargetElement : function (CFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiInterpreter.getTargetElement(CFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        getTargetElementWithPartialCFI : function (contentDocumentCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiInterpreter.getTargetElementWithPartialCFI(contentDocumentCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        injectRangeElements : function (rangeCFI, contentDocument, startElementToInject, endElementToInject, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiInterpreter.injectRangeElements(rangeCFI, contentDocument, startElementToInject, endElementToInject, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        getRangeTargetElements : function (rangeCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiInterpreter.getRangeTargetElements(rangeCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        isRangeCfi : function (cfi) {\r\n          return cfiInterpreter.isRangeCfi(cfi);\r\n        },\r\n        getTextTerminusInfoWithPartialCFI : function (contentDocumentCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiInterpreter.getTextTerminusInfoWithPartialCFI(contentDocumentCFI, contentDocument, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generateCharacterOffsetCFIComponent : function (startTextNode, characterOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generateCharacterOffsetCFIComponent(startTextNode, characterOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generateElementCFIComponent : function (startElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generateElementCFIComponent(startElement, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generatePackageDocumentCFIComponent : function (contentDocumentName, packageDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generatePackageDocumentCFIComponent(contentDocumentName, packageDocument, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generatePackageDocumentCFIComponentWithSpineIndex : function (spineIndex, packageDocument, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generatePackageDocumentCFIComponentWithSpineIndex(spineIndex, packageDocument, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generateCompleteCFI : function (packageDocumentCFIComponent, contentDocumentCFIComponent) {\r\n            return cfiGenerator.generateCompleteCFI(packageDocumentCFIComponent, contentDocumentCFIComponent);\r\n        },\r\n        generateCharOffsetRangeComponent : function (rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generateCharOffsetRangeComponent(rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generateElementRangeComponent : function (rangeStartElement, rangeEndElement, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generateElementRangeComponent(rangeStartElement, rangeEndElement, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        generateRangeComponent : function (rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist) {\r\n            return cfiGenerator.generateRangeComponent(rangeStartElement, startOffset, rangeEndElement, endOffset, classBlacklist, elementBlacklist, idBlacklist);\r\n        },\r\n        injectElementAtOffset : function ($textNodeList, textOffset, elementToInject) {\r\n            return cfiInstructions.injectCFIMarkerIntoText($textNodeList, textOffset, elementToInject);\r\n        }\r\n    };\r\n    \r\n    \r\n    // TODO: remove global (should not be necessary in properly-configured RequireJS build!)\r\n    // ...but we leave it here as a \"legacy\" mechanism to access the CFI lib functionality\r\n    // -----\r\n    obj.CFIInstructions = cfiInstructions;\r\n    obj.Parser = cfiParser;\r\n    obj.Interpreter = cfiInterpreter;\r\n    obj.Generator = cfiGenerator;\r\n    \r\n    obj.NodeTypeError= cfiRuntimeErrors.NodeTypeError;\r\n    obj.OutOfRangeError = cfiRuntimeErrors.OutOfRangeError;\r\n    obj.TerminusError = cfiRuntimeErrors.TerminusError;\r\n    obj.CFIAssertionError = cfiRuntimeErrors.CFIAssertionError;\r\n    \r\n    global.EPUBcfi = obj;\r\n    // -----\r\n    \r\n    console.log(\"#######################################\");\r\n    // console.log(global.EPUBcfi);\r\n    // console.log(\"#######################################\");\r\n    \r\n    return obj;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nif (typeof define == 'function' && typeof define.amd == 'object') {\r\n    console.log(\"RequireJS ... cfi_API\");\r\n    \r\n    define('cfi_API',['./cfi_parser', './cfi_interpreter', './cfi_instructions', './cfi_runtime_errors', './cfi_generator'],\r\n    function (cfiParser, cfiInterpreter, cfiInstructions, cfiRuntimeErrors, cfiGenerator) {\r\n        \r\n        return init(cfiParser, cfiInterpreter, cfiInstructions, cfiRuntimeErrors, cfiGenerator);\r\n    });\r\n} else {\r\n    console.log(\"!RequireJS ... cfi_API\");\r\n    \r\n    if (!global[\"EPUBcfi\"]) {\r\n        throw new Error(\"EPUBcfi not initialised on global object?! (window or this context)\");\r\n    }\r\n    \r\n    init(global.EPUBcfi.Parser,\r\n        global.EPUBcfi.Interpreter,\r\n        global.EPUBcfi.CFIInstructions,\r\n        {\r\n            NodeTypeError: global.EPUBcfi.NodeTypeError,\r\n            OutOfRangeError: global.EPUBcfi.OutOfRangeError,\r\n            TerminusError: global.EPUBcfi.TerminusError,\r\n            CFIAssertionError: global.EPUBcfi.CFIAssertionError\r\n        },\r\n        global.EPUBcfi.Generator);\r\n}\r\n\r\n})(typeof window !== \"undefined\" ? window : this);\r\n\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('readium-cfi-js',['cfi_API'], function (cfi) {\r\nreturn cfi;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epubCfi',['readium-cfi-js'], function (cfi) {\r\nreturn cfi;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/markup_parser',[],\r\n    function () {\r\n\r\n        var MarkupParser = function (){\r\n\r\n            var self = this;\r\n\r\n            this.parseXml = function(xmlString) {\r\n                return self.parseMarkup(xmlString, 'text/xml');\r\n            };\r\n\r\n            this.parseMarkup = function(markupString, contentType) {\r\n                var parser = new window.DOMParser;\r\n                return parser.parseFromString(markupString, contentType);\r\n            };\r\n\r\n        };\r\n\r\n        return MarkupParser;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/discover_content_type',['jquery', 'URIjs'], function ($, URI) {\r\n\r\n    var _instance = undefined;\r\n\r\n    var ContentTypeDiscovery = function() {\r\n\r\n        var self = this;\r\n\r\n        ContentTypeDiscovery.suffixContentTypeMap = {\r\n            css: 'text/css',\r\n            epub: 'application/epub+zip',\r\n            gif: 'image/gif',\r\n            html: 'text/html',\r\n            jpg: 'image/jpeg',\r\n            jpeg: 'image/jpeg',\r\n            ncx: 'application/x-dtbncx+xml',\r\n            opf: 'application/oebps-package+xml',\r\n            png: 'image/png',\r\n            svg: 'image/svg+xml',\r\n            xhtml: 'application/xhtml+xml'\r\n        };\r\n\r\n        this.identifyContentTypeFromFileName = function(contentUrl) {\r\n            var contentUrlSuffix = URI(contentUrl).suffix();\r\n            var contentType = 'application/octet-stream';\r\n            if (typeof ContentTypeDiscovery.suffixContentTypeMap[contentUrlSuffix] !== 'undefined') {\r\n                contentType = ContentTypeDiscovery.suffixContentTypeMap[contentUrlSuffix];\r\n            }\r\n            return contentType;\r\n        };\r\n\r\n        this.identifyContentType = function (contentUrl) {\r\n            // TODO: Make the call asynchronous (which would require a callback and would probably make sense\r\n            // when calling functions are also remodelled for async).\r\n\r\n            var contentType = $.ajax({\r\n                type: \"HEAD\",\r\n                url: contentUrl,\r\n                async: false\r\n            }).getResponseHeader('Content-Type');\r\n            if (contentType === null) {\r\n                contentType = self.identifyContentTypeFromFileName(contentUrl);\r\n                console.log('guessed contentType [' + contentType + '] from URI [' + contentUrl +\r\n                    ']. Configuring the web server to provide the content type is recommended.');\r\n\r\n            }\r\n\r\n            return contentType;\r\n        }\r\n\r\n    };\r\n\r\n    if(!_instance) {\r\n        _instance = new ContentTypeDiscovery();\r\n    }\r\n\r\n    return _instance;\r\n\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/plain_resource_fetcher',['jquery', 'URIjs', './discover_content_type'], function ($, URI, ContentTypeDiscovery) {\r\n\r\n    var PlainResourceFetcher = function(parentFetcher, baseUrl){\r\n\r\n        var self = this;\r\n        var _packageDocumentAbsoluteUrl;\r\n        var _packageDocumentRelativePath;\r\n\r\n        // INTERNAL FUNCTIONS\r\n\r\n        function fetchFileContents(pathRelativeToPackageRoot, readCallback, onerror) {\r\n            var fileUrl = self.resolveURI(pathRelativeToPackageRoot);\r\n\r\n            if (typeof pathRelativeToPackageRoot === 'undefined') {\r\n                throw 'Fetched file relative path is undefined!';\r\n            }\r\n\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open('GET', fileUrl, true);\r\n            xhr.responseType = 'arraybuffer';\r\n            xhr.onerror = onerror;\r\n\r\n            xhr.onload = function (loadEvent) {\r\n                readCallback(xhr.response);\r\n            };\r\n\r\n            xhr.send();\r\n        }\r\n\r\n\r\n        // PUBLIC API\r\n\r\n        this.initialize = function(callback) {\r\n\r\n            parentFetcher.getXmlFileDom('META-INF/container.xml', function (containerXmlDom) {\r\n                _packageDocumentRelativePath = parentFetcher.getRootFile(containerXmlDom);\r\n                _packageDocumentAbsoluteUrl = self.resolveURI(_packageDocumentRelativePath);\r\n\r\n                callback();\r\n\r\n            }, function(error) {\r\n                console.error(\"unable to find package document: \" + error);\r\n                _packageDocumentAbsoluteUrl = baseUrl;\r\n\r\n                callback();\r\n            });\r\n        };\r\n\r\n        this.resolveURI = function (pathRelativeToPackageRoot) {\r\n            return baseUrl + \"/\" + pathRelativeToPackageRoot;\r\n        };\r\n\r\n\r\n        this.getPackageUrl = function() {\r\n            return _packageDocumentAbsoluteUrl;\r\n        };\r\n\r\n        this.fetchFileContentsText = function(pathRelativeToPackageRoot, fetchCallback, onerror) {\r\n            var fileUrl = self.resolveURI(pathRelativeToPackageRoot);\r\n\r\n            if (typeof fileUrl === 'undefined') {\r\n                throw 'Fetched file URL is undefined!';\r\n            }\r\n            $.ajax({\r\n                // encoding: \"UTF-8\",\r\n                // mimeType: \"text/plain; charset=UTF-8\",\r\n                // beforeSend: function( xhr ) {\r\n                //     xhr.overrideMimeType(\"text/plain; charset=UTF-8\");\r\n                // },\r\n                isLocal: fileUrl.indexOf(\"http\") === 0 ? false : true,\r\n                url: fileUrl,\r\n                dataType: 'text', //https://api.jquery.com/jQuery.ajax/\r\n                async: true,\r\n                success: function (result) {\r\n                    fetchCallback(result);\r\n                },\r\n                error: function (xhr, status, errorThrown) {\r\n                    console.error('Error when AJAX fetching ' + fileUrl);\r\n                    console.error(status);\r\n                    console.error(errorThrown);\r\n\r\n                    // // isLocal = false with custom URI scheme / protocol results in false fail on Firefox (Chrome okay)\r\n                    // if (status === \"error\" && (!errorThrown || !errorThrown.length) && xhr.responseText && xhr.responseText.length)\r\n                    // {\r\n                    //     console.error(xhr);\r\n                    //     if (typeof xhr.getResponseHeader !== \"undefined\") console.error(xhr.getResponseHeader(\"Content-Type\"));\r\n                    //     if (typeof xhr.getAllResponseHeaders !== \"undefined\") console.error(xhr.getAllResponseHeaders());\r\n                    //     if (typeof xhr.responseText !== \"undefined\") console.error(xhr.responseText);\r\n                    //     \r\n                    //     // success\r\n                    //     fetchCallback(xhr.responseText);\r\n                    //     return;\r\n                    // }\r\n                    \r\n                    onerror(errorThrown);\r\n                }\r\n            });\r\n        };\r\n\r\n        this.fetchFileContentsBlob = function(pathRelativeToPackageRoot, fetchCallback, onerror) {\r\n\r\n            var decryptionFunction = parentFetcher.getDecryptionFunctionForRelativePath(pathRelativeToPackageRoot);\r\n            if (decryptionFunction) {\r\n                var origFetchCallback = fetchCallback;\r\n                fetchCallback = function (unencryptedBlob) {\r\n                    decryptionFunction(unencryptedBlob, function (decryptedBlob) {\r\n                        origFetchCallback(decryptedBlob);\r\n                    });\r\n                };\r\n            }\r\n            fetchFileContents(pathRelativeToPackageRoot, function (contentsArrayBuffer) {\r\n                var blob = new Blob([contentsArrayBuffer], {\r\n                    type: ContentTypeDiscovery.identifyContentTypeFromFileName(pathRelativeToPackageRoot)\r\n                });\r\n                fetchCallback(blob);\r\n            }, onerror);\r\n        };\r\n\r\n        this.getPackageDom = function (callback, onerror) {\r\n            self.fetchFileContentsText(_packageDocumentRelativePath, function (packageXml) {\r\n                var packageDom = parentFetcher.markupParser.parseXml(packageXml);\r\n                callback(packageDom);\r\n            }, onerror);\r\n        };\r\n\r\n    };\r\n\r\n    return PlainResourceFetcher;\r\n});\r\n\n",
    "/*\r\n Copyright (c) 2013 Gildas Lormeau. All rights reserved.\r\n\r\n Redistribution and use in source and binary forms, with or without\r\n modification, are permitted provided that the following conditions are met:\r\n\r\n 1. Redistributions of source code must retain the above copyright notice,\r\n this list of conditions and the following disclaimer.\r\n\r\n 2. Redistributions in binary form must reproduce the above copyright\r\n notice, this list of conditions and the following disclaimer in\r\n the documentation and/or other materials provided with the distribution.\r\n\r\n 3. The names of the authors may not be used to endorse or promote products\r\n derived from this software without specific prior written permission.\r\n\r\n THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\r\n INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\r\n INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\r\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\r\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\r\n OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\r\n LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\r\n NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\r\n EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n(function(obj) {\r\n\t\"use strict\";\r\n\r\n\tvar ERR_BAD_FORMAT = \"File format is not recognized.\";\r\n\tvar ERR_CRC = \"CRC failed.\";\r\n\tvar ERR_ENCRYPTED = \"File contains encrypted entry.\";\r\n\tvar ERR_ZIP64 = \"File is using Zip64 (4gb+ file size).\";\r\n\tvar ERR_READ = \"Error while reading zip file.\";\r\n\tvar ERR_WRITE = \"Error while writing zip file.\";\r\n\tvar ERR_WRITE_DATA = \"Error while writing file data.\";\r\n\tvar ERR_READ_DATA = \"Error while reading file data.\";\r\n\tvar ERR_DUPLICATED_NAME = \"File already exists.\";\r\n\tvar CHUNK_SIZE = 512 * 1024;\r\n\t\r\n\tvar TEXT_PLAIN = \"text/plain\";\r\n\r\n\tvar appendABViewSupported;\r\n\ttry {\r\n\t\tappendABViewSupported = new Blob([ new DataView(new ArrayBuffer(0)) ]).size === 0;\r\n\t} catch (e) {\r\n\t}\r\n\r\n\tfunction Crc32() {\r\n\t\tthis.crc = -1;\r\n\t}\r\n\tCrc32.prototype.append = function append(data) {\r\n\t\tvar crc = this.crc | 0, table = this.table;\r\n\t\tfor (var offset = 0, len = data.length | 0; offset < len; offset++)\r\n\t\t\tcrc = (crc >>> 8) ^ table[(crc ^ data[offset]) & 0xFF];\r\n\t\tthis.crc = crc;\r\n\t};\r\n\tCrc32.prototype.get = function get() {\r\n\t\treturn ~this.crc;\r\n\t};\r\n\tCrc32.prototype.table = (function() {\r\n\t\tvar i, j, t, table = []; // Uint32Array is actually slower than []\r\n\t\tfor (i = 0; i < 256; i++) {\r\n\t\t\tt = i;\r\n\t\t\tfor (j = 0; j < 8; j++)\r\n\t\t\t\tif (t & 1)\r\n\t\t\t\t\tt = (t >>> 1) ^ 0xEDB88320;\r\n\t\t\t\telse\r\n\t\t\t\t\tt = t >>> 1;\r\n\t\t\ttable[i] = t;\r\n\t\t}\r\n\t\treturn table;\r\n\t})();\r\n\t\r\n\t// \"no-op\" codec\r\n\tfunction NOOP() {}\r\n\tNOOP.prototype.append = function append(bytes, onprogress) {\r\n\t\treturn bytes;\r\n\t};\r\n\tNOOP.prototype.flush = function flush() {};\r\n\r\n\tfunction blobSlice(blob, index, length) {\r\n\t\tif (index < 0 || length < 0 || index + length > blob.size)\r\n\t\t\tthrow new RangeError('offset:' + index + ', length:' + length + ', size:' + blob.size);\r\n\t\tif (blob.slice)\r\n\t\t\treturn blob.slice(index, index + length);\r\n\t\telse if (blob.webkitSlice)\r\n\t\t\treturn blob.webkitSlice(index, index + length);\r\n\t\telse if (blob.mozSlice)\r\n\t\t\treturn blob.mozSlice(index, index + length);\r\n\t\telse if (blob.msSlice)\r\n\t\t\treturn blob.msSlice(index, index + length);\r\n\t}\r\n\r\n\tfunction getDataHelper(byteLength, bytes) {\r\n\t\tvar dataBuffer, dataArray;\r\n\t\tdataBuffer = new ArrayBuffer(byteLength);\r\n\t\tdataArray = new Uint8Array(dataBuffer);\r\n\t\tif (bytes)\r\n\t\t\tdataArray.set(bytes, 0);\r\n\t\treturn {\r\n\t\t\tbuffer : dataBuffer,\r\n\t\t\tarray : dataArray,\r\n\t\t\tview : new DataView(dataBuffer)\r\n\t\t};\r\n\t}\r\n\r\n\t// Readers\r\n\tfunction Reader() {\r\n\t}\r\n\r\n\tfunction TextReader(text) {\r\n\t\tvar that = this, blobReader;\r\n\r\n\t\tfunction init(callback, onerror) {\r\n\t\t\tvar blob = new Blob([ text ], {\r\n\t\t\t\ttype : TEXT_PLAIN\r\n\t\t\t});\r\n\t\t\tblobReader = new BlobReader(blob);\r\n\t\t\tblobReader.init(function() {\r\n\t\t\t\tthat.size = blobReader.size;\r\n\t\t\t\tcallback();\r\n\t\t\t}, onerror);\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback, onerror) {\r\n\t\t\tblobReader.readUint8Array(index, length, callback, onerror);\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tTextReader.prototype = new Reader();\r\n\tTextReader.prototype.constructor = TextReader;\r\n\r\n\tfunction Data64URIReader(dataURI) {\r\n\t\tvar that = this, dataStart;\r\n\r\n\t\tfunction init(callback) {\r\n\t\t\tvar dataEnd = dataURI.length;\r\n\t\t\twhile (dataURI.charAt(dataEnd - 1) == \"=\")\r\n\t\t\t\tdataEnd--;\r\n\t\t\tdataStart = dataURI.indexOf(\",\") + 1;\r\n\t\t\tthat.size = Math.floor((dataEnd - dataStart) * 0.75);\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback) {\r\n\t\t\tvar i, data = getDataHelper(length);\r\n\t\t\tvar start = Math.floor(index / 3) * 4;\r\n\t\t\tvar end = Math.ceil((index + length) / 3) * 4;\r\n\t\t\tvar bytes = obj.atob(dataURI.substring(start + dataStart, end + dataStart));\r\n\t\t\tvar delta = index - Math.floor(start / 4) * 3;\r\n\t\t\tfor (i = delta; i < delta + length; i++)\r\n\t\t\t\tdata.array[i - delta] = bytes.charCodeAt(i);\r\n\t\t\tcallback(data.array);\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tData64URIReader.prototype = new Reader();\r\n\tData64URIReader.prototype.constructor = Data64URIReader;\r\n\r\n\tfunction BlobReader(blob) {\r\n\t\tvar that = this;\r\n\r\n\t\tfunction init(callback) {\r\n\t\t\tthat.size = blob.size;\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback, onerror) {\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tcallback(new Uint8Array(e.target.result));\r\n\t\t\t};\r\n\t\t\treader.onerror = onerror;\r\n\t\t\ttry {\r\n\t\t\t\treader.readAsArrayBuffer(blobSlice(blob, index, length));\r\n\t\t\t} catch (e) {\r\n\t\t\t\tonerror(e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tBlobReader.prototype = new Reader();\r\n\tBlobReader.prototype.constructor = BlobReader;\r\n\r\n\t// Writers\r\n\r\n\tfunction Writer() {\r\n\t}\r\n\tWriter.prototype.getData = function(callback) {\r\n\t\tcallback(this.data);\r\n\t};\r\n\r\n\tfunction TextWriter(encoding) {\r\n\t\tvar that = this, blob;\r\n\r\n\t\tfunction init(callback) {\r\n\t\t\tblob = new Blob([], {\r\n\t\t\t\ttype : TEXT_PLAIN\r\n\t\t\t});\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction writeUint8Array(array, callback) {\r\n\t\t\tblob = new Blob([ blob, appendABViewSupported ? array : array.buffer ], {\r\n\t\t\t\ttype : TEXT_PLAIN\r\n\t\t\t});\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction getData(callback, onerror) {\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\treader.onload = function(e) {\r\n\t\t\t\tcallback(e.target.result);\r\n\t\t\t};\r\n\t\t\treader.onerror = onerror;\r\n\t\t\treader.readAsText(blob, encoding);\r\n\t\t}\r\n\r\n\t\tthat.init = init;\r\n\t\tthat.writeUint8Array = writeUint8Array;\r\n\t\tthat.getData = getData;\r\n\t}\r\n\tTextWriter.prototype = new Writer();\r\n\tTextWriter.prototype.constructor = TextWriter;\r\n\r\n\tfunction Data64URIWriter(contentType) {\r\n\t\tvar that = this, data = \"\", pending = \"\";\r\n\r\n\t\tfunction init(callback) {\r\n\t\t\tdata += \"data:\" + (contentType || \"\") + \";base64,\";\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction writeUint8Array(array, callback) {\r\n\t\t\tvar i, delta = pending.length, dataString = pending;\r\n\t\t\tpending = \"\";\r\n\t\t\tfor (i = 0; i < (Math.floor((delta + array.length) / 3) * 3) - delta; i++)\r\n\t\t\t\tdataString += String.fromCharCode(array[i]);\r\n\t\t\tfor (; i < array.length; i++)\r\n\t\t\t\tpending += String.fromCharCode(array[i]);\r\n\t\t\tif (dataString.length > 2)\r\n\t\t\t\tdata += obj.btoa(dataString);\r\n\t\t\telse\r\n\t\t\t\tpending = dataString;\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction getData(callback) {\r\n\t\t\tcallback(data + obj.btoa(pending));\r\n\t\t}\r\n\r\n\t\tthat.init = init;\r\n\t\tthat.writeUint8Array = writeUint8Array;\r\n\t\tthat.getData = getData;\r\n\t}\r\n\tData64URIWriter.prototype = new Writer();\r\n\tData64URIWriter.prototype.constructor = Data64URIWriter;\r\n\r\n\tfunction BlobWriter(contentType) {\r\n\t\tvar data = [], that = this;\r\n\r\n\t\tfunction init(callback) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction writeUint8Array(array, callback) {\r\n\t\t\tdata.push(appendABViewSupported ? array : array.buffer);\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction getData(callback) {\r\n\t\t\tcallback(new Blob(data, {type: contentType}));\r\n\t\t}\r\n\r\n\t\tthat.init = init;\r\n\t\tthat.writeUint8Array = writeUint8Array;\r\n\t\tthat.getData = getData;\r\n\t}\r\n\tBlobWriter.prototype = new Writer();\r\n\tBlobWriter.prototype.constructor = BlobWriter;\r\n\r\n\t/** \r\n\t * inflate/deflate core functions\r\n\t * @param worker {Worker} web worker for the task.\r\n\t * @param initialMessage {Object} initial message to be sent to the worker. should contain\r\n\t *   sn(serial number for distinguishing multiple tasks sent to the worker), and codecClass.\r\n\t *   This function may add more properties before sending.\r\n\t */\r\n\tfunction launchWorkerProcess(worker, initialMessage, reader, writer, offset, size, onprogress, onend, onreaderror, onwriteerror) {\r\n\t\tvar chunkIndex = 0, index, outputSize, sn = initialMessage.sn, crc;\r\n\r\n\t\tfunction onflush() {\r\n\t\t\tworker.removeEventListener('message', onmessage, false);\r\n\t\t\tonend(outputSize, crc);\r\n\t\t}\r\n\r\n\t\tfunction onmessage(event) {\r\n\t\t\tvar message = event.data, data = message.data, err = message.error;\r\n\t\t\tif (err) {\r\n\t\t\t\terr.toString = function () { return 'Error: ' + this.message; };\r\n\t\t\t\tonreaderror(err);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (message.sn !== sn)\r\n\t\t\t\treturn;\r\n\t\t\tif (typeof message.codecTime === 'number')\r\n\t\t\t\tworker.codecTime += message.codecTime; // should be before onflush()\r\n\t\t\tif (typeof message.crcTime === 'number')\r\n\t\t\t\tworker.crcTime += message.crcTime;\r\n\r\n\t\t\tswitch (message.type) {\r\n\t\t\t\tcase 'append':\r\n\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\toutputSize += data.length;\r\n\t\t\t\t\t\twriter.writeUint8Array(data, function() {\r\n\t\t\t\t\t\t\tstep();\r\n\t\t\t\t\t\t}, onwriteerror);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tstep();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'flush':\r\n\t\t\t\t\tcrc = message.crc;\r\n\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\toutputSize += data.length;\r\n\t\t\t\t\t\twriter.writeUint8Array(data, function() {\r\n\t\t\t\t\t\t\tonflush();\r\n\t\t\t\t\t\t}, onwriteerror);\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tonflush();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'progress':\r\n\t\t\t\t\tif (onprogress)\r\n\t\t\t\t\t\tonprogress(index + message.loaded, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'importScripts': //no need to handle here\r\n\t\t\t\tcase 'newTask':\r\n\t\t\t\tcase 'echo':\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('zip.js:launchWorkerProcess: unknown message: ', message);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction step() {\r\n\t\t\tindex = chunkIndex * CHUNK_SIZE;\r\n\t\t\tif (index < size) {\r\n\t\t\t\treader.readUint8Array(offset + index, Math.min(CHUNK_SIZE, size - index), function(array) {\r\n\t\t\t\t\tif (onprogress)\r\n\t\t\t\t\t\tonprogress(index, size);\r\n\t\t\t\t\tvar msg = index === 0 ? initialMessage : {sn : sn};\r\n\t\t\t\t\tmsg.type = 'append';\r\n\t\t\t\t\tmsg.data = array;\r\n\t\t\t\t\tworker.postMessage(msg, [array.buffer]);\r\n\t\t\t\t\tchunkIndex++;\r\n\t\t\t\t}, onreaderror);\r\n\t\t\t} else {\r\n\t\t\t\tworker.postMessage({\r\n\t\t\t\t\tsn: sn,\r\n\t\t\t\t\ttype: 'flush'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\toutputSize = 0;\r\n\t\tworker.addEventListener('message', onmessage, false);\r\n\t\tstep();\r\n\t}\r\n\r\n\tfunction launchProcess(process, reader, writer, offset, size, crcType, onprogress, onend, onreaderror, onwriteerror) {\r\n\t\tvar chunkIndex = 0, index, outputSize = 0,\r\n\t\t\tcrcInput = crcType === 'input',\r\n\t\t\tcrcOutput = crcType === 'output',\r\n\t\t\tcrc = new Crc32();\r\n\t\tfunction step() {\r\n\t\t\tvar outputData;\r\n\t\t\tindex = chunkIndex * CHUNK_SIZE;\r\n\t\t\tif (index < size)\r\n\t\t\t\treader.readUint8Array(offset + index, Math.min(CHUNK_SIZE, size - index), function(inputData) {\r\n\t\t\t\t\tvar outputData;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\toutputData = process.append(inputData, function(loaded) {\r\n\t\t\t\t\t\t\tif (onprogress)\r\n\t\t\t\t\t\t\t\tonprogress(index + loaded, size);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tonreaderror(e);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (outputData) {\r\n\t\t\t\t\t\toutputSize += outputData.length;\r\n\t\t\t\t\t\twriter.writeUint8Array(outputData, function() {\r\n\t\t\t\t\t\t\tchunkIndex++;\r\n\t\t\t\t\t\t\tsetTimeout(step, 1);\r\n\t\t\t\t\t\t}, onwriteerror);\r\n\t\t\t\t\t\tif (crcOutput)\r\n\t\t\t\t\t\t\tcrc.append(outputData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchunkIndex++;\r\n\t\t\t\t\t\tsetTimeout(step, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (crcInput)\r\n\t\t\t\t\t\tcrc.append(inputData);\r\n\t\t\t\t\tif (onprogress)\r\n\t\t\t\t\t\tonprogress(index, size);\r\n\t\t\t\t}, onreaderror);\r\n\t\t\telse {\r\n\t\t\t\ttry {\r\n\t\t\t\t\toutputData = process.flush();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tonreaderror(e);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (outputData) {\r\n\t\t\t\t\tif (crcOutput)\r\n\t\t\t\t\t\tcrc.append(outputData);\r\n\t\t\t\t\toutputSize += outputData.length;\r\n\t\t\t\t\twriter.writeUint8Array(outputData, function() {\r\n\t\t\t\t\t\tonend(outputSize, crc.get());\r\n\t\t\t\t\t}, onwriteerror);\r\n\t\t\t\t} else\r\n\t\t\t\t\tonend(outputSize, crc.get());\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstep();\r\n\t}\r\n\r\n\tfunction inflate(worker, sn, reader, writer, offset, size, computeCrc32, onend, onprogress, onreaderror, onwriteerror) {\r\n\t\tvar crcType = computeCrc32 ? 'output' : 'none';\r\n\t\tif (obj.zip.useWebWorkers) {\r\n\t\t\tvar initialMessage = {\r\n\t\t\t\tsn: sn,\r\n\t\t\t\tcodecClass: 'Inflater',\r\n\t\t\t\tcrcType: crcType,\r\n\t\t\t};\r\n\t\t\tlaunchWorkerProcess(worker, initialMessage, reader, writer, offset, size, onprogress, onend, onreaderror, onwriteerror);\r\n\t\t} else\r\n\t\t\tlaunchProcess(new obj.zip.Inflater(), reader, writer, offset, size, crcType, onprogress, onend, onreaderror, onwriteerror);\r\n\t}\r\n\r\n\tfunction deflate(worker, sn, reader, writer, level, onend, onprogress, onreaderror, onwriteerror) {\r\n\t\tvar crcType = 'input';\r\n\t\tif (obj.zip.useWebWorkers) {\r\n\t\t\tvar initialMessage = {\r\n\t\t\t\tsn: sn,\r\n\t\t\t\toptions: {level: level},\r\n\t\t\t\tcodecClass: 'Deflater',\r\n\t\t\t\tcrcType: crcType,\r\n\t\t\t};\r\n\t\t\tlaunchWorkerProcess(worker, initialMessage, reader, writer, 0, reader.size, onprogress, onend, onreaderror, onwriteerror);\r\n\t\t} else\r\n\t\t\tlaunchProcess(new obj.zip.Deflater(), reader, writer, 0, reader.size, crcType, onprogress, onend, onreaderror, onwriteerror);\r\n\t}\r\n\r\n\tfunction copy(worker, sn, reader, writer, offset, size, computeCrc32, onend, onprogress, onreaderror, onwriteerror) {\r\n\t\tvar crcType = 'input';\r\n\t\tif (obj.zip.useWebWorkers && computeCrc32) {\r\n\t\t\tvar initialMessage = {\r\n\t\t\t\tsn: sn,\r\n\t\t\t\tcodecClass: 'NOOP',\r\n\t\t\t\tcrcType: crcType,\r\n\t\t\t};\r\n\t\t\tlaunchWorkerProcess(worker, initialMessage, reader, writer, offset, size, onprogress, onend, onreaderror, onwriteerror);\r\n\t\t} else\r\n\t\t\tlaunchProcess(new NOOP(), reader, writer, offset, size, crcType, onprogress, onend, onreaderror, onwriteerror);\r\n\t}\r\n\r\n\t// ZipReader\r\n\r\n\tfunction decodeASCII(str) {\r\n\t\tvar i, out = \"\", charCode, extendedASCII = [ '\\u00C7', '\\u00FC', '\\u00E9', '\\u00E2', '\\u00E4', '\\u00E0', '\\u00E5', '\\u00E7', '\\u00EA', '\\u00EB',\r\n\t\t\t\t'\\u00E8', '\\u00EF', '\\u00EE', '\\u00EC', '\\u00C4', '\\u00C5', '\\u00C9', '\\u00E6', '\\u00C6', '\\u00F4', '\\u00F6', '\\u00F2', '\\u00FB', '\\u00F9',\r\n\t\t\t\t'\\u00FF', '\\u00D6', '\\u00DC', '\\u00F8', '\\u00A3', '\\u00D8', '\\u00D7', '\\u0192', '\\u00E1', '\\u00ED', '\\u00F3', '\\u00FA', '\\u00F1', '\\u00D1',\r\n\t\t\t\t'\\u00AA', '\\u00BA', '\\u00BF', '\\u00AE', '\\u00AC', '\\u00BD', '\\u00BC', '\\u00A1', '\\u00AB', '\\u00BB', '_', '_', '_', '\\u00A6', '\\u00A6',\r\n\t\t\t\t'\\u00C1', '\\u00C2', '\\u00C0', '\\u00A9', '\\u00A6', '\\u00A6', '+', '+', '\\u00A2', '\\u00A5', '+', '+', '-', '-', '+', '-', '+', '\\u00E3',\r\n\t\t\t\t'\\u00C3', '+', '+', '-', '-', '\\u00A6', '-', '+', '\\u00A4', '\\u00F0', '\\u00D0', '\\u00CA', '\\u00CB', '\\u00C8', 'i', '\\u00CD', '\\u00CE',\r\n\t\t\t\t'\\u00CF', '+', '+', '_', '_', '\\u00A6', '\\u00CC', '_', '\\u00D3', '\\u00DF', '\\u00D4', '\\u00D2', '\\u00F5', '\\u00D5', '\\u00B5', '\\u00FE',\r\n\t\t\t\t'\\u00DE', '\\u00DA', '\\u00DB', '\\u00D9', '\\u00FD', '\\u00DD', '\\u00AF', '\\u00B4', '\\u00AD', '\\u00B1', '_', '\\u00BE', '\\u00B6', '\\u00A7',\r\n\t\t\t\t'\\u00F7', '\\u00B8', '\\u00B0', '\\u00A8', '\\u00B7', '\\u00B9', '\\u00B3', '\\u00B2', '_', ' ' ];\r\n\t\tfor (i = 0; i < str.length; i++) {\r\n\t\t\tcharCode = str.charCodeAt(i) & 0xFF;\r\n\t\t\tif (charCode > 127)\r\n\t\t\t\tout += extendedASCII[charCode - 128];\r\n\t\t\telse\r\n\t\t\t\tout += String.fromCharCode(charCode);\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tfunction decodeUTF8(string) {\r\n\t\treturn decodeURIComponent(escape(string));\r\n\t}\r\n\r\n\tfunction getString(bytes) {\r\n\t\tvar i, str = \"\";\r\n\t\tfor (i = 0; i < bytes.length; i++)\r\n\t\t\tstr += String.fromCharCode(bytes[i]);\r\n\t\treturn str;\r\n\t}\r\n\r\n\tfunction getDate(timeRaw) {\r\n\t\tvar date = (timeRaw & 0xffff0000) >> 16, time = timeRaw & 0x0000ffff;\r\n\t\ttry {\r\n\t\t\treturn new Date(1980 + ((date & 0xFE00) >> 9), ((date & 0x01E0) >> 5) - 1, date & 0x001F, (time & 0xF800) >> 11, (time & 0x07E0) >> 5,\r\n\t\t\t\t\t(time & 0x001F) * 2, 0);\r\n\t\t} catch (e) {\r\n\t\t}\r\n\t}\r\n\r\n\tfunction readCommonHeader(entry, data, index, centralDirectory, onerror) {\r\n\t\tentry.version = data.view.getUint16(index, true);\r\n\t\tentry.bitFlag = data.view.getUint16(index + 2, true);\r\n\t\tentry.compressionMethod = data.view.getUint16(index + 4, true);\r\n\t\tentry.lastModDateRaw = data.view.getUint32(index + 6, true);\r\n\t\tentry.lastModDate = getDate(entry.lastModDateRaw);\r\n\t\tif ((entry.bitFlag & 0x01) === 0x01) {\r\n\t\t\tonerror(ERR_ENCRYPTED);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (centralDirectory || (entry.bitFlag & 0x0008) != 0x0008) {\r\n\t\t\tentry.crc32 = data.view.getUint32(index + 10, true);\r\n\t\t\tentry.compressedSize = data.view.getUint32(index + 14, true);\r\n\t\t\tentry.uncompressedSize = data.view.getUint32(index + 18, true);\r\n\t\t}\r\n\t\tif (entry.compressedSize === 0xFFFFFFFF || entry.uncompressedSize === 0xFFFFFFFF) {\r\n\t\t\tonerror(ERR_ZIP64);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tentry.filenameLength = data.view.getUint16(index + 22, true);\r\n\t\tentry.extraFieldLength = data.view.getUint16(index + 24, true);\r\n\t}\r\n\r\n\tfunction createZipReader(reader, callback, onerror) {\r\n\t\tvar inflateSN = 0;\r\n\r\n\t\tfunction Entry() {\r\n\t\t}\r\n\r\n\t\tEntry.prototype.getData = function(writer, onend, onprogress, checkCrc32) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tfunction testCrc32(crc32) {\r\n\t\t\t\tvar dataCrc32 = getDataHelper(4);\r\n\t\t\t\tdataCrc32.view.setUint32(0, crc32);\r\n\t\t\t\treturn that.crc32 == dataCrc32.view.getUint32(0);\r\n\t\t\t}\r\n\r\n\t\t\tfunction getWriterData(uncompressedSize, crc32) {\r\n\t\t\t\tif (checkCrc32 && !testCrc32(crc32))\r\n\t\t\t\t\tonerror(ERR_CRC);\r\n\t\t\t\telse\r\n\t\t\t\t\twriter.getData(function(data) {\r\n\t\t\t\t\t\tonend(data);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction onreaderror(err) {\r\n\t\t\t\tonerror(err || ERR_READ_DATA);\r\n\t\t\t}\r\n\r\n\t\t\tfunction onwriteerror(err) {\r\n\t\t\t\tonerror(err || ERR_WRITE_DATA);\r\n\t\t\t}\r\n\r\n\t\t\treader.readUint8Array(that.offset, 30, function(bytes) {\r\n\t\t\t\tvar data = getDataHelper(bytes.length, bytes), dataOffset;\r\n\t\t\t\tif (data.view.getUint32(0) != 0x504b0304) {\r\n\t\t\t\t\tonerror(ERR_BAD_FORMAT);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treadCommonHeader(that, data, 4, false, onerror);\r\n\t\t\t\tdataOffset = that.offset + 30 + that.filenameLength + that.extraFieldLength;\r\n\t\t\t\twriter.init(function() {\r\n\t\t\t\t\tif (that.compressionMethod === 0)\r\n\t\t\t\t\t\tcopy(that._worker, inflateSN++, reader, writer, dataOffset, that.compressedSize, checkCrc32, getWriterData, onprogress, onreaderror, onwriteerror);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tinflate(that._worker, inflateSN++, reader, writer, dataOffset, that.compressedSize, checkCrc32, getWriterData, onprogress, onreaderror, onwriteerror);\r\n\t\t\t\t}, onwriteerror);\r\n\t\t\t}, onreaderror);\r\n\t\t};\r\n\r\n\t\tfunction seekEOCDR(eocdrCallback) {\r\n\t\t\t// \"End of central directory record\" is the last part of a zip archive, and is at least 22 bytes long.\r\n\t\t\t// Zip file comment is the last part of EOCDR and has max length of 64KB,\r\n\t\t\t// so we only have to search the last 64K + 22 bytes of a archive for EOCDR signature (0x06054b50).\r\n\t\t\tvar EOCDR_MIN = 22;\r\n\t\t\tif (reader.size < EOCDR_MIN) {\r\n\t\t\t\tonerror(ERR_BAD_FORMAT);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar ZIP_COMMENT_MAX = 256 * 256, EOCDR_MAX = EOCDR_MIN + ZIP_COMMENT_MAX;\r\n\r\n\t\t\t// In most cases, the EOCDR is EOCDR_MIN bytes long\r\n\t\t\tdoSeek(EOCDR_MIN, function() {\r\n\t\t\t\t// If not found, try within EOCDR_MAX bytes\r\n\t\t\t\tdoSeek(Math.min(EOCDR_MAX, reader.size), function() {\r\n\t\t\t\t\tonerror(ERR_BAD_FORMAT);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// seek last length bytes of file for EOCDR\r\n\t\t\tfunction doSeek(length, eocdrNotFoundCallback) {\r\n\t\t\t\treader.readUint8Array(reader.size - length, length, function(bytes) {\r\n\t\t\t\t\tfor (var i = bytes.length - EOCDR_MIN; i >= 0; i--) {\r\n\t\t\t\t\t\tif (bytes[i] === 0x50 && bytes[i + 1] === 0x4b && bytes[i + 2] === 0x05 && bytes[i + 3] === 0x06) {\r\n\t\t\t\t\t\t\teocdrCallback(new DataView(bytes.buffer, i, EOCDR_MIN));\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\teocdrNotFoundCallback();\r\n\t\t\t\t}, function() {\r\n\t\t\t\t\tonerror(ERR_READ);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar zipReader = {\r\n\t\t\tgetEntries : function(callback) {\r\n\t\t\t\tvar worker = this._worker;\r\n\t\t\t\t// look for End of central directory record\r\n\t\t\t\tseekEOCDR(function(dataView) {\r\n\t\t\t\t\tvar datalength, fileslength;\r\n\t\t\t\t\tdatalength = dataView.getUint32(16, true);\r\n\t\t\t\t\tfileslength = dataView.getUint16(8, true);\r\n\t\t\t\t\tif (datalength < 0 || datalength >= reader.size) {\r\n\t\t\t\t\t\tonerror(ERR_BAD_FORMAT);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treader.readUint8Array(datalength, reader.size - datalength, function(bytes) {\r\n\t\t\t\t\t\tvar i, index = 0, entries = [], entry, filename, comment, data = getDataHelper(bytes.length, bytes);\r\n\t\t\t\t\t\tfor (i = 0; i < fileslength; i++) {\r\n\t\t\t\t\t\t\tentry = new Entry();\r\n\t\t\t\t\t\t\tentry._worker = worker;\r\n\t\t\t\t\t\t\tif (data.view.getUint32(index) != 0x504b0102) {\r\n\t\t\t\t\t\t\t\tonerror(ERR_BAD_FORMAT);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treadCommonHeader(entry, data, index + 6, true, onerror);\r\n\t\t\t\t\t\t\tentry.commentLength = data.view.getUint16(index + 32, true);\r\n\t\t\t\t\t\t\tentry.directory = ((data.view.getUint8(index + 38) & 0x10) == 0x10);\r\n\t\t\t\t\t\t\tentry.offset = data.view.getUint32(index + 42, true);\r\n\t\t\t\t\t\t\tfilename = getString(data.array.subarray(index + 46, index + 46 + entry.filenameLength));\r\n\t\t\t\t\t\t\tentry.filename = ((entry.bitFlag & 0x0800) === 0x0800) ? decodeUTF8(filename) : decodeASCII(filename);\r\n\t\t\t\t\t\t\tif (!entry.directory && entry.filename.charAt(entry.filename.length - 1) == \"/\")\r\n\t\t\t\t\t\t\t\tentry.directory = true;\r\n\t\t\t\t\t\t\tcomment = getString(data.array.subarray(index + 46 + entry.filenameLength + entry.extraFieldLength, index + 46\r\n\t\t\t\t\t\t\t\t\t+ entry.filenameLength + entry.extraFieldLength + entry.commentLength));\r\n\t\t\t\t\t\t\tentry.comment = ((entry.bitFlag & 0x0800) === 0x0800) ? decodeUTF8(comment) : decodeASCII(comment);\r\n\t\t\t\t\t\t\tentries.push(entry);\r\n\t\t\t\t\t\t\tindex += 46 + entry.filenameLength + entry.extraFieldLength + entry.commentLength;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcallback(entries);\r\n\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\tonerror(ERR_READ);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tclose : function(callback) {\r\n\t\t\t\tif (this._worker) {\r\n\t\t\t\t\tthis._worker.terminate();\r\n\t\t\t\t\tthis._worker = null;\r\n\t\t\t\t}\r\n\t\t\t\tif (callback)\r\n\t\t\t\t\tcallback();\r\n\t\t\t},\r\n\t\t\t_worker: null\r\n\t\t};\r\n\r\n\t\tif (!obj.zip.useWebWorkers)\r\n\t\t\tcallback(zipReader);\r\n\t\telse {\r\n\t\t\tcreateWorker('inflater',\r\n\t\t\t\tfunction(worker) {\r\n\t\t\t\t\tzipReader._worker = worker;\r\n\t\t\t\t\tcallback(zipReader);\r\n\t\t\t\t},\r\n\t\t\t\tfunction(err) {\r\n\t\t\t\t\tonerror(err);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t// ZipWriter\r\n\r\n\tfunction encodeUTF8(string) {\r\n\t\treturn unescape(encodeURIComponent(string));\r\n\t}\r\n\r\n\tfunction getBytes(str) {\r\n\t\tvar i, array = [];\r\n\t\tfor (i = 0; i < str.length; i++)\r\n\t\t\tarray.push(str.charCodeAt(i));\r\n\t\treturn array;\r\n\t}\r\n\r\n\tfunction createZipWriter(writer, callback, onerror, dontDeflate) {\r\n\t\tvar files = {}, filenames = [], datalength = 0;\r\n\t\tvar deflateSN = 0;\r\n\r\n\t\tfunction onwriteerror(err) {\r\n\t\t\tonerror(err || ERR_WRITE);\r\n\t\t}\r\n\r\n\t\tfunction onreaderror(err) {\r\n\t\t\tonerror(err || ERR_READ_DATA);\r\n\t\t}\r\n\r\n\t\tvar zipWriter = {\r\n\t\t\tadd : function(name, reader, onend, onprogress, options) {\r\n\t\t\t\tvar header, filename, date;\r\n\t\t\t\tvar worker = this._worker;\r\n\r\n\t\t\t\tfunction writeHeader(callback) {\r\n\t\t\t\t\tvar data;\r\n\t\t\t\t\tdate = options.lastModDate || new Date();\r\n\t\t\t\t\theader = getDataHelper(26);\r\n\t\t\t\t\tfiles[name] = {\r\n\t\t\t\t\t\theaderArray : header.array,\r\n\t\t\t\t\t\tdirectory : options.directory,\r\n\t\t\t\t\t\tfilename : filename,\r\n\t\t\t\t\t\toffset : datalength,\r\n\t\t\t\t\t\tcomment : getBytes(encodeUTF8(options.comment || \"\"))\r\n\t\t\t\t\t};\r\n\t\t\t\t\theader.view.setUint32(0, 0x14000808);\r\n\t\t\t\t\tif (options.version)\r\n\t\t\t\t\t\theader.view.setUint8(0, options.version);\r\n\t\t\t\t\tif (!dontDeflate && options.level !== 0 && !options.directory)\r\n\t\t\t\t\t\theader.view.setUint16(4, 0x0800);\r\n\t\t\t\t\theader.view.setUint16(6, (((date.getHours() << 6) | date.getMinutes()) << 5) | date.getSeconds() / 2, true);\r\n\t\t\t\t\theader.view.setUint16(8, ((((date.getFullYear() - 1980) << 4) | (date.getMonth() + 1)) << 5) | date.getDate(), true);\r\n\t\t\t\t\theader.view.setUint16(22, filename.length, true);\r\n\t\t\t\t\tdata = getDataHelper(30 + filename.length);\r\n\t\t\t\t\tdata.view.setUint32(0, 0x504b0304);\r\n\t\t\t\t\tdata.array.set(header.array, 4);\r\n\t\t\t\t\tdata.array.set(filename, 30);\r\n\t\t\t\t\tdatalength += data.array.length;\r\n\t\t\t\t\twriter.writeUint8Array(data.array, callback, onwriteerror);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction writeFooter(compressedLength, crc32) {\r\n\t\t\t\t\tvar footer = getDataHelper(16);\r\n\t\t\t\t\tdatalength += compressedLength || 0;\r\n\t\t\t\t\tfooter.view.setUint32(0, 0x504b0708);\r\n\t\t\t\t\tif (typeof crc32 != \"undefined\") {\r\n\t\t\t\t\t\theader.view.setUint32(10, crc32, true);\r\n\t\t\t\t\t\tfooter.view.setUint32(4, crc32, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (reader) {\r\n\t\t\t\t\t\tfooter.view.setUint32(8, compressedLength, true);\r\n\t\t\t\t\t\theader.view.setUint32(14, compressedLength, true);\r\n\t\t\t\t\t\tfooter.view.setUint32(12, reader.size, true);\r\n\t\t\t\t\t\theader.view.setUint32(18, reader.size, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\twriter.writeUint8Array(footer.array, function() {\r\n\t\t\t\t\t\tdatalength += 16;\r\n\t\t\t\t\t\tonend();\r\n\t\t\t\t\t}, onwriteerror);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction writeFile() {\r\n\t\t\t\t\toptions = options || {};\r\n\t\t\t\t\tname = name.trim();\r\n\t\t\t\t\tif (options.directory && name.charAt(name.length - 1) != \"/\")\r\n\t\t\t\t\t\tname += \"/\";\r\n\t\t\t\t\tif (files.hasOwnProperty(name)) {\r\n\t\t\t\t\t\tonerror(ERR_DUPLICATED_NAME);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfilename = getBytes(encodeUTF8(name));\r\n\t\t\t\t\tfilenames.push(name);\r\n\t\t\t\t\twriteHeader(function() {\r\n\t\t\t\t\t\tif (reader)\r\n\t\t\t\t\t\t\tif (dontDeflate || options.level === 0)\r\n\t\t\t\t\t\t\t\tcopy(worker, deflateSN++, reader, writer, 0, reader.size, true, writeFooter, onprogress, onreaderror, onwriteerror);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tdeflate(worker, deflateSN++, reader, writer, options.level, writeFooter, onprogress, onreaderror, onwriteerror);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\twriteFooter();\r\n\t\t\t\t\t}, onwriteerror);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (reader)\r\n\t\t\t\t\treader.init(writeFile, onreaderror);\r\n\t\t\t\telse\r\n\t\t\t\t\twriteFile();\r\n\t\t\t},\r\n\t\t\tclose : function(callback) {\r\n\t\t\t\tif (this._worker) {\r\n\t\t\t\t\tthis._worker.terminate();\r\n\t\t\t\t\tthis._worker = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar data, length = 0, index = 0, indexFilename, file;\r\n\t\t\t\tfor (indexFilename = 0; indexFilename < filenames.length; indexFilename++) {\r\n\t\t\t\t\tfile = files[filenames[indexFilename]];\r\n\t\t\t\t\tlength += 46 + file.filename.length + file.comment.length;\r\n\t\t\t\t}\r\n\t\t\t\tdata = getDataHelper(length + 22);\r\n\t\t\t\tfor (indexFilename = 0; indexFilename < filenames.length; indexFilename++) {\r\n\t\t\t\t\tfile = files[filenames[indexFilename]];\r\n\t\t\t\t\tdata.view.setUint32(index, 0x504b0102);\r\n\t\t\t\t\tdata.view.setUint16(index + 4, 0x1400);\r\n\t\t\t\t\tdata.array.set(file.headerArray, index + 6);\r\n\t\t\t\t\tdata.view.setUint16(index + 32, file.comment.length, true);\r\n\t\t\t\t\tif (file.directory)\r\n\t\t\t\t\t\tdata.view.setUint8(index + 38, 0x10);\r\n\t\t\t\t\tdata.view.setUint32(index + 42, file.offset, true);\r\n\t\t\t\t\tdata.array.set(file.filename, index + 46);\r\n\t\t\t\t\tdata.array.set(file.comment, index + 46 + file.filename.length);\r\n\t\t\t\t\tindex += 46 + file.filename.length + file.comment.length;\r\n\t\t\t\t}\r\n\t\t\t\tdata.view.setUint32(index, 0x504b0506);\r\n\t\t\t\tdata.view.setUint16(index + 8, filenames.length, true);\r\n\t\t\t\tdata.view.setUint16(index + 10, filenames.length, true);\r\n\t\t\t\tdata.view.setUint32(index + 12, length, true);\r\n\t\t\t\tdata.view.setUint32(index + 16, datalength, true);\r\n\t\t\t\twriter.writeUint8Array(data.array, function() {\r\n\t\t\t\t\twriter.getData(callback);\r\n\t\t\t\t}, onwriteerror);\r\n\t\t\t},\r\n\t\t\t_worker: null\r\n\t\t};\r\n\r\n\t\tif (!obj.zip.useWebWorkers)\r\n\t\t\tcallback(zipWriter);\r\n\t\telse {\r\n\t\t\tcreateWorker('deflater',\r\n\t\t\t\tfunction(worker) {\r\n\t\t\t\t\tzipWriter._worker = worker;\r\n\t\t\t\t\tcallback(zipWriter);\r\n\t\t\t\t},\r\n\t\t\t\tfunction(err) {\r\n\t\t\t\t\tonerror(err);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction resolveURLs(urls) {\r\n\t\tvar a = document.createElement('a');\r\n\t\treturn urls.map(function(url) {\r\n\t\t\ta.href = url;\r\n\t\t\treturn a.href;\r\n\t\t});\r\n\t}\r\n\r\n\tvar DEFAULT_WORKER_SCRIPTS = {\r\n\t\tdeflater: ['z-worker.js', 'deflate.js'],\r\n\t\tinflater: ['z-worker.js', 'inflate.js']\r\n\t};\r\n\tfunction createWorker(type, callback, onerror) {\r\n\t\tif (obj.zip.workerScripts !== null && obj.zip.workerScriptsPath !== null) {\r\n\t\t\tonerror(new Error('Either zip.workerScripts or zip.workerScriptsPath may be set, not both.'));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar scripts;\r\n\t\tif (obj.zip.workerScripts) {\r\n\t\t\tscripts = obj.zip.workerScripts[type];\r\n\t\t\tif (!Array.isArray(scripts)) {\r\n\t\t\t\tonerror(new Error('zip.workerScripts.' + type + ' is not an array!'));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tscripts = resolveURLs(scripts);\r\n\t\t} else {\r\n\t\t\tscripts = DEFAULT_WORKER_SCRIPTS[type].slice(0);\r\n\t\t\tscripts[0] = (obj.zip.workerScriptsPath || '') + scripts[0];\r\n\t\t}\r\n\t\tvar worker = new Worker(scripts[0]);\r\n\t\t// record total consumed time by inflater/deflater/crc32 in this worker\r\n\t\tworker.codecTime = worker.crcTime = 0;\r\n\t\tworker.postMessage({ type: 'importScripts', scripts: scripts.slice(1) });\r\n\t\tworker.addEventListener('message', onmessage);\r\n\t\tfunction onmessage(ev) {\r\n\t\t\tvar msg = ev.data;\r\n\t\t\tif (msg.error) {\r\n\t\t\t\tworker.terminate(); // should before onerror(), because onerror() may throw.\r\n\t\t\t\tonerror(msg.error);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (msg.type === 'importScripts') {\r\n\t\t\t\tworker.removeEventListener('message', onmessage);\r\n\t\t\t\tworker.removeEventListener('error', errorHandler);\r\n\t\t\t\tcallback(worker);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// catch entry script loading error and other unhandled errors\r\n\t\tworker.addEventListener('error', errorHandler);\r\n\t\tfunction errorHandler(err) {\r\n\t\t\tworker.terminate();\r\n\t\t\tonerror(err);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onerror_default(error) {\r\n\t\tconsole.error(error);\r\n\t}\r\n\tobj.zip = {\r\n\t\tReader : Reader,\r\n\t\tWriter : Writer,\r\n\t\tBlobReader : BlobReader,\r\n\t\tData64URIReader : Data64URIReader,\r\n\t\tTextReader : TextReader,\r\n\t\tBlobWriter : BlobWriter,\r\n\t\tData64URIWriter : Data64URIWriter,\r\n\t\tTextWriter : TextWriter,\r\n\t\tcreateReader : function(reader, callback, onerror) {\r\n\t\t\tonerror = onerror || onerror_default;\r\n\r\n\t\t\treader.init(function() {\r\n\t\t\t\tcreateZipReader(reader, callback, onerror);\r\n\t\t\t}, onerror);\r\n\t\t},\r\n\t\tcreateWriter : function(writer, callback, onerror, dontDeflate) {\r\n\t\t\tonerror = onerror || onerror_default;\r\n\t\t\tdontDeflate = !!dontDeflate;\r\n\r\n\t\t\twriter.init(function() {\r\n\t\t\t\tcreateZipWriter(writer, callback, onerror, dontDeflate);\r\n\t\t\t}, onerror);\r\n\t\t},\r\n\t\tuseWebWorkers : true,\r\n\t\t/**\r\n\t\t * Directory containing the default worker scripts (z-worker.js, deflate.js, and inflate.js), relative to current base url.\r\n\t\t * E.g.: zip.workerScripts = './';\r\n\t\t */\r\n\t\tworkerScriptsPath : null,\r\n\t\t/**\r\n\t\t * Advanced option to control which scripts are loaded in the Web worker. If this option is specified, then workerScriptsPath must not be set.\r\n\t\t * workerScripts.deflater/workerScripts.inflater should be arrays of urls to scripts for deflater/inflater, respectively.\r\n\t\t * Scripts in the array are executed in order, and the first one should be z-worker.js, which is used to start the worker.\r\n\t\t * All urls are relative to current base url.\r\n\t\t * E.g.:\r\n\t\t * zip.workerScripts = {\r\n\t\t *   deflater: ['z-worker.js', 'deflate.js'],\r\n\t\t *   inflater: ['z-worker.js', 'inflate.js']\r\n\t\t * };\r\n\t\t */\r\n\t\tworkerScripts : null,\r\n\t};\r\n\r\n})(this);\r\n\ndefine(\"zip\", (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.zip;\n    };\n}(this)));\n\n",
    "/*\r\n Copyright (c) 2013 Gildas Lormeau. All rights reserved.\r\n\r\n Redistribution and use in source and binary forms, with or without\r\n modification, are permitted provided that the following conditions are met:\r\n\r\n 1. Redistributions of source code must retain the above copyright notice,\r\n this list of conditions and the following disclaimer.\r\n\r\n 2. Redistributions in binary form must reproduce the above copyright \r\n notice, this list of conditions and the following disclaimer in \r\n the documentation and/or other materials provided with the distribution.\r\n\r\n 3. The names of the authors may not be used to endorse or promote products\r\n derived from this software without specific prior written permission.\r\n\r\n THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\r\n INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\r\n INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\r\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\r\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\r\n OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\r\n LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\r\n NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\r\n EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\tvar table = {\r\n\t\t\"application\" : {\r\n\t\t\t\"andrew-inset\" : \"ez\",\r\n\t\t\t\"annodex\" : \"anx\",\r\n\t\t\t\"atom+xml\" : \"atom\",\r\n\t\t\t\"atomcat+xml\" : \"atomcat\",\r\n\t\t\t\"atomserv+xml\" : \"atomsrv\",\r\n\t\t\t\"bbolin\" : \"lin\",\r\n\t\t\t\"cap\" : [ \"cap\", \"pcap\" ],\r\n\t\t\t\"cu-seeme\" : \"cu\",\r\n\t\t\t\"davmount+xml\" : \"davmount\",\r\n\t\t\t\"dsptype\" : \"tsp\",\r\n\t\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\r\n\t\t\t\"futuresplash\" : \"spl\",\r\n\t\t\t\"hta\" : \"hta\",\r\n\t\t\t\"java-archive\" : \"jar\",\r\n\t\t\t\"java-serialized-object\" : \"ser\",\r\n\t\t\t\"java-vm\" : \"class\",\r\n\t\t\t\"javascript\" : \"js\",\r\n\t\t\t\"m3g\" : \"m3g\",\r\n\t\t\t\"mac-binhex40\" : \"hqx\",\r\n\t\t\t\"mathematica\" : [ \"nb\", \"ma\", \"mb\" ],\r\n\t\t\t\"msaccess\" : \"mdb\",\r\n\t\t\t\"msword\" : [ \"doc\", \"dot\" ],\r\n\t\t\t\"mxf\" : \"mxf\",\r\n\t\t\t\"oda\" : \"oda\",\r\n\t\t\t\"ogg\" : \"ogx\",\r\n\t\t\t\"pdf\" : \"pdf\",\r\n\t\t\t\"pgp-keys\" : \"key\",\r\n\t\t\t\"pgp-signature\" : [ \"asc\", \"sig\" ],\r\n\t\t\t\"pics-rules\" : \"prf\",\r\n\t\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\r\n\t\t\t\"rar\" : \"rar\",\r\n\t\t\t\"rdf+xml\" : \"rdf\",\r\n\t\t\t\"rss+xml\" : \"rss\",\r\n\t\t\t\"rtf\" : \"rtf\",\r\n\t\t\t\"smil\" : [ \"smi\", \"smil\" ],\r\n\t\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\r\n\t\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\" ],\r\n\t\t\t\"xspf+xml\" : \"xspf\",\r\n\t\t\t\"zip\" : \"zip\",\r\n\t\t\t\"vnd.android.package-archive\" : \"apk\",\r\n\t\t\t\"vnd.cinderella\" : \"cdy\",\r\n\t\t\t\"vnd.google-earth.kml+xml\" : \"kml\",\r\n\t\t\t\"vnd.google-earth.kmz\" : \"kmz\",\r\n\t\t\t\"vnd.mozilla.xul+xml\" : \"xul\",\r\n\t\t\t\"vnd.ms-excel\" : [ \"xls\", \"xlb\", \"xlt\", \"xlm\", \"xla\", \"xlc\", \"xlw\" ],\r\n\t\t\t\"vnd.ms-pki.seccat\" : \"cat\",\r\n\t\t\t\"vnd.ms-pki.stl\" : \"stl\",\r\n\t\t\t\"vnd.ms-powerpoint\" : [ \"ppt\", \"pps\", \"pot\" ],\r\n\t\t\t\"vnd.oasis.opendocument.chart\" : \"odc\",\r\n\t\t\t\"vnd.oasis.opendocument.database\" : \"odb\",\r\n\t\t\t\"vnd.oasis.opendocument.formula\" : \"odf\",\r\n\t\t\t\"vnd.oasis.opendocument.graphics\" : \"odg\",\r\n\t\t\t\"vnd.oasis.opendocument.graphics-template\" : \"otg\",\r\n\t\t\t\"vnd.oasis.opendocument.image\" : \"odi\",\r\n\t\t\t\"vnd.oasis.opendocument.presentation\" : \"odp\",\r\n\t\t\t\"vnd.oasis.opendocument.presentation-template\" : \"otp\",\r\n\t\t\t\"vnd.oasis.opendocument.spreadsheet\" : \"ods\",\r\n\t\t\t\"vnd.oasis.opendocument.spreadsheet-template\" : \"ots\",\r\n\t\t\t\"vnd.oasis.opendocument.text\" : \"odt\",\r\n\t\t\t\"vnd.oasis.opendocument.text-master\" : \"odm\",\r\n\t\t\t\"vnd.oasis.opendocument.text-template\" : \"ott\",\r\n\t\t\t\"vnd.oasis.opendocument.text-web\" : \"oth\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.spreadsheetml.sheet\" : \"xlsx\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.spreadsheetml.template\" : \"xltx\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.presentationml.presentation\" : \"pptx\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.presentationml.slideshow\" : \"ppsx\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.presentationml.template\" : \"potx\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.wordprocessingml.document\" : \"docx\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.wordprocessingml.template\" : \"dotx\",\r\n\t\t\t\"vnd.smaf\" : \"mmf\",\r\n\t\t\t\"vnd.stardivision.calc\" : \"sdc\",\r\n\t\t\t\"vnd.stardivision.chart\" : \"sds\",\r\n\t\t\t\"vnd.stardivision.draw\" : \"sda\",\r\n\t\t\t\"vnd.stardivision.impress\" : \"sdd\",\r\n\t\t\t\"vnd.stardivision.math\" : [ \"sdf\", \"smf\" ],\r\n\t\t\t\"vnd.stardivision.writer\" : [ \"sdw\", \"vor\" ],\r\n\t\t\t\"vnd.stardivision.writer-global\" : \"sgl\",\r\n\t\t\t\"vnd.sun.xml.calc\" : \"sxc\",\r\n\t\t\t\"vnd.sun.xml.calc.template\" : \"stc\",\r\n\t\t\t\"vnd.sun.xml.draw\" : \"sxd\",\r\n\t\t\t\"vnd.sun.xml.draw.template\" : \"std\",\r\n\t\t\t\"vnd.sun.xml.impress\" : \"sxi\",\r\n\t\t\t\"vnd.sun.xml.impress.template\" : \"sti\",\r\n\t\t\t\"vnd.sun.xml.math\" : \"sxm\",\r\n\t\t\t\"vnd.sun.xml.writer\" : \"sxw\",\r\n\t\t\t\"vnd.sun.xml.writer.global\" : \"sxg\",\r\n\t\t\t\"vnd.sun.xml.writer.template\" : \"stw\",\r\n\t\t\t\"vnd.symbian.install\" : [ \"sis\", \"sisx\" ],\r\n\t\t\t\"vnd.visio\" : [ \"vsd\", \"vst\", \"vss\", \"vsw\" ],\r\n\t\t\t\"vnd.wap.wbxml\" : \"wbxml\",\r\n\t\t\t\"vnd.wap.wmlc\" : \"wmlc\",\r\n\t\t\t\"vnd.wap.wmlscriptc\" : \"wmlsc\",\r\n\t\t\t\"vnd.wordperfect\" : \"wpd\",\r\n\t\t\t\"vnd.wordperfect5.1\" : \"wp5\",\r\n\t\t\t\"x-123\" : \"wk\",\r\n\t\t\t\"x-7z-compressed\" : \"7z\",\r\n\t\t\t\"x-abiword\" : \"abw\",\r\n\t\t\t\"x-apple-diskimage\" : \"dmg\",\r\n\t\t\t\"x-bcpio\" : \"bcpio\",\r\n\t\t\t\"x-bittorrent\" : \"torrent\",\r\n\t\t\t\"x-cbr\" : [ \"cbr\", \"cba\", \"cbt\", \"cb7\" ],\r\n\t\t\t\"x-cbz\" : \"cbz\",\r\n\t\t\t\"x-cdf\" : [ \"cdf\", \"cda\" ],\r\n\t\t\t\"x-cdlink\" : \"vcd\",\r\n\t\t\t\"x-chess-pgn\" : \"pgn\",\r\n\t\t\t\"x-cpio\" : \"cpio\",\r\n\t\t\t\"x-csh\" : \"csh\",\r\n\t\t\t\"x-debian-package\" : [ \"deb\", \"udeb\" ],\r\n\t\t\t\"x-director\" : [ \"dcr\", \"dir\", \"dxr\", \"cst\", \"cct\", \"cxt\", \"w3d\", \"fgd\", \"swa\" ],\r\n\t\t\t\"x-dms\" : \"dms\",\r\n\t\t\t\"x-doom\" : \"wad\",\r\n\t\t\t\"x-dvi\" : \"dvi\",\r\n\t\t\t\"x-httpd-eruby\" : \"rhtml\",\r\n\t\t\t\"x-font\" : \"pcf.Z\",\r\n\t\t\t\"x-freemind\" : \"mm\",\r\n\t\t\t\"x-gnumeric\" : \"gnumeric\",\r\n\t\t\t\"x-go-sgf\" : \"sgf\",\r\n\t\t\t\"x-graphing-calculator\" : \"gcf\",\r\n\t\t\t\"x-gtar\" : [ \"gtar\", \"taz\" ],\r\n\t\t\t\"x-hdf\" : \"hdf\",\r\n\t\t\t\"x-httpd-php\" : [ \"phtml\", \"pht\", \"php\" ],\r\n\t\t\t\"x-httpd-php-source\" : \"phps\",\r\n\t\t\t\"x-httpd-php3\" : \"php3\",\r\n\t\t\t\"x-httpd-php3-preprocessed\" : \"php3p\",\r\n\t\t\t\"x-httpd-php4\" : \"php4\",\r\n\t\t\t\"x-httpd-php5\" : \"php5\",\r\n\t\t\t\"x-ica\" : \"ica\",\r\n\t\t\t\"x-info\" : \"info\",\r\n\t\t\t\"x-internet-signup\" : [ \"ins\", \"isp\" ],\r\n\t\t\t\"x-iphone\" : \"iii\",\r\n\t\t\t\"x-iso9660-image\" : \"iso\",\r\n\t\t\t\"x-java-jnlp-file\" : \"jnlp\",\r\n\t\t\t\"x-jmol\" : \"jmz\",\r\n\t\t\t\"x-killustrator\" : \"kil\",\r\n\t\t\t\"x-koan\" : [ \"skp\", \"skd\", \"skt\", \"skm\" ],\r\n\t\t\t\"x-kpresenter\" : [ \"kpr\", \"kpt\" ],\r\n\t\t\t\"x-kword\" : [ \"kwd\", \"kwt\" ],\r\n\t\t\t\"x-latex\" : \"latex\",\r\n\t\t\t\"x-lha\" : \"lha\",\r\n\t\t\t\"x-lyx\" : \"lyx\",\r\n\t\t\t\"x-lzh\" : \"lzh\",\r\n\t\t\t\"x-lzx\" : \"lzx\",\r\n\t\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\r\n\t\t\t\"x-ms-wmd\" : \"wmd\",\r\n\t\t\t\"x-ms-wmz\" : \"wmz\",\r\n\t\t\t\"x-msdos-program\" : [ \"com\", \"exe\", \"bat\", \"dll\" ],\r\n\t\t\t\"x-msi\" : \"msi\",\r\n\t\t\t\"x-netcdf\" : [ \"nc\", \"cdf\" ],\r\n\t\t\t\"x-ns-proxy-autoconfig\" : [ \"pac\", \"dat\" ],\r\n\t\t\t\"x-nwc\" : \"nwc\",\r\n\t\t\t\"x-object\" : \"o\",\r\n\t\t\t\"x-oz-application\" : \"oza\",\r\n\t\t\t\"x-pkcs7-certreqresp\" : \"p7r\",\r\n\t\t\t\"x-python-code\" : [ \"pyc\", \"pyo\" ],\r\n\t\t\t\"x-qgis\" : [ \"qgs\", \"shp\", \"shx\" ],\r\n\t\t\t\"x-quicktimeplayer\" : \"qtl\",\r\n\t\t\t\"x-redhat-package-manager\" : \"rpm\",\r\n\t\t\t\"x-ruby\" : \"rb\",\r\n\t\t\t\"x-sh\" : \"sh\",\r\n\t\t\t\"x-shar\" : \"shar\",\r\n\t\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\r\n\t\t\t\"x-silverlight\" : \"scr\",\r\n\t\t\t\"x-stuffit\" : \"sit\",\r\n\t\t\t\"x-sv4cpio\" : \"sv4cpio\",\r\n\t\t\t\"x-sv4crc\" : \"sv4crc\",\r\n\t\t\t\"x-tar\" : \"tar\",\r\n\t\t\t\"x-tcl\" : \"tcl\",\r\n\t\t\t\"x-tex-gf\" : \"gf\",\r\n\t\t\t\"x-tex-pk\" : \"pk\",\r\n\t\t\t\"x-texinfo\" : [ \"texinfo\", \"texi\" ],\r\n\t\t\t\"x-trash\" : [ \"~\", \"%\", \"bak\", \"old\", \"sik\" ],\r\n\t\t\t\"x-troff\" : [ \"t\", \"tr\", \"roff\" ],\r\n\t\t\t\"x-troff-man\" : \"man\",\r\n\t\t\t\"x-troff-me\" : \"me\",\r\n\t\t\t\"x-troff-ms\" : \"ms\",\r\n\t\t\t\"x-ustar\" : \"ustar\",\r\n\t\t\t\"x-wais-source\" : \"src\",\r\n\t\t\t\"x-wingz\" : \"wz\",\r\n\t\t\t\"x-x509-ca-cert\" : [ \"crt\", \"der\", \"cer\" ],\r\n\t\t\t\"x-xcf\" : \"xcf\",\r\n\t\t\t\"x-xfig\" : \"fig\",\r\n\t\t\t\"x-xpinstall\" : \"xpi\",\r\n\t\t\t\"applixware\" : \"aw\",\r\n\t\t\t\"atomsvc+xml\" : \"atomsvc\",\r\n\t\t\t\"ccxml+xml\" : \"ccxml\",\r\n\t\t\t\"cdmi-capability\" : \"cdmia\",\r\n\t\t\t\"cdmi-container\" : \"cdmic\",\r\n\t\t\t\"cdmi-domain\" : \"cdmid\",\r\n\t\t\t\"cdmi-object\" : \"cdmio\",\r\n\t\t\t\"cdmi-queue\" : \"cdmiq\",\r\n\t\t\t\"docbook+xml\" : \"dbk\",\r\n\t\t\t\"dssc+der\" : \"dssc\",\r\n\t\t\t\"dssc+xml\" : \"xdssc\",\r\n\t\t\t\"emma+xml\" : \"emma\",\r\n\t\t\t\"epub+zip\" : \"epub\",\r\n\t\t\t\"exi\" : \"exi\",\r\n\t\t\t\"font-tdpfr\" : \"pfr\",\r\n\t\t\t\"gml+xml\" : \"gml\",\r\n\t\t\t\"gpx+xml\" : \"gpx\",\r\n\t\t\t\"gxf\" : \"gxf\",\r\n\t\t\t\"hyperstudio\" : \"stk\",\r\n\t\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\r\n\t\t\t\"ipfix\" : \"ipfix\",\r\n\t\t\t\"json\" : \"json\",\r\n\t\t\t\"jsonml+json\" : \"jsonml\",\r\n\t\t\t\"lost+xml\" : \"lostxml\",\r\n\t\t\t\"mads+xml\" : \"mads\",\r\n\t\t\t\"marc\" : \"mrc\",\r\n\t\t\t\"marcxml+xml\" : \"mrcx\",\r\n\t\t\t\"mathml+xml\" : \"mathml\",\r\n\t\t\t\"mbox\" : \"mbox\",\r\n\t\t\t\"mediaservercontrol+xml\" : \"mscml\",\r\n\t\t\t\"metalink+xml\" : \"metalink\",\r\n\t\t\t\"metalink4+xml\" : \"meta4\",\r\n\t\t\t\"mets+xml\" : \"mets\",\r\n\t\t\t\"mods+xml\" : \"mods\",\r\n\t\t\t\"mp21\" : [ \"m21\", \"mp21\" ],\r\n\t\t\t\"mp4\" : \"mp4s\",\r\n\t\t\t\"oebps-package+xml\" : \"opf\",\r\n\t\t\t\"omdoc+xml\" : \"omdoc\",\r\n\t\t\t\"onenote\" : [ \"onetoc\", \"onetoc2\", \"onetmp\", \"onepkg\" ],\r\n\t\t\t\"oxps\" : \"oxps\",\r\n\t\t\t\"patch-ops-error+xml\" : \"xer\",\r\n\t\t\t\"pgp-encrypted\" : \"pgp\",\r\n\t\t\t\"pkcs10\" : \"p10\",\r\n\t\t\t\"pkcs7-mime\" : [ \"p7m\", \"p7c\" ],\r\n\t\t\t\"pkcs7-signature\" : \"p7s\",\r\n\t\t\t\"pkcs8\" : \"p8\",\r\n\t\t\t\"pkix-attr-cert\" : \"ac\",\r\n\t\t\t\"pkix-crl\" : \"crl\",\r\n\t\t\t\"pkix-pkipath\" : \"pkipath\",\r\n\t\t\t\"pkixcmp\" : \"pki\",\r\n\t\t\t\"pls+xml\" : \"pls\",\r\n\t\t\t\"prs.cww\" : \"cww\",\r\n\t\t\t\"pskc+xml\" : \"pskcxml\",\r\n\t\t\t\"reginfo+xml\" : \"rif\",\r\n\t\t\t\"relax-ng-compact-syntax\" : \"rnc\",\r\n\t\t\t\"resource-lists+xml\" : \"rl\",\r\n\t\t\t\"resource-lists-diff+xml\" : \"rld\",\r\n\t\t\t\"rls-services+xml\" : \"rs\",\r\n\t\t\t\"rpki-ghostbusters\" : \"gbr\",\r\n\t\t\t\"rpki-manifest\" : \"mft\",\r\n\t\t\t\"rpki-roa\" : \"roa\",\r\n\t\t\t\"rsd+xml\" : \"rsd\",\r\n\t\t\t\"sbml+xml\" : \"sbml\",\r\n\t\t\t\"scvp-cv-request\" : \"scq\",\r\n\t\t\t\"scvp-cv-response\" : \"scs\",\r\n\t\t\t\"scvp-vp-request\" : \"spq\",\r\n\t\t\t\"scvp-vp-response\" : \"spp\",\r\n\t\t\t\"sdp\" : \"sdp\",\r\n\t\t\t\"set-payment-initiation\" : \"setpay\",\r\n\t\t\t\"set-registration-initiation\" : \"setreg\",\r\n\t\t\t\"shf+xml\" : \"shf\",\r\n\t\t\t\"sparql-query\" : \"rq\",\r\n\t\t\t\"sparql-results+xml\" : \"srx\",\r\n\t\t\t\"srgs\" : \"gram\",\r\n\t\t\t\"srgs+xml\" : \"grxml\",\r\n\t\t\t\"sru+xml\" : \"sru\",\r\n\t\t\t\"ssdl+xml\" : \"ssdl\",\r\n\t\t\t\"ssml+xml\" : \"ssml\",\r\n\t\t\t\"tei+xml\" : [ \"tei\", \"teicorpus\" ],\r\n\t\t\t\"thraud+xml\" : \"tfi\",\r\n\t\t\t\"timestamped-data\" : \"tsd\",\r\n\t\t\t\"vnd.3gpp.pic-bw-large\" : \"plb\",\r\n\t\t\t\"vnd.3gpp.pic-bw-small\" : \"psb\",\r\n\t\t\t\"vnd.3gpp.pic-bw-var\" : \"pvb\",\r\n\t\t\t\"vnd.3gpp2.tcap\" : \"tcap\",\r\n\t\t\t\"vnd.3m.post-it-notes\" : \"pwn\",\r\n\t\t\t\"vnd.accpac.simply.aso\" : \"aso\",\r\n\t\t\t\"vnd.accpac.simply.imp\" : \"imp\",\r\n\t\t\t\"vnd.acucobol\" : \"acu\",\r\n\t\t\t\"vnd.acucorp\" : [ \"atc\", \"acutc\" ],\r\n\t\t\t\"vnd.adobe.air-application-installer-package+zip\" : \"air\",\r\n\t\t\t\"vnd.adobe.formscentral.fcdt\" : \"fcdt\",\r\n\t\t\t\"vnd.adobe.fxp\" : [ \"fxp\", \"fxpl\" ],\r\n\t\t\t\"vnd.adobe.xdp+xml\" : \"xdp\",\r\n\t\t\t\"vnd.adobe.xfdf\" : \"xfdf\",\r\n\t\t\t\"vnd.ahead.space\" : \"ahead\",\r\n\t\t\t\"vnd.airzip.filesecure.azf\" : \"azf\",\r\n\t\t\t\"vnd.airzip.filesecure.azs\" : \"azs\",\r\n\t\t\t\"vnd.amazon.ebook\" : \"azw\",\r\n\t\t\t\"vnd.americandynamics.acc\" : \"acc\",\r\n\t\t\t\"vnd.amiga.ami\" : \"ami\",\r\n\t\t\t\"vnd.anser-web-certificate-issue-initiation\" : \"cii\",\r\n\t\t\t\"vnd.anser-web-funds-transfer-initiation\" : \"fti\",\r\n\t\t\t\"vnd.antix.game-component\" : \"atx\",\r\n\t\t\t\"vnd.apple.installer+xml\" : \"mpkg\",\r\n\t\t\t\"vnd.apple.mpegurl\" : \"m3u8\",\r\n\t\t\t\"vnd.aristanetworks.swi\" : \"swi\",\r\n\t\t\t\"vnd.astraea-software.iota\" : \"iota\",\r\n\t\t\t\"vnd.audiograph\" : \"aep\",\r\n\t\t\t\"vnd.blueice.multipass\" : \"mpm\",\r\n\t\t\t\"vnd.bmi\" : \"bmi\",\r\n\t\t\t\"vnd.businessobjects\" : \"rep\",\r\n\t\t\t\"vnd.chemdraw+xml\" : \"cdxml\",\r\n\t\t\t\"vnd.chipnuts.karaoke-mmd\" : \"mmd\",\r\n\t\t\t\"vnd.claymore\" : \"cla\",\r\n\t\t\t\"vnd.cloanto.rp9\" : \"rp9\",\r\n\t\t\t\"vnd.clonk.c4group\" : [ \"c4g\", \"c4d\", \"c4f\", \"c4p\", \"c4u\" ],\r\n\t\t\t\"vnd.cluetrust.cartomobile-config\" : \"c11amc\",\r\n\t\t\t\"vnd.cluetrust.cartomobile-config-pkg\" : \"c11amz\",\r\n\t\t\t\"vnd.commonspace\" : \"csp\",\r\n\t\t\t\"vnd.contact.cmsg\" : \"cdbcmsg\",\r\n\t\t\t\"vnd.cosmocaller\" : \"cmc\",\r\n\t\t\t\"vnd.crick.clicker\" : \"clkx\",\r\n\t\t\t\"vnd.crick.clicker.keyboard\" : \"clkk\",\r\n\t\t\t\"vnd.crick.clicker.palette\" : \"clkp\",\r\n\t\t\t\"vnd.crick.clicker.template\" : \"clkt\",\r\n\t\t\t\"vnd.crick.clicker.wordbank\" : \"clkw\",\r\n\t\t\t\"vnd.criticaltools.wbs+xml\" : \"wbs\",\r\n\t\t\t\"vnd.ctc-posml\" : \"pml\",\r\n\t\t\t\"vnd.cups-ppd\" : \"ppd\",\r\n\t\t\t\"vnd.curl.car\" : \"car\",\r\n\t\t\t\"vnd.curl.pcurl\" : \"pcurl\",\r\n\t\t\t\"vnd.dart\" : \"dart\",\r\n\t\t\t\"vnd.data-vision.rdz\" : \"rdz\",\r\n\t\t\t\"vnd.dece.data\" : [ \"uvf\", \"uvvf\", \"uvd\", \"uvvd\" ],\r\n\t\t\t\"vnd.dece.ttml+xml\" : [ \"uvt\", \"uvvt\" ],\r\n\t\t\t\"vnd.dece.unspecified\" : [ \"uvx\", \"uvvx\" ],\r\n\t\t\t\"vnd.dece.zip\" : [ \"uvz\", \"uvvz\" ],\r\n\t\t\t\"vnd.denovo.fcselayout-link\" : \"fe_launch\",\r\n\t\t\t\"vnd.dna\" : \"dna\",\r\n\t\t\t\"vnd.dolby.mlp\" : \"mlp\",\r\n\t\t\t\"vnd.dpgraph\" : \"dpg\",\r\n\t\t\t\"vnd.dreamfactory\" : \"dfac\",\r\n\t\t\t\"vnd.ds-keypoint\" : \"kpxx\",\r\n\t\t\t\"vnd.dvb.ait\" : \"ait\",\r\n\t\t\t\"vnd.dvb.service\" : \"svc\",\r\n\t\t\t\"vnd.dynageo\" : \"geo\",\r\n\t\t\t\"vnd.ecowin.chart\" : \"mag\",\r\n\t\t\t\"vnd.enliven\" : \"nml\",\r\n\t\t\t\"vnd.epson.esf\" : \"esf\",\r\n\t\t\t\"vnd.epson.msf\" : \"msf\",\r\n\t\t\t\"vnd.epson.quickanime\" : \"qam\",\r\n\t\t\t\"vnd.epson.salt\" : \"slt\",\r\n\t\t\t\"vnd.epson.ssf\" : \"ssf\",\r\n\t\t\t\"vnd.eszigno3+xml\" : [ \"es3\", \"et3\" ],\r\n\t\t\t\"vnd.ezpix-album\" : \"ez2\",\r\n\t\t\t\"vnd.ezpix-package\" : \"ez3\",\r\n\t\t\t\"vnd.fdf\" : \"fdf\",\r\n\t\t\t\"vnd.fdsn.mseed\" : \"mseed\",\r\n\t\t\t\"vnd.fdsn.seed\" : [ \"seed\", \"dataless\" ],\r\n\t\t\t\"vnd.flographit\" : \"gph\",\r\n\t\t\t\"vnd.fluxtime.clip\" : \"ftc\",\r\n\t\t\t\"vnd.framemaker\" : [ \"fm\", \"frame\", \"maker\", \"book\" ],\r\n\t\t\t\"vnd.frogans.fnc\" : \"fnc\",\r\n\t\t\t\"vnd.frogans.ltf\" : \"ltf\",\r\n\t\t\t\"vnd.fsc.weblaunch\" : \"fsc\",\r\n\t\t\t\"vnd.fujitsu.oasys\" : \"oas\",\r\n\t\t\t\"vnd.fujitsu.oasys2\" : \"oa2\",\r\n\t\t\t\"vnd.fujitsu.oasys3\" : \"oa3\",\r\n\t\t\t\"vnd.fujitsu.oasysgp\" : \"fg5\",\r\n\t\t\t\"vnd.fujitsu.oasysprs\" : \"bh2\",\r\n\t\t\t\"vnd.fujixerox.ddd\" : \"ddd\",\r\n\t\t\t\"vnd.fujixerox.docuworks\" : \"xdw\",\r\n\t\t\t\"vnd.fujixerox.docuworks.binder\" : \"xbd\",\r\n\t\t\t\"vnd.fuzzysheet\" : \"fzs\",\r\n\t\t\t\"vnd.genomatix.tuxedo\" : \"txd\",\r\n\t\t\t\"vnd.geogebra.file\" : \"ggb\",\r\n\t\t\t\"vnd.geogebra.tool\" : \"ggt\",\r\n\t\t\t\"vnd.geometry-explorer\" : [ \"gex\", \"gre\" ],\r\n\t\t\t\"vnd.geonext\" : \"gxt\",\r\n\t\t\t\"vnd.geoplan\" : \"g2w\",\r\n\t\t\t\"vnd.geospace\" : \"g3w\",\r\n\t\t\t\"vnd.gmx\" : \"gmx\",\r\n\t\t\t\"vnd.grafeq\" : [ \"gqf\", \"gqs\" ],\r\n\t\t\t\"vnd.groove-account\" : \"gac\",\r\n\t\t\t\"vnd.groove-help\" : \"ghf\",\r\n\t\t\t\"vnd.groove-identity-message\" : \"gim\",\r\n\t\t\t\"vnd.groove-injector\" : \"grv\",\r\n\t\t\t\"vnd.groove-tool-message\" : \"gtm\",\r\n\t\t\t\"vnd.groove-tool-template\" : \"tpl\",\r\n\t\t\t\"vnd.groove-vcard\" : \"vcg\",\r\n\t\t\t\"vnd.hal+xml\" : \"hal\",\r\n\t\t\t\"vnd.handheld-entertainment+xml\" : \"zmm\",\r\n\t\t\t\"vnd.hbci\" : \"hbci\",\r\n\t\t\t\"vnd.hhe.lesson-player\" : \"les\",\r\n\t\t\t\"vnd.hp-hpgl\" : \"hpgl\",\r\n\t\t\t\"vnd.hp-hpid\" : \"hpid\",\r\n\t\t\t\"vnd.hp-hps\" : \"hps\",\r\n\t\t\t\"vnd.hp-jlyt\" : \"jlt\",\r\n\t\t\t\"vnd.hp-pcl\" : \"pcl\",\r\n\t\t\t\"vnd.hp-pclxl\" : \"pclxl\",\r\n\t\t\t\"vnd.hydrostatix.sof-data\" : \"sfd-hdstx\",\r\n\t\t\t\"vnd.ibm.minipay\" : \"mpy\",\r\n\t\t\t\"vnd.ibm.modcap\" : [ \"afp\", \"listafp\", \"list3820\" ],\r\n\t\t\t\"vnd.ibm.rights-management\" : \"irm\",\r\n\t\t\t\"vnd.ibm.secure-container\" : \"sc\",\r\n\t\t\t\"vnd.iccprofile\" : [ \"icc\", \"icm\" ],\r\n\t\t\t\"vnd.igloader\" : \"igl\",\r\n\t\t\t\"vnd.immervision-ivp\" : \"ivp\",\r\n\t\t\t\"vnd.immervision-ivu\" : \"ivu\",\r\n\t\t\t\"vnd.insors.igm\" : \"igm\",\r\n\t\t\t\"vnd.intercon.formnet\" : [ \"xpw\", \"xpx\" ],\r\n\t\t\t\"vnd.intergeo\" : \"i2g\",\r\n\t\t\t\"vnd.intu.qbo\" : \"qbo\",\r\n\t\t\t\"vnd.intu.qfx\" : \"qfx\",\r\n\t\t\t\"vnd.ipunplugged.rcprofile\" : \"rcprofile\",\r\n\t\t\t\"vnd.irepository.package+xml\" : \"irp\",\r\n\t\t\t\"vnd.is-xpr\" : \"xpr\",\r\n\t\t\t\"vnd.isac.fcs\" : \"fcs\",\r\n\t\t\t\"vnd.jam\" : \"jam\",\r\n\t\t\t\"vnd.jcp.javame.midlet-rms\" : \"rms\",\r\n\t\t\t\"vnd.jisp\" : \"jisp\",\r\n\t\t\t\"vnd.joost.joda-archive\" : \"joda\",\r\n\t\t\t\"vnd.kahootz\" : [ \"ktz\", \"ktr\" ],\r\n\t\t\t\"vnd.kde.karbon\" : \"karbon\",\r\n\t\t\t\"vnd.kde.kchart\" : \"chrt\",\r\n\t\t\t\"vnd.kde.kformula\" : \"kfo\",\r\n\t\t\t\"vnd.kde.kivio\" : \"flw\",\r\n\t\t\t\"vnd.kde.kontour\" : \"kon\",\r\n\t\t\t\"vnd.kde.kpresenter\" : [ \"kpr\", \"kpt\" ],\r\n\t\t\t\"vnd.kde.kspread\" : \"ksp\",\r\n\t\t\t\"vnd.kde.kword\" : [ \"kwd\", \"kwt\" ],\r\n\t\t\t\"vnd.kenameaapp\" : \"htke\",\r\n\t\t\t\"vnd.kidspiration\" : \"kia\",\r\n\t\t\t\"vnd.kinar\" : [ \"kne\", \"knp\" ],\r\n\t\t\t\"vnd.koan\" : [ \"skp\", \"skd\", \"skt\", \"skm\" ],\r\n\t\t\t\"vnd.kodak-descriptor\" : \"sse\",\r\n\t\t\t\"vnd.las.las+xml\" : \"lasxml\",\r\n\t\t\t\"vnd.llamagraphics.life-balance.desktop\" : \"lbd\",\r\n\t\t\t\"vnd.llamagraphics.life-balance.exchange+xml\" : \"lbe\",\r\n\t\t\t\"vnd.lotus-1-2-3\" : \"123\",\r\n\t\t\t\"vnd.lotus-approach\" : \"apr\",\r\n\t\t\t\"vnd.lotus-freelance\" : \"pre\",\r\n\t\t\t\"vnd.lotus-notes\" : \"nsf\",\r\n\t\t\t\"vnd.lotus-organizer\" : \"org\",\r\n\t\t\t\"vnd.lotus-screencam\" : \"scm\",\r\n\t\t\t\"vnd.lotus-wordpro\" : \"lwp\",\r\n\t\t\t\"vnd.macports.portpkg\" : \"portpkg\",\r\n\t\t\t\"vnd.mcd\" : \"mcd\",\r\n\t\t\t\"vnd.medcalcdata\" : \"mc1\",\r\n\t\t\t\"vnd.mediastation.cdkey\" : \"cdkey\",\r\n\t\t\t\"vnd.mfer\" : \"mwf\",\r\n\t\t\t\"vnd.mfmp\" : \"mfm\",\r\n\t\t\t\"vnd.micrografx.flo\" : \"flo\",\r\n\t\t\t\"vnd.micrografx.igx\" : \"igx\",\r\n\t\t\t\"vnd.mif\" : \"mif\",\r\n\t\t\t\"vnd.mobius.daf\" : \"daf\",\r\n\t\t\t\"vnd.mobius.dis\" : \"dis\",\r\n\t\t\t\"vnd.mobius.mbk\" : \"mbk\",\r\n\t\t\t\"vnd.mobius.mqy\" : \"mqy\",\r\n\t\t\t\"vnd.mobius.msl\" : \"msl\",\r\n\t\t\t\"vnd.mobius.plc\" : \"plc\",\r\n\t\t\t\"vnd.mobius.txf\" : \"txf\",\r\n\t\t\t\"vnd.mophun.application\" : \"mpn\",\r\n\t\t\t\"vnd.mophun.certificate\" : \"mpc\",\r\n\t\t\t\"vnd.ms-artgalry\" : \"cil\",\r\n\t\t\t\"vnd.ms-cab-compressed\" : \"cab\",\r\n\t\t\t\"vnd.ms-excel.addin.macroenabled.12\" : \"xlam\",\r\n\t\t\t\"vnd.ms-excel.sheet.binary.macroenabled.12\" : \"xlsb\",\r\n\t\t\t\"vnd.ms-excel.sheet.macroenabled.12\" : \"xlsm\",\r\n\t\t\t\"vnd.ms-excel.template.macroenabled.12\" : \"xltm\",\r\n\t\t\t\"vnd.ms-fontobject\" : \"eot\",\r\n\t\t\t\"vnd.ms-htmlhelp\" : \"chm\",\r\n\t\t\t\"vnd.ms-ims\" : \"ims\",\r\n\t\t\t\"vnd.ms-lrm\" : \"lrm\",\r\n\t\t\t\"vnd.ms-officetheme\" : \"thmx\",\r\n\t\t\t\"vnd.ms-powerpoint.addin.macroenabled.12\" : \"ppam\",\r\n\t\t\t\"vnd.ms-powerpoint.presentation.macroenabled.12\" : \"pptm\",\r\n\t\t\t\"vnd.ms-powerpoint.slide.macroenabled.12\" : \"sldm\",\r\n\t\t\t\"vnd.ms-powerpoint.slideshow.macroenabled.12\" : \"ppsm\",\r\n\t\t\t\"vnd.ms-powerpoint.template.macroenabled.12\" : \"potm\",\r\n\t\t\t\"vnd.ms-project\" : [ \"mpp\", \"mpt\" ],\r\n\t\t\t\"vnd.ms-word.document.macroenabled.12\" : \"docm\",\r\n\t\t\t\"vnd.ms-word.template.macroenabled.12\" : \"dotm\",\r\n\t\t\t\"vnd.ms-works\" : [ \"wps\", \"wks\", \"wcm\", \"wdb\" ],\r\n\t\t\t\"vnd.ms-wpl\" : \"wpl\",\r\n\t\t\t\"vnd.ms-xpsdocument\" : \"xps\",\r\n\t\t\t\"vnd.mseq\" : \"mseq\",\r\n\t\t\t\"vnd.musician\" : \"mus\",\r\n\t\t\t\"vnd.muvee.style\" : \"msty\",\r\n\t\t\t\"vnd.mynfc\" : \"taglet\",\r\n\t\t\t\"vnd.neurolanguage.nlu\" : \"nlu\",\r\n\t\t\t\"vnd.nitf\" : [ \"ntf\", \"nitf\" ],\r\n\t\t\t\"vnd.noblenet-directory\" : \"nnd\",\r\n\t\t\t\"vnd.noblenet-sealer\" : \"nns\",\r\n\t\t\t\"vnd.noblenet-web\" : \"nnw\",\r\n\t\t\t\"vnd.nokia.n-gage.data\" : \"ngdat\",\r\n\t\t\t\"vnd.nokia.n-gage.symbian.install\" : \"n-gage\",\r\n\t\t\t\"vnd.nokia.radio-preset\" : \"rpst\",\r\n\t\t\t\"vnd.nokia.radio-presets\" : \"rpss\",\r\n\t\t\t\"vnd.novadigm.edm\" : \"edm\",\r\n\t\t\t\"vnd.novadigm.edx\" : \"edx\",\r\n\t\t\t\"vnd.novadigm.ext\" : \"ext\",\r\n\t\t\t\"vnd.oasis.opendocument.chart-template\" : \"otc\",\r\n\t\t\t\"vnd.oasis.opendocument.formula-template\" : \"odft\",\r\n\t\t\t\"vnd.oasis.opendocument.image-template\" : \"oti\",\r\n\t\t\t\"vnd.olpc-sugar\" : \"xo\",\r\n\t\t\t\"vnd.oma.dd2+xml\" : \"dd2\",\r\n\t\t\t\"vnd.openofficeorg.extension\" : \"oxt\",\r\n\t\t\t\"vnd.openxmlformats-officedocument.presentationml.slide\" : \"sldx\",\r\n\t\t\t\"vnd.osgeo.mapguide.package\" : \"mgp\",\r\n\t\t\t\"vnd.osgi.dp\" : \"dp\",\r\n\t\t\t\"vnd.osgi.subsystem\" : \"esa\",\r\n\t\t\t\"vnd.palm\" : [ \"pdb\", \"pqa\", \"oprc\" ],\r\n\t\t\t\"vnd.pawaafile\" : \"paw\",\r\n\t\t\t\"vnd.pg.format\" : \"str\",\r\n\t\t\t\"vnd.pg.osasli\" : \"ei6\",\r\n\t\t\t\"vnd.picsel\" : \"efif\",\r\n\t\t\t\"vnd.pmi.widget\" : \"wg\",\r\n\t\t\t\"vnd.pocketlearn\" : \"plf\",\r\n\t\t\t\"vnd.powerbuilder6\" : \"pbd\",\r\n\t\t\t\"vnd.previewsystems.box\" : \"box\",\r\n\t\t\t\"vnd.proteus.magazine\" : \"mgz\",\r\n\t\t\t\"vnd.publishare-delta-tree\" : \"qps\",\r\n\t\t\t\"vnd.pvi.ptid1\" : \"ptid\",\r\n\t\t\t\"vnd.quark.quarkxpress\" : [ \"qxd\", \"qxt\", \"qwd\", \"qwt\", \"qxl\", \"qxb\" ],\r\n\t\t\t\"vnd.realvnc.bed\" : \"bed\",\r\n\t\t\t\"vnd.recordare.musicxml\" : \"mxl\",\r\n\t\t\t\"vnd.recordare.musicxml+xml\" : \"musicxml\",\r\n\t\t\t\"vnd.rig.cryptonote\" : \"cryptonote\",\r\n\t\t\t\"vnd.rn-realmedia\" : \"rm\",\r\n\t\t\t\"vnd.rn-realmedia-vbr\" : \"rmvb\",\r\n\t\t\t\"vnd.route66.link66+xml\" : \"link66\",\r\n\t\t\t\"vnd.sailingtracker.track\" : \"st\",\r\n\t\t\t\"vnd.seemail\" : \"see\",\r\n\t\t\t\"vnd.sema\" : \"sema\",\r\n\t\t\t\"vnd.semd\" : \"semd\",\r\n\t\t\t\"vnd.semf\" : \"semf\",\r\n\t\t\t\"vnd.shana.informed.formdata\" : \"ifm\",\r\n\t\t\t\"vnd.shana.informed.formtemplate\" : \"itp\",\r\n\t\t\t\"vnd.shana.informed.interchange\" : \"iif\",\r\n\t\t\t\"vnd.shana.informed.package\" : \"ipk\",\r\n\t\t\t\"vnd.simtech-mindmapper\" : [ \"twd\", \"twds\" ],\r\n\t\t\t\"vnd.smart.teacher\" : \"teacher\",\r\n\t\t\t\"vnd.solent.sdkm+xml\" : [ \"sdkm\", \"sdkd\" ],\r\n\t\t\t\"vnd.spotfire.dxp\" : \"dxp\",\r\n\t\t\t\"vnd.spotfire.sfs\" : \"sfs\",\r\n\t\t\t\"vnd.stepmania.package\" : \"smzip\",\r\n\t\t\t\"vnd.stepmania.stepchart\" : \"sm\",\r\n\t\t\t\"vnd.sus-calendar\" : [ \"sus\", \"susp\" ],\r\n\t\t\t\"vnd.svd\" : \"svd\",\r\n\t\t\t\"vnd.syncml+xml\" : \"xsm\",\r\n\t\t\t\"vnd.syncml.dm+wbxml\" : \"bdm\",\r\n\t\t\t\"vnd.syncml.dm+xml\" : \"xdm\",\r\n\t\t\t\"vnd.tao.intent-module-archive\" : \"tao\",\r\n\t\t\t\"vnd.tcpdump.pcap\" : [ \"pcap\", \"cap\", \"dmp\" ],\r\n\t\t\t\"vnd.tmobile-livetv\" : \"tmo\",\r\n\t\t\t\"vnd.trid.tpt\" : \"tpt\",\r\n\t\t\t\"vnd.triscape.mxs\" : \"mxs\",\r\n\t\t\t\"vnd.trueapp\" : \"tra\",\r\n\t\t\t\"vnd.ufdl\" : [ \"ufd\", \"ufdl\" ],\r\n\t\t\t\"vnd.uiq.theme\" : \"utz\",\r\n\t\t\t\"vnd.umajin\" : \"umj\",\r\n\t\t\t\"vnd.unity\" : \"unityweb\",\r\n\t\t\t\"vnd.uoml+xml\" : \"uoml\",\r\n\t\t\t\"vnd.vcx\" : \"vcx\",\r\n\t\t\t\"vnd.visionary\" : \"vis\",\r\n\t\t\t\"vnd.vsf\" : \"vsf\",\r\n\t\t\t\"vnd.webturbo\" : \"wtb\",\r\n\t\t\t\"vnd.wolfram.player\" : \"nbp\",\r\n\t\t\t\"vnd.wqd\" : \"wqd\",\r\n\t\t\t\"vnd.wt.stf\" : \"stf\",\r\n\t\t\t\"vnd.xara\" : \"xar\",\r\n\t\t\t\"vnd.xfdl\" : \"xfdl\",\r\n\t\t\t\"vnd.yamaha.hv-dic\" : \"hvd\",\r\n\t\t\t\"vnd.yamaha.hv-script\" : \"hvs\",\r\n\t\t\t\"vnd.yamaha.hv-voice\" : \"hvp\",\r\n\t\t\t\"vnd.yamaha.openscoreformat\" : \"osf\",\r\n\t\t\t\"vnd.yamaha.openscoreformat.osfpvg+xml\" : \"osfpvg\",\r\n\t\t\t\"vnd.yamaha.smaf-audio\" : \"saf\",\r\n\t\t\t\"vnd.yamaha.smaf-phrase\" : \"spf\",\r\n\t\t\t\"vnd.yellowriver-custom-menu\" : \"cmp\",\r\n\t\t\t\"vnd.zul\" : [ \"zir\", \"zirz\" ],\r\n\t\t\t\"vnd.zzazz.deck+xml\" : \"zaz\",\r\n\t\t\t\"voicexml+xml\" : \"vxml\",\r\n\t\t\t\"widget\" : \"wgt\",\r\n\t\t\t\"winhlp\" : \"hlp\",\r\n\t\t\t\"wsdl+xml\" : \"wsdl\",\r\n\t\t\t\"wspolicy+xml\" : \"wspolicy\",\r\n\t\t\t\"x-ace-compressed\" : \"ace\",\r\n\t\t\t\"x-authorware-bin\" : [ \"aab\", \"x32\", \"u32\", \"vox\" ],\r\n\t\t\t\"x-authorware-map\" : \"aam\",\r\n\t\t\t\"x-authorware-seg\" : \"aas\",\r\n\t\t\t\"x-blorb\" : [ \"blb\", \"blorb\" ],\r\n\t\t\t\"x-bzip\" : \"bz\",\r\n\t\t\t\"x-bzip2\" : [ \"bz2\", \"boz\" ],\r\n\t\t\t\"x-cfs-compressed\" : \"cfs\",\r\n\t\t\t\"x-chat\" : \"chat\",\r\n\t\t\t\"x-conference\" : \"nsc\",\r\n\t\t\t\"x-dgc-compressed\" : \"dgc\",\r\n\t\t\t\"x-dtbncx+xml\" : \"ncx\",\r\n\t\t\t\"x-dtbook+xml\" : \"dtb\",\r\n\t\t\t\"x-dtbresource+xml\" : \"res\",\r\n\t\t\t\"x-eva\" : \"eva\",\r\n\t\t\t\"x-font-bdf\" : \"bdf\",\r\n\t\t\t\"x-font-ghostscript\" : \"gsf\",\r\n\t\t\t\"x-font-linux-psf\" : \"psf\",\r\n\t\t\t\"x-font-otf\" : \"otf\",\r\n\t\t\t\"x-font-pcf\" : \"pcf\",\r\n\t\t\t\"x-font-snf\" : \"snf\",\r\n\t\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\r\n\t\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\r\n\t\t\t\"x-font-woff\" : \"woff\",\r\n\t\t\t\"x-freearc\" : \"arc\",\r\n\t\t\t\"x-gca-compressed\" : \"gca\",\r\n\t\t\t\"x-glulx\" : \"ulx\",\r\n\t\t\t\"x-gramps-xml\" : \"gramps\",\r\n\t\t\t\"x-install-instructions\" : \"install\",\r\n\t\t\t\"x-lzh-compressed\" : [ \"lzh\", \"lha\" ],\r\n\t\t\t\"x-mie\" : \"mie\",\r\n\t\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\r\n\t\t\t\"x-ms-application\" : \"application\",\r\n\t\t\t\"x-ms-shortcut\" : \"lnk\",\r\n\t\t\t\"x-ms-xbap\" : \"xbap\",\r\n\t\t\t\"x-msbinder\" : \"obd\",\r\n\t\t\t\"x-mscardfile\" : \"crd\",\r\n\t\t\t\"x-msclip\" : \"clp\",\r\n\t\t\t\"x-msdownload\" : [ \"exe\", \"dll\", \"com\", \"bat\", \"msi\" ],\r\n\t\t\t\"x-msmediaview\" : [ \"mvb\", \"m13\", \"m14\" ],\r\n\t\t\t\"x-msmetafile\" : [ \"wmf\", \"wmz\", \"emf\", \"emz\" ],\r\n\t\t\t\"x-msmoney\" : \"mny\",\r\n\t\t\t\"x-mspublisher\" : \"pub\",\r\n\t\t\t\"x-msschedule\" : \"scd\",\r\n\t\t\t\"x-msterminal\" : \"trm\",\r\n\t\t\t\"x-mswrite\" : \"wri\",\r\n\t\t\t\"x-nzb\" : \"nzb\",\r\n\t\t\t\"x-pkcs12\" : [ \"p12\", \"pfx\" ],\r\n\t\t\t\"x-pkcs7-certificates\" : [ \"p7b\", \"spc\" ],\r\n\t\t\t\"x-research-info-systems\" : \"ris\",\r\n\t\t\t\"x-silverlight-app\" : \"xap\",\r\n\t\t\t\"x-sql\" : \"sql\",\r\n\t\t\t\"x-stuffitx\" : \"sitx\",\r\n\t\t\t\"x-subrip\" : \"srt\",\r\n\t\t\t\"x-t3vm-image\" : \"t3\",\r\n\t\t\t\"x-tads\" : \"gam\",\r\n\t\t\t\"x-tex\" : \"tex\",\r\n\t\t\t\"x-tex-tfm\" : \"tfm\",\r\n\t\t\t\"x-tgif\" : \"obj\",\r\n\t\t\t\"x-xliff+xml\" : \"xlf\",\r\n\t\t\t\"x-xz\" : \"xz\",\r\n\t\t\t\"x-zmachine\" : [ \"z1\", \"z2\", \"z3\", \"z4\", \"z5\", \"z6\", \"z7\", \"z8\" ],\r\n\t\t\t\"xaml+xml\" : \"xaml\",\r\n\t\t\t\"xcap-diff+xml\" : \"xdf\",\r\n\t\t\t\"xenc+xml\" : \"xenc\",\r\n\t\t\t\"xml-dtd\" : \"dtd\",\r\n\t\t\t\"xop+xml\" : \"xop\",\r\n\t\t\t\"xproc+xml\" : \"xpl\",\r\n\t\t\t\"xslt+xml\" : \"xslt\",\r\n\t\t\t\"xv+xml\" : [ \"mxml\", \"xhvml\", \"xvml\", \"xvm\" ],\r\n\t\t\t\"yang\" : \"yang\",\r\n\t\t\t\"yin+xml\" : \"yin\",\r\n\t\t\t\"envoy\" : \"evy\",\r\n\t\t\t\"fractals\" : \"fif\",\r\n\t\t\t\"internet-property-stream\" : \"acx\",\r\n\t\t\t\"olescript\" : \"axs\",\r\n\t\t\t\"vnd.ms-outlook\" : \"msg\",\r\n\t\t\t\"vnd.ms-pkicertstore\" : \"sst\",\r\n\t\t\t\"x-compress\" : \"z\",\r\n\t\t\t\"x-compressed\" : \"tgz\",\r\n\t\t\t\"x-gzip\" : \"gz\",\r\n\t\t\t\"x-perfmon\" : [ \"pma\", \"pmc\", \"pml\", \"pmr\", \"pmw\" ],\r\n\t\t\t\"x-pkcs7-mime\" : [ \"p7c\", \"p7m\" ],\r\n\t\t\t\"ynd.ms-pkipko\" : \"pko\"\r\n\t\t},\r\n\t\t\"audio\" : {\r\n\t\t\t\"amr\" : \"amr\",\r\n\t\t\t\"amr-wb\" : \"awb\",\r\n\t\t\t\"annodex\" : \"axa\",\r\n\t\t\t\"basic\" : [ \"au\", \"snd\" ],\r\n\t\t\t\"flac\" : \"flac\",\r\n\t\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\r\n\t\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\r\n\t\t\t\"mpegurl\" : \"m3u\",\r\n\t\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\r\n\t\t\t\"prs.sid\" : \"sid\",\r\n\t\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\r\n\t\t\t\"x-gsm\" : \"gsm\",\r\n\t\t\t\"x-ms-wma\" : \"wma\",\r\n\t\t\t\"x-ms-wax\" : \"wax\",\r\n\t\t\t\"x-pn-realaudio\" : \"ram\",\r\n\t\t\t\"x-realaudio\" : \"ra\",\r\n\t\t\t\"x-sd2\" : \"sd2\",\r\n\t\t\t\"x-wav\" : \"wav\",\r\n\t\t\t\"adpcm\" : \"adp\",\r\n\t\t\t\"mp4\" : \"mp4a\",\r\n\t\t\t\"s3m\" : \"s3m\",\r\n\t\t\t\"silk\" : \"sil\",\r\n\t\t\t\"vnd.dece.audio\" : [ \"uva\", \"uvva\" ],\r\n\t\t\t\"vnd.digital-winds\" : \"eol\",\r\n\t\t\t\"vnd.dra\" : \"dra\",\r\n\t\t\t\"vnd.dts\" : \"dts\",\r\n\t\t\t\"vnd.dts.hd\" : \"dtshd\",\r\n\t\t\t\"vnd.lucent.voice\" : \"lvp\",\r\n\t\t\t\"vnd.ms-playready.media.pya\" : \"pya\",\r\n\t\t\t\"vnd.nuera.ecelp4800\" : \"ecelp4800\",\r\n\t\t\t\"vnd.nuera.ecelp7470\" : \"ecelp7470\",\r\n\t\t\t\"vnd.nuera.ecelp9600\" : \"ecelp9600\",\r\n\t\t\t\"vnd.rip\" : \"rip\",\r\n\t\t\t\"webm\" : \"weba\",\r\n\t\t\t\"x-aac\" : \"aac\",\r\n\t\t\t\"x-caf\" : \"caf\",\r\n\t\t\t\"x-matroska\" : \"mka\",\r\n\t\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\r\n\t\t\t\"xm\" : \"xm\",\r\n\t\t\t\"mid\" : [ \"mid\", \"rmi\" ]\r\n\t\t},\r\n\t\t\"chemical\" : {\r\n\t\t\t\"x-alchemy\" : \"alc\",\r\n\t\t\t\"x-cache\" : [ \"cac\", \"cache\" ],\r\n\t\t\t\"x-cache-csf\" : \"csf\",\r\n\t\t\t\"x-cactvs-binary\" : [ \"cbin\", \"cascii\", \"ctab\" ],\r\n\t\t\t\"x-cdx\" : \"cdx\",\r\n\t\t\t\"x-chem3d\" : \"c3d\",\r\n\t\t\t\"x-cif\" : \"cif\",\r\n\t\t\t\"x-cmdf\" : \"cmdf\",\r\n\t\t\t\"x-cml\" : \"cml\",\r\n\t\t\t\"x-compass\" : \"cpa\",\r\n\t\t\t\"x-crossfire\" : \"bsd\",\r\n\t\t\t\"x-csml\" : [ \"csml\", \"csm\" ],\r\n\t\t\t\"x-ctx\" : \"ctx\",\r\n\t\t\t\"x-cxf\" : [ \"cxf\", \"cef\" ],\r\n\t\t\t\"x-embl-dl-nucleotide\" : [ \"emb\", \"embl\" ],\r\n\t\t\t\"x-gamess-input\" : [ \"inp\", \"gam\", \"gamin\" ],\r\n\t\t\t\"x-gaussian-checkpoint\" : [ \"fch\", \"fchk\" ],\r\n\t\t\t\"x-gaussian-cube\" : \"cub\",\r\n\t\t\t\"x-gaussian-input\" : [ \"gau\", \"gjc\", \"gjf\" ],\r\n\t\t\t\"x-gaussian-log\" : \"gal\",\r\n\t\t\t\"x-gcg8-sequence\" : \"gcg\",\r\n\t\t\t\"x-genbank\" : \"gen\",\r\n\t\t\t\"x-hin\" : \"hin\",\r\n\t\t\t\"x-isostar\" : [ \"istr\", \"ist\" ],\r\n\t\t\t\"x-jcamp-dx\" : [ \"jdx\", \"dx\" ],\r\n\t\t\t\"x-kinemage\" : \"kin\",\r\n\t\t\t\"x-macmolecule\" : \"mcm\",\r\n\t\t\t\"x-macromodel-input\" : [ \"mmd\", \"mmod\" ],\r\n\t\t\t\"x-mdl-molfile\" : \"mol\",\r\n\t\t\t\"x-mdl-rdfile\" : \"rd\",\r\n\t\t\t\"x-mdl-rxnfile\" : \"rxn\",\r\n\t\t\t\"x-mdl-sdfile\" : [ \"sd\", \"sdf\" ],\r\n\t\t\t\"x-mdl-tgf\" : \"tgf\",\r\n\t\t\t\"x-mmcif\" : \"mcif\",\r\n\t\t\t\"x-mol2\" : \"mol2\",\r\n\t\t\t\"x-molconn-Z\" : \"b\",\r\n\t\t\t\"x-mopac-graph\" : \"gpt\",\r\n\t\t\t\"x-mopac-input\" : [ \"mop\", \"mopcrt\", \"mpc\", \"zmt\" ],\r\n\t\t\t\"x-mopac-out\" : \"moo\",\r\n\t\t\t\"x-ncbi-asn1\" : \"asn\",\r\n\t\t\t\"x-ncbi-asn1-ascii\" : [ \"prt\", \"ent\" ],\r\n\t\t\t\"x-ncbi-asn1-binary\" : [ \"val\", \"aso\" ],\r\n\t\t\t\"x-pdb\" : [ \"pdb\", \"ent\" ],\r\n\t\t\t\"x-rosdal\" : \"ros\",\r\n\t\t\t\"x-swissprot\" : \"sw\",\r\n\t\t\t\"x-vamas-iso14976\" : \"vms\",\r\n\t\t\t\"x-vmd\" : \"vmd\",\r\n\t\t\t\"x-xtel\" : \"xtel\",\r\n\t\t\t\"x-xyz\" : \"xyz\"\r\n\t\t},\r\n\t\t\"image\" : {\r\n\t\t\t\"gif\" : \"gif\",\r\n\t\t\t\"ief\" : \"ief\",\r\n\t\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\r\n\t\t\t\"pcx\" : \"pcx\",\r\n\t\t\t\"png\" : \"png\",\r\n\t\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\r\n\t\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\r\n\t\t\t\"vnd.djvu\" : [ \"djvu\", \"djv\" ],\r\n\t\t\t\"vnd.wap.wbmp\" : \"wbmp\",\r\n\t\t\t\"x-canon-cr2\" : \"cr2\",\r\n\t\t\t\"x-canon-crw\" : \"crw\",\r\n\t\t\t\"x-cmu-raster\" : \"ras\",\r\n\t\t\t\"x-coreldraw\" : \"cdr\",\r\n\t\t\t\"x-coreldrawpattern\" : \"pat\",\r\n\t\t\t\"x-coreldrawtemplate\" : \"cdt\",\r\n\t\t\t\"x-corelphotopaint\" : \"cpt\",\r\n\t\t\t\"x-epson-erf\" : \"erf\",\r\n\t\t\t\"x-icon\" : \"ico\",\r\n\t\t\t\"x-jg\" : \"art\",\r\n\t\t\t\"x-jng\" : \"jng\",\r\n\t\t\t\"x-nikon-nef\" : \"nef\",\r\n\t\t\t\"x-olympus-orf\" : \"orf\",\r\n\t\t\t\"x-photoshop\" : \"psd\",\r\n\t\t\t\"x-portable-anymap\" : \"pnm\",\r\n\t\t\t\"x-portable-bitmap\" : \"pbm\",\r\n\t\t\t\"x-portable-graymap\" : \"pgm\",\r\n\t\t\t\"x-portable-pixmap\" : \"ppm\",\r\n\t\t\t\"x-rgb\" : \"rgb\",\r\n\t\t\t\"x-xbitmap\" : \"xbm\",\r\n\t\t\t\"x-xpixmap\" : \"xpm\",\r\n\t\t\t\"x-xwindowdump\" : \"xwd\",\r\n\t\t\t\"bmp\" : \"bmp\",\r\n\t\t\t\"cgm\" : \"cgm\",\r\n\t\t\t\"g3fax\" : \"g3\",\r\n\t\t\t\"ktx\" : \"ktx\",\r\n\t\t\t\"prs.btif\" : \"btif\",\r\n\t\t\t\"sgi\" : \"sgi\",\r\n\t\t\t\"vnd.dece.graphic\" : [ \"uvi\", \"uvvi\", \"uvg\", \"uvvg\" ],\r\n\t\t\t\"vnd.dwg\" : \"dwg\",\r\n\t\t\t\"vnd.dxf\" : \"dxf\",\r\n\t\t\t\"vnd.fastbidsheet\" : \"fbs\",\r\n\t\t\t\"vnd.fpx\" : \"fpx\",\r\n\t\t\t\"vnd.fst\" : \"fst\",\r\n\t\t\t\"vnd.fujixerox.edmics-mmr\" : \"mmr\",\r\n\t\t\t\"vnd.fujixerox.edmics-rlc\" : \"rlc\",\r\n\t\t\t\"vnd.ms-modi\" : \"mdi\",\r\n\t\t\t\"vnd.ms-photo\" : \"wdp\",\r\n\t\t\t\"vnd.net-fpx\" : \"npx\",\r\n\t\t\t\"vnd.xiff\" : \"xif\",\r\n\t\t\t\"webp\" : \"webp\",\r\n\t\t\t\"x-3ds\" : \"3ds\",\r\n\t\t\t\"x-cmx\" : \"cmx\",\r\n\t\t\t\"x-freehand\" : [ \"fh\", \"fhc\", \"fh4\", \"fh5\", \"fh7\" ],\r\n\t\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\r\n\t\t\t\"x-tga\" : \"tga\",\r\n\t\t\t\"cis-cod\" : \"cod\",\r\n\t\t\t\"pipeg\" : \"jfif\"\r\n\t\t},\r\n\t\t\"message\" : {\r\n\t\t\t\"rfc822\" : [ \"eml\", \"mime\", \"mht\", \"mhtml\", \"nws\" ]\r\n\t\t},\r\n\t\t\"model\" : {\r\n\t\t\t\"iges\" : [ \"igs\", \"iges\" ],\r\n\t\t\t\"mesh\" : [ \"msh\", \"mesh\", \"silo\" ],\r\n\t\t\t\"vrml\" : [ \"wrl\", \"vrml\" ],\r\n\t\t\t\"x3d+vrml\" : [ \"x3dv\", \"x3dvz\" ],\r\n\t\t\t\"x3d+xml\" : [ \"x3d\", \"x3dz\" ],\r\n\t\t\t\"x3d+binary\" : [ \"x3db\", \"x3dbz\" ],\r\n\t\t\t\"vnd.collada+xml\" : \"dae\",\r\n\t\t\t\"vnd.dwf\" : \"dwf\",\r\n\t\t\t\"vnd.gdl\" : \"gdl\",\r\n\t\t\t\"vnd.gtw\" : \"gtw\",\r\n\t\t\t\"vnd.mts\" : \"mts\",\r\n\t\t\t\"vnd.vtu\" : \"vtu\"\r\n\t\t},\r\n\t\t\"text\" : {\r\n\t\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\r\n\t\t\t\"calendar\" : [ \"ics\", \"icz\", \"ifb\" ],\r\n\t\t\t\"css\" : \"css\",\r\n\t\t\t\"csv\" : \"csv\",\r\n\t\t\t\"h323\" : \"323\",\r\n\t\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\r\n\t\t\t\"iuls\" : \"uls\",\r\n\t\t\t\"mathml\" : \"mml\",\r\n\t\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\r\n\t\t\t\"richtext\" : \"rtx\",\r\n\t\t\t\"scriptlet\" : [ \"sct\", \"wsc\" ],\r\n\t\t\t\"texmacs\" : [ \"tm\", \"ts\" ],\r\n\t\t\t\"tab-separated-values\" : \"tsv\",\r\n\t\t\t\"vnd.sun.j2me.app-descriptor\" : \"jad\",\r\n\t\t\t\"vnd.wap.wml\" : \"wml\",\r\n\t\t\t\"vnd.wap.wmlscript\" : \"wmls\",\r\n\t\t\t\"x-bibtex\" : \"bib\",\r\n\t\t\t\"x-boo\" : \"boo\",\r\n\t\t\t\"x-c++hdr\" : [ \"h++\", \"hpp\", \"hxx\", \"hh\" ],\r\n\t\t\t\"x-c++src\" : [ \"c++\", \"cpp\", \"cxx\", \"cc\" ],\r\n\t\t\t\"x-component\" : \"htc\",\r\n\t\t\t\"x-dsrc\" : \"d\",\r\n\t\t\t\"x-diff\" : [ \"diff\", \"patch\" ],\r\n\t\t\t\"x-haskell\" : \"hs\",\r\n\t\t\t\"x-java\" : \"java\",\r\n\t\t\t\"x-literate-haskell\" : \"lhs\",\r\n\t\t\t\"x-moc\" : \"moc\",\r\n\t\t\t\"x-pascal\" : [ \"p\", \"pas\" ],\r\n\t\t\t\"x-pcs-gcd\" : \"gcd\",\r\n\t\t\t\"x-perl\" : [ \"pl\", \"pm\" ],\r\n\t\t\t\"x-python\" : \"py\",\r\n\t\t\t\"x-scala\" : \"scala\",\r\n\t\t\t\"x-setext\" : \"etx\",\r\n\t\t\t\"x-tcl\" : [ \"tcl\", \"tk\" ],\r\n\t\t\t\"x-tex\" : [ \"tex\", \"ltx\", \"sty\", \"cls\" ],\r\n\t\t\t\"x-vcalendar\" : \"vcs\",\r\n\t\t\t\"x-vcard\" : \"vcf\",\r\n\t\t\t\"n3\" : \"n3\",\r\n\t\t\t\"prs.lines.tag\" : \"dsc\",\r\n\t\t\t\"sgml\" : [ \"sgml\", \"sgm\" ],\r\n\t\t\t\"troff\" : [ \"t\", \"tr\", \"roff\", \"man\", \"me\", \"ms\" ],\r\n\t\t\t\"turtle\" : \"ttl\",\r\n\t\t\t\"uri-list\" : [ \"uri\", \"uris\", \"urls\" ],\r\n\t\t\t\"vcard\" : \"vcard\",\r\n\t\t\t\"vnd.curl\" : \"curl\",\r\n\t\t\t\"vnd.curl.dcurl\" : \"dcurl\",\r\n\t\t\t\"vnd.curl.scurl\" : \"scurl\",\r\n\t\t\t\"vnd.curl.mcurl\" : \"mcurl\",\r\n\t\t\t\"vnd.dvb.subtitle\" : \"sub\",\r\n\t\t\t\"vnd.fly\" : \"fly\",\r\n\t\t\t\"vnd.fmi.flexstor\" : \"flx\",\r\n\t\t\t\"vnd.graphviz\" : \"gv\",\r\n\t\t\t\"vnd.in3d.3dml\" : \"3dml\",\r\n\t\t\t\"vnd.in3d.spot\" : \"spot\",\r\n\t\t\t\"x-asm\" : [ \"s\", \"asm\" ],\r\n\t\t\t\"x-c\" : [ \"c\", \"cc\", \"cxx\", \"cpp\", \"h\", \"hh\", \"dic\" ],\r\n\t\t\t\"x-fortran\" : [ \"f\", \"for\", \"f77\", \"f90\" ],\r\n\t\t\t\"x-opml\" : \"opml\",\r\n\t\t\t\"x-nfo\" : \"nfo\",\r\n\t\t\t\"x-sfv\" : \"sfv\",\r\n\t\t\t\"x-uuencode\" : \"uu\",\r\n\t\t\t\"webviewhtml\" : \"htt\"\r\n\t\t},\r\n\t\t\"video\" : {\r\n\t\t\t\"3gpp\" : \"3gp\",\r\n\t\t\t\"annodex\" : \"axv\",\r\n\t\t\t\"dl\" : \"dl\",\r\n\t\t\t\"dv\" : [ \"dif\", \"dv\" ],\r\n\t\t\t\"fli\" : \"fli\",\r\n\t\t\t\"gl\" : \"gl\",\r\n\t\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\r\n\t\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\r\n\t\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\r\n\t\t\t\"ogg\" : \"ogv\",\r\n\t\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\r\n\t\t\t\"x-flv\" : \"flv\",\r\n\t\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\r\n\t\t\t\"x-mng\" : \"mng\",\r\n\t\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\r\n\t\t\t\"x-ms-wm\" : \"wm\",\r\n\t\t\t\"x-ms-wmv\" : \"wmv\",\r\n\t\t\t\"x-ms-wmx\" : \"wmx\",\r\n\t\t\t\"x-ms-wvx\" : \"wvx\",\r\n\t\t\t\"x-msvideo\" : \"avi\",\r\n\t\t\t\"x-sgi-movie\" : \"movie\",\r\n\t\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\r\n\t\t\t\"3gpp2\" : \"3g2\",\r\n\t\t\t\"h261\" : \"h261\",\r\n\t\t\t\"h263\" : \"h263\",\r\n\t\t\t\"h264\" : \"h264\",\r\n\t\t\t\"jpeg\" : \"jpgv\",\r\n\t\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\r\n\t\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\r\n\t\t\t\"vnd.dece.hd\" : [ \"uvh\", \"uvvh\" ],\r\n\t\t\t\"vnd.dece.mobile\" : [ \"uvm\", \"uvvm\" ],\r\n\t\t\t\"vnd.dece.pd\" : [ \"uvp\", \"uvvp\" ],\r\n\t\t\t\"vnd.dece.sd\" : [ \"uvs\", \"uvvs\" ],\r\n\t\t\t\"vnd.dece.video\" : [ \"uvv\", \"uvvv\" ],\r\n\t\t\t\"vnd.dvb.file\" : \"dvb\",\r\n\t\t\t\"vnd.fvt\" : \"fvt\",\r\n\t\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\r\n\t\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\r\n\t\t\t\"vnd.vivo\" : \"viv\",\r\n\t\t\t\"webm\" : \"webm\",\r\n\t\t\t\"x-f4v\" : \"f4v\",\r\n\t\t\t\"x-m4v\" : \"m4v\",\r\n\t\t\t\"x-ms-vob\" : \"vob\",\r\n\t\t\t\"x-smv\" : \"smv\"\r\n\t\t},\r\n\t\t\"x-conference\" : {\r\n\t\t\t\"x-cooltalk\" : \"ice\"\r\n\t\t},\r\n\t\t\"x-world\" : {\r\n\t\t\t\"x-vrml\" : [ \"vrm\", \"vrml\", \"wrl\", \"flr\", \"wrz\", \"xaf\", \"xof\" ]\r\n\t\t}\r\n\t};\r\n\r\n\tvar mimeTypes = (function() {\r\n\t\tvar type, subtype, val, index, mimeTypes = {};\r\n\t\tfor (type in table) {\r\n\t\t\tif (table.hasOwnProperty(type)) {\r\n\t\t\t\tfor (subtype in table[type]) {\r\n\t\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\r\n\t\t\t\t\t\tval = table[type][subtype];\r\n\t\t\t\t\t\tif (typeof val == \"string\") {\r\n\t\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\r\n\t\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn mimeTypes;\r\n\t})();\r\n\r\n\tzip.getMimeType = function(filename) {\r\n\t\tvar defaultValue = \"application/octet-stream\";\r\n\t\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\r\n\t};\r\n\r\n})();\r\n\ndefine(\"mime-types\", [\"zip\"], (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.zip;\n    };\n}(this)));\n\n",
    "/*\r\n Copyright (c) 2013 Gildas Lormeau. All rights reserved.\r\n\r\n Redistribution and use in source and binary forms, with or without\r\n modification, are permitted provided that the following conditions are met:\r\n\r\n 1. Redistributions of source code must retain the above copyright notice,\r\n this list of conditions and the following disclaimer.\r\n\r\n 2. Redistributions in binary form must reproduce the above copyright \r\n notice, this list of conditions and the following disclaimer in \r\n the documentation and/or other materials provided with the distribution.\r\n\r\n 3. The names of the authors may not be used to endorse or promote products\r\n derived from this software without specific prior written permission.\r\n\r\n THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\r\n INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\r\n INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\r\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\r\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\r\n OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\r\n LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\r\n NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\r\n EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar CHUNK_SIZE = 512 * 1024;\r\n\r\n\tvar TextWriter = zip.TextWriter, //\r\n\tBlobWriter = zip.BlobWriter, //\r\n\tData64URIWriter = zip.Data64URIWriter, //\r\n\tReader = zip.Reader, //\r\n\tTextReader = zip.TextReader, //\r\n\tBlobReader = zip.BlobReader, //\r\n\tData64URIReader = zip.Data64URIReader, //\r\n\tcreateReader = zip.createReader, //\r\n\tcreateWriter = zip.createWriter;\r\n\r\n\tfunction ZipBlobReader(entry) {\r\n\t\tvar that = this, blobReader;\r\n\r\n\t\tfunction init(callback) {\r\n\t\t\tthat.size = entry.uncompressedSize;\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction getData(callback) {\r\n\t\t\tif (that.data)\r\n\t\t\t\tcallback();\r\n\t\t\telse\r\n\t\t\t\tentry.getData(new BlobWriter(), function(data) {\r\n\t\t\t\t\tthat.data = data;\r\n\t\t\t\t\tblobReader = new BlobReader(data);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}, null, that.checkCrc32);\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback, onerror) {\r\n\t\t\tgetData(function() {\r\n\t\t\t\tblobReader.readUint8Array(index, length, callback, onerror);\r\n\t\t\t}, onerror);\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tZipBlobReader.prototype = new Reader();\r\n\tZipBlobReader.prototype.constructor = ZipBlobReader;\r\n\tZipBlobReader.prototype.checkCrc32 = false;\r\n\r\n\tfunction getTotalSize(entry) {\r\n\t\tvar size = 0;\r\n\r\n\t\tfunction process(entry) {\r\n\t\t\tsize += entry.uncompressedSize || 0;\r\n\t\t\tentry.children.forEach(process);\r\n\t\t}\r\n\r\n\t\tprocess(entry);\r\n\t\treturn size;\r\n\t}\r\n\r\n\tfunction initReaders(entry, onend, onerror) {\r\n\t\tvar index = 0;\r\n\r\n\t\tfunction next() {\r\n\t\t\tindex++;\r\n\t\t\tif (index < entry.children.length)\r\n\t\t\t\tprocess(entry.children[index]);\r\n\t\t\telse\r\n\t\t\t\tonend();\r\n\t\t}\r\n\r\n\t\tfunction process(child) {\r\n\t\t\tif (child.directory)\r\n\t\t\t\tinitReaders(child, next, onerror);\r\n\t\t\telse {\r\n\t\t\t\tchild.reader = new child.Reader(child.data, onerror);\r\n\t\t\t\tchild.reader.init(function() {\r\n\t\t\t\t\tchild.uncompressedSize = child.reader.size;\r\n\t\t\t\t\tnext();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (entry.children.length)\r\n\t\t\tprocess(entry.children[index]);\r\n\t\telse\r\n\t\t\tonend();\r\n\t}\r\n\r\n\tfunction detach(entry) {\r\n\t\tvar children = entry.parent.children;\r\n\t\tchildren.forEach(function(child, index) {\r\n\t\t\tif (child.id == entry.id)\r\n\t\t\t\tchildren.splice(index, 1);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction exportZip(zipWriter, entry, onend, onprogress, totalSize) {\r\n\t\tvar currentIndex = 0;\r\n\r\n\t\tfunction process(zipWriter, entry, onend, onprogress, totalSize) {\r\n\t\t\tvar childIndex = 0;\r\n\r\n\t\t\tfunction exportChild() {\r\n\t\t\t\tvar child = entry.children[childIndex];\r\n\t\t\t\tif (child)\r\n\t\t\t\t\tzipWriter.add(child.getFullname(), child.reader, function() {\r\n\t\t\t\t\t\tcurrentIndex += child.uncompressedSize || 0;\r\n\t\t\t\t\t\tprocess(zipWriter, child, function() {\r\n\t\t\t\t\t\t\tchildIndex++;\r\n\t\t\t\t\t\t\texportChild();\r\n\t\t\t\t\t\t}, onprogress, totalSize);\r\n\t\t\t\t\t}, function(index) {\r\n\t\t\t\t\t\tif (onprogress)\r\n\t\t\t\t\t\t\tonprogress(currentIndex + index, totalSize);\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\tdirectory : child.directory,\r\n\t\t\t\t\t\tversion : child.zipVersion\r\n\t\t\t\t\t});\r\n\t\t\t\telse\r\n\t\t\t\t\tonend();\r\n\t\t\t}\r\n\r\n\t\t\texportChild();\r\n\t\t}\r\n\r\n\t\tprocess(zipWriter, entry, onend, onprogress, totalSize);\r\n\t}\r\n\r\n\tfunction addFileEntry(zipEntry, fileEntry, onend, onerror) {\r\n\t\tfunction getChildren(fileEntry, callback) {\r\n\t\t\tif (fileEntry.isDirectory)\r\n\t\t\t\tfileEntry.createReader().readEntries(callback);\r\n\t\t\tif (fileEntry.isFile)\r\n\t\t\t\tcallback([]);\r\n\t\t}\r\n\r\n\t\tfunction process(zipEntry, fileEntry, onend) {\r\n\t\t\tgetChildren(fileEntry, function(children) {\r\n\t\t\t\tvar childIndex = 0;\r\n\r\n\t\t\t\tfunction addChild(child) {\r\n\t\t\t\t\tfunction nextChild(childFileEntry) {\r\n\t\t\t\t\t\tprocess(childFileEntry, child, function() {\r\n\t\t\t\t\t\t\tchildIndex++;\r\n\t\t\t\t\t\t\tprocessChild();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.isDirectory)\r\n\t\t\t\t\t\tnextChild(zipEntry.addDirectory(child.name));\r\n\t\t\t\t\tif (child.isFile)\r\n\t\t\t\t\t\tchild.file(function(file) {\r\n\t\t\t\t\t\t\tvar childZipEntry = zipEntry.addBlob(child.name, file);\r\n\t\t\t\t\t\t\tchildZipEntry.uncompressedSize = file.size;\r\n\t\t\t\t\t\t\tnextChild(childZipEntry);\r\n\t\t\t\t\t\t}, onerror);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction processChild() {\r\n\t\t\t\t\tvar child = children[childIndex];\r\n\t\t\t\t\tif (child)\r\n\t\t\t\t\t\taddChild(child);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tonend();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprocessChild();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (fileEntry.isDirectory)\r\n\t\t\tprocess(zipEntry, fileEntry, onend);\r\n\t\telse\r\n\t\t\tfileEntry.file(function(file) {\r\n\t\t\t\tzipEntry.addBlob(fileEntry.name, file);\r\n\t\t\t\tonend();\r\n\t\t\t}, onerror);\r\n\t}\r\n\r\n\tfunction getFileEntry(fileEntry, entry, onend, onprogress, onerror, totalSize, checkCrc32) {\r\n\t\tvar currentIndex = 0;\r\n\r\n\t\tfunction process(fileEntry, entry, onend, onprogress, onerror, totalSize) {\r\n\t\t\tvar childIndex = 0;\r\n\r\n\t\t\tfunction addChild(child) {\r\n\t\t\t\tfunction nextChild(childFileEntry) {\r\n\t\t\t\t\tcurrentIndex += child.uncompressedSize || 0;\r\n\t\t\t\t\tprocess(childFileEntry, child, function() {\r\n\t\t\t\t\t\tchildIndex++;\r\n\t\t\t\t\t\tprocessChild();\r\n\t\t\t\t\t}, onprogress, onerror, totalSize);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (child.directory)\r\n\t\t\t\t\tfileEntry.getDirectory(child.name, {\r\n\t\t\t\t\t\tcreate : true\r\n\t\t\t\t\t}, nextChild, onerror);\r\n\t\t\t\telse\r\n\t\t\t\t\tfileEntry.getFile(child.name, {\r\n\t\t\t\t\t\tcreate : true\r\n\t\t\t\t\t}, function(file) {\r\n\t\t\t\t\t\tchild.getData(new zip.FileWriter(file, zip.getMimeType(child.name)), nextChild, function(index) {\r\n\t\t\t\t\t\t\tif (onprogress)\r\n\t\t\t\t\t\t\t\tonprogress(currentIndex + index, totalSize);\r\n\t\t\t\t\t\t}, checkCrc32);\r\n\t\t\t\t\t}, onerror);\r\n\t\t\t}\r\n\r\n\t\t\tfunction processChild() {\r\n\t\t\t\tvar child = entry.children[childIndex];\r\n\t\t\t\tif (child)\r\n\t\t\t\t\taddChild(child);\r\n\t\t\t\telse\r\n\t\t\t\t\tonend();\r\n\t\t\t}\r\n\r\n\t\t\tprocessChild();\r\n\t\t}\r\n\r\n\t\tif (entry.directory)\r\n\t\t\tprocess(fileEntry, entry, onend, onprogress, onerror, totalSize);\r\n\t\telse\r\n\t\t\tentry.getData(new zip.FileWriter(fileEntry, zip.getMimeType(entry.name)), onend, onprogress, checkCrc32);\r\n\t}\r\n\r\n\tfunction resetFS(fs) {\r\n\t\tfs.entries = [];\r\n\t\tfs.root = new ZipDirectoryEntry(fs);\r\n\t}\r\n\r\n\tfunction bufferedCopy(reader, writer, onend, onprogress, onerror) {\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\tfunction stepCopy() {\r\n\t\t\tvar index = chunkIndex * CHUNK_SIZE;\r\n\t\t\tif (onprogress)\r\n\t\t\t\tonprogress(index, reader.size);\r\n\t\t\tif (index < reader.size)\r\n\t\t\t\treader.readUint8Array(index, Math.min(CHUNK_SIZE, reader.size - index), function(array) {\r\n\t\t\t\t\twriter.writeUint8Array(new Uint8Array(array), function() {\r\n\t\t\t\t\t\tchunkIndex++;\r\n\t\t\t\t\t\tstepCopy();\r\n\t\t\t\t\t});\r\n\t\t\t\t}, onerror);\r\n\t\t\telse\r\n\t\t\t\twriter.getData(onend);\r\n\t\t}\r\n\r\n\t\tstepCopy();\r\n\t}\r\n\r\n\tfunction addChild(parent, name, params, directory) {\r\n\t\tif (parent.directory)\r\n\t\t\treturn directory ? new ZipDirectoryEntry(parent.fs, name, params, parent) : new ZipFileEntry(parent.fs, name, params, parent);\r\n\t\telse\r\n\t\t\tthrow \"Parent entry is not a directory.\";\r\n\t}\r\n\r\n\tfunction ZipEntry() {\r\n\t}\r\n\r\n\tZipEntry.prototype = {\r\n\t\tinit : function(fs, name, params, parent) {\r\n\t\t\tvar that = this;\r\n\t\t\tif (fs.root && parent && parent.getChildByName(name))\r\n\t\t\t\tthrow \"Entry filename already exists.\";\r\n\t\t\tif (!params)\r\n\t\t\t\tparams = {};\r\n\t\t\tthat.fs = fs;\r\n\t\t\tthat.name = name;\r\n\t\t\tthat.id = fs.entries.length;\r\n\t\t\tthat.parent = parent;\r\n\t\t\tthat.children = [];\r\n\t\t\tthat.zipVersion = params.zipVersion || 0x14;\r\n\t\t\tthat.uncompressedSize = 0;\r\n\t\t\tfs.entries.push(that);\r\n\t\t\tif (parent)\r\n\t\t\t\tthat.parent.children.push(that);\r\n\t\t},\r\n\t\tgetFileEntry : function(fileEntry, onend, onprogress, onerror, checkCrc32) {\r\n\t\t\tvar that = this;\r\n\t\t\tinitReaders(that, function() {\r\n\t\t\t\tgetFileEntry(fileEntry, that, onend, onprogress, onerror, getTotalSize(that), checkCrc32);\r\n\t\t\t}, onerror);\r\n\t\t},\r\n\t\tmoveTo : function(target) {\r\n\t\t\tvar that = this;\r\n\t\t\tif (target.directory) {\r\n\t\t\t\tif (!target.isDescendantOf(that)) {\r\n\t\t\t\t\tif (that != target) {\r\n\t\t\t\t\t\tif (target.getChildByName(that.name))\r\n\t\t\t\t\t\t\tthrow \"Entry filename already exists.\";\r\n\t\t\t\t\t\tdetach(that);\r\n\t\t\t\t\t\tthat.parent = target;\r\n\t\t\t\t\t\ttarget.children.push(that);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\tthrow \"Entry is a ancestor of target entry.\";\r\n\t\t\t} else\r\n\t\t\t\tthrow \"Target entry is not a directory.\";\r\n\t\t},\r\n\t\tgetFullname : function() {\r\n\t\t\tvar that = this, fullname = that.name, entry = that.parent;\r\n\t\t\twhile (entry) {\r\n\t\t\t\tfullname = (entry.name ? entry.name + \"/\" : \"\") + fullname;\r\n\t\t\t\tentry = entry.parent;\r\n\t\t\t}\r\n\t\t\treturn fullname;\r\n\t\t},\r\n\t\tisDescendantOf : function(ancestor) {\r\n\t\t\tvar entry = this.parent;\r\n\t\t\twhile (entry && entry.id != ancestor.id)\r\n\t\t\t\tentry = entry.parent;\r\n\t\t\treturn !!entry;\r\n\t\t}\r\n\t};\r\n\tZipEntry.prototype.constructor = ZipEntry;\r\n\r\n\tvar ZipFileEntryProto;\r\n\r\n\tfunction ZipFileEntry(fs, name, params, parent) {\r\n\t\tvar that = this;\r\n\t\tZipEntry.prototype.init.call(that, fs, name, params, parent);\r\n\t\tthat.Reader = params.Reader;\r\n\t\tthat.Writer = params.Writer;\r\n\t\tthat.data = params.data;\r\n\t\tif (params.getData) {\r\n\t\t\tthat.getData = params.getData;\r\n\t\t}\r\n\t}\r\n\r\n\tZipFileEntry.prototype = ZipFileEntryProto = new ZipEntry();\r\n\tZipFileEntryProto.constructor = ZipFileEntry;\r\n\tZipFileEntryProto.getData = function(writer, onend, onprogress, onerror) {\r\n\t\tvar that = this;\r\n\t\tif (!writer || (writer.constructor == that.Writer && that.data))\r\n\t\t\tonend(that.data);\r\n\t\telse {\r\n\t\t\tif (!that.reader)\r\n\t\t\t\tthat.reader = new that.Reader(that.data, onerror);\r\n\t\t\tthat.reader.init(function() {\r\n\t\t\t\twriter.init(function() {\r\n\t\t\t\t\tbufferedCopy(that.reader, writer, onend, onprogress, onerror);\r\n\t\t\t\t}, onerror);\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tZipFileEntryProto.getText = function(onend, onprogress, checkCrc32, encoding) {\r\n\t\tthis.getData(new TextWriter(encoding), onend, onprogress, checkCrc32);\r\n\t};\r\n\tZipFileEntryProto.getBlob = function(mimeType, onend, onprogress, checkCrc32) {\r\n\t\tthis.getData(new BlobWriter(mimeType), onend, onprogress, checkCrc32);\r\n\t};\r\n\tZipFileEntryProto.getData64URI = function(mimeType, onend, onprogress, checkCrc32) {\r\n\t\tthis.getData(new Data64URIWriter(mimeType), onend, onprogress, checkCrc32);\r\n\t};\r\n\r\n\tvar ZipDirectoryEntryProto;\r\n\r\n\tfunction ZipDirectoryEntry(fs, name, params, parent) {\r\n\t\tvar that = this;\r\n\t\tZipEntry.prototype.init.call(that, fs, name, params, parent);\r\n\t\tthat.directory = true;\r\n\t}\r\n\r\n\tZipDirectoryEntry.prototype = ZipDirectoryEntryProto = new ZipEntry();\r\n\tZipDirectoryEntryProto.constructor = ZipDirectoryEntry;\r\n\tZipDirectoryEntryProto.addDirectory = function(name) {\r\n\t\treturn addChild(this, name, null, true);\r\n\t};\r\n\tZipDirectoryEntryProto.addText = function(name, text) {\r\n\t\treturn addChild(this, name, {\r\n\t\t\tdata : text,\r\n\t\t\tReader : TextReader,\r\n\t\t\tWriter : TextWriter\r\n\t\t});\r\n\t};\r\n\tZipDirectoryEntryProto.addBlob = function(name, blob) {\r\n\t\treturn addChild(this, name, {\r\n\t\t\tdata : blob,\r\n\t\t\tReader : BlobReader,\r\n\t\t\tWriter : BlobWriter\r\n\t\t});\r\n\t};\r\n\tZipDirectoryEntryProto.addData64URI = function(name, dataURI) {\r\n\t\treturn addChild(this, name, {\r\n\t\t\tdata : dataURI,\r\n\t\t\tReader : Data64URIReader,\r\n\t\t\tWriter : Data64URIWriter\r\n\t\t});\r\n\t};\r\n\tZipDirectoryEntryProto.addFileEntry = function(fileEntry, onend, onerror) {\r\n\t\taddFileEntry(this, fileEntry, onend, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.addData = function(name, params) {\r\n\t\treturn addChild(this, name, params);\r\n\t};\r\n\tZipDirectoryEntryProto.importBlob = function(blob, onend, onerror) {\r\n\t\tthis.importZip(new BlobReader(blob), onend, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.importText = function(text, onend, onerror) {\r\n\t\tthis.importZip(new TextReader(text), onend, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.importData64URI = function(dataURI, onend, onerror) {\r\n\t\tthis.importZip(new Data64URIReader(dataURI), onend, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.exportBlob = function(onend, onprogress, onerror) {\r\n\t\tthis.exportZip(new BlobWriter(\"application/zip\"), onend, onprogress, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.exportText = function(onend, onprogress, onerror) {\r\n\t\tthis.exportZip(new TextWriter(), onend, onprogress, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.exportFileEntry = function(fileEntry, onend, onprogress, onerror) {\r\n\t\tthis.exportZip(new zip.FileWriter(fileEntry, \"application/zip\"), onend, onprogress, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.exportData64URI = function(onend, onprogress, onerror) {\r\n\t\tthis.exportZip(new Data64URIWriter(\"application/zip\"), onend, onprogress, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.importZip = function(reader, onend, onerror) {\r\n\t\tvar that = this;\r\n\t\tcreateReader(reader, function(zipReader) {\r\n\t\t\tzipReader.getEntries(function(entries) {\r\n\t\t\t\tentries.forEach(function(entry) {\r\n\t\t\t\t\tvar parent = that, path = entry.filename.split(\"/\"), name = path.pop();\r\n\t\t\t\t\tpath.forEach(function(pathPart) {\r\n\t\t\t\t\t\tparent = parent.getChildByName(pathPart) || new ZipDirectoryEntry(that.fs, pathPart, null, parent);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!entry.directory)\r\n\t\t\t\t\t\taddChild(parent, name, {\r\n\t\t\t\t\t\t\tdata : entry,\r\n\t\t\t\t\t\t\tReader : ZipBlobReader\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tonend();\r\n\t\t\t});\r\n\t\t}, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.exportZip = function(writer, onend, onprogress, onerror) {\r\n\t\tvar that = this;\r\n\t\tinitReaders(that, function() {\r\n\t\t\tcreateWriter(writer, function(zipWriter) {\r\n\t\t\t\texportZip(zipWriter, that, function() {\r\n\t\t\t\t\tzipWriter.close(onend);\r\n\t\t\t\t}, onprogress, getTotalSize(that));\r\n\t\t\t}, onerror);\r\n\t\t}, onerror);\r\n\t};\r\n\tZipDirectoryEntryProto.getChildByName = function(name) {\r\n\t\tvar childIndex, child, that = this;\r\n\t\tfor (childIndex = 0; childIndex < that.children.length; childIndex++) {\r\n\t\t\tchild = that.children[childIndex];\r\n\t\t\tif (child.name == name)\r\n\t\t\t\treturn child;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction FS() {\r\n\t\tresetFS(this);\r\n\t}\r\n\tFS.prototype = {\r\n\t\tremove : function(entry) {\r\n\t\t\tdetach(entry);\r\n\t\t\tthis.entries[entry.id] = null;\r\n\t\t},\r\n\t\tfind : function(fullname) {\r\n\t\t\tvar index, path = fullname.split(\"/\"), node = this.root;\r\n\t\t\tfor (index = 0; node && index < path.length; index++)\r\n\t\t\t\tnode = node.getChildByName(path[index]);\r\n\t\t\treturn node;\r\n\t\t},\r\n\t\tgetById : function(id) {\r\n\t\t\treturn this.entries[id];\r\n\t\t},\r\n\t\timportBlob : function(blob, onend, onerror) {\r\n\t\t\tresetFS(this);\r\n\t\t\tthis.root.importBlob(blob, onend, onerror);\r\n\t\t},\r\n\t\timportText : function(text, onend, onerror) {\r\n\t\t\tresetFS(this);\r\n\t\t\tthis.root.importText(text, onend, onerror);\r\n\t\t},\r\n\t\timportData64URI : function(dataURI, onend, onerror) {\r\n\t\t\tresetFS(this);\r\n\t\t\tthis.root.importData64URI(dataURI, onend, onerror);\r\n\t\t},\r\n\t\texportBlob : function(onend, onprogress, onerror) {\r\n\t\t\tthis.root.exportBlob(onend, onprogress, onerror);\r\n\t\t},\r\n\t\texportText : function(onend, onprogress, onerror) {\r\n\t\t\tthis.root.exportText(onend, onprogress, onerror);\r\n\t\t},\r\n\t\texportFileEntry : function(fileEntry, onend, onprogress, onerror) {\r\n\t\t\tthis.root.exportFileEntry(fileEntry, onend, onprogress, onerror);\r\n\t\t},\r\n\t\texportData64URI : function(onend, onprogress, onerror) {\r\n\t\t\tthis.root.exportData64URI(onend, onprogress, onerror);\r\n\t\t}\r\n\t};\r\n\r\n\tzip.fs = {\r\n\t\tFS : FS,\r\n\t\tZipDirectoryEntry : ZipDirectoryEntry,\r\n\t\tZipFileEntry : ZipFileEntry\r\n\t};\r\n\r\n\tzip.getMimeType = function() {\r\n\t\treturn \"application/octet-stream\";\r\n\t};\r\n\r\n})();\r\n\ndefine(\"zip-fs\", [\"mime-types\"], (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.zip;\n    };\n}(this)));\n\n",
    "/*\r\n Copyright (c) 2013 Gildas Lormeau. All rights reserved.\r\n\r\n Redistribution and use in source and binary forms, with or without\r\n modification, are permitted provided that the following conditions are met:\r\n\r\n 1. Redistributions of source code must retain the above copyright notice,\r\n this list of conditions and the following disclaimer.\r\n\r\n 2. Redistributions in binary form must reproduce the above copyright\r\n notice, this list of conditions and the following disclaimer in\r\n the documentation and/or other materials provided with the distribution.\r\n\r\n 3. The names of the authors may not be used to endorse or promote products\r\n derived from this software without specific prior written permission.\r\n\r\n THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,\r\n INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,\r\n INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,\r\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\r\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\r\n OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\r\n LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\r\n NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\r\n EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n\tvar ERR_HTTP_RANGE = \"HTTP Range not supported.\";\r\n\r\n\tvar Reader = zip.Reader;\r\n\tvar Writer = zip.Writer;\r\n\t\r\n\tvar ZipDirectoryEntry;\r\n\r\n\tvar appendABViewSupported;\r\n\ttry {\r\n\t\tappendABViewSupported = new Blob([ new DataView(new ArrayBuffer(0)) ]).size === 0;\r\n\t} catch (e) {\r\n\t}\r\n\r\n\tfunction HttpReader(url) {\r\n\t\tvar that = this;\r\n\r\n\t\tfunction getData(callback, onerror) {\r\n\t\t\tvar request;\r\n\t\t\tif (!that.data) {\r\n\t\t\t\trequest = new XMLHttpRequest();\r\n\t\t\t\trequest.addEventListener(\"load\", function() {\r\n\t\t\t\t\tif (!that.size)\r\n\t\t\t\t\t\tthat.size = Number(request.getResponseHeader(\"Content-Length\"));\r\n\t\t\t\t\tthat.data = new Uint8Array(request.response);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}, false);\r\n\t\t\t\trequest.addEventListener(\"error\", onerror, false);\r\n\t\t\t\trequest.open(\"GET\", url);\r\n\t\t\t\trequest.responseType = \"arraybuffer\";\r\n\t\t\t\trequest.send();\r\n\t\t\t} else\r\n\t\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction init(callback, onerror) {\r\n\t\t\tvar request = new XMLHttpRequest();\r\n\t\t\trequest.addEventListener(\"load\", function() {\r\n\t\t\t\tthat.size = Number(request.getResponseHeader(\"Content-Length\"));\r\n\t\t\t\tcallback();\r\n\t\t\t}, false);\r\n\t\t\trequest.addEventListener(\"error\", onerror, false);\r\n\t\t\trequest.open(\"HEAD\", url);\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback, onerror) {\r\n\t\t\tgetData(function() {\r\n\t\t\t\tcallback(new Uint8Array(that.data.subarray(index, index + length)));\r\n\t\t\t}, onerror);\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tHttpReader.prototype = new Reader();\r\n\tHttpReader.prototype.constructor = HttpReader;\r\n\r\n\tfunction HttpRangeReader(url) {\r\n\t\tvar that = this;\r\n\r\n\t\tfunction init(callback, onerror) {\r\n\t\t\tvar request = new XMLHttpRequest();\r\n\t\t\trequest.addEventListener(\"load\", function() {\r\n\t\t\t\tthat.size = Number(request.getResponseHeader(\"Content-Length\"));\r\n\t\t\t\tif (true || request.getResponseHeader(\"Accept-Ranges\") == \"bytes\")\r\n\t\t\t\t\tcallback();\r\n\t\t\t\telse\r\n\t\t\t\t\tonerror(ERR_HTTP_RANGE);\r\n\t\t\t}, false);\r\n\t\t\trequest.addEventListener(\"error\", onerror, false);\r\n\t\t\trequest.open(\"HEAD\", url);\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tfunction readArrayBuffer(index, length, callback, onerror) {\r\n\t\t\tvar request = new XMLHttpRequest();\r\n\t\t\trequest.open(\"GET\", url);\r\n\t\t\trequest.responseType = \"arraybuffer\";\r\n\t\t\trequest.setRequestHeader(\"Range\", \"bytes=\" + index + \"-\" + (index + length - 1));\r\n\t\t\trequest.addEventListener(\"load\", function() {\r\n\t\t\t\tcallback(request.response);\r\n\t\t\t}, false);\r\n\t\t\trequest.addEventListener(\"error\", onerror, false);\r\n\t\t\trequest.send();\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback, onerror) {\r\n\t\t\treadArrayBuffer(index, length, function(arraybuffer) {\r\n\t\t\t\tcallback(new Uint8Array(arraybuffer));\r\n\t\t\t}, onerror);\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tHttpRangeReader.prototype = new Reader();\r\n\tHttpRangeReader.prototype.constructor = HttpRangeReader;\r\n\r\n\tfunction ArrayBufferReader(arrayBuffer) {\r\n\t\tvar that = this;\r\n\r\n\t\tfunction init(callback, onerror) {\r\n\t\t\tthat.size = arrayBuffer.byteLength;\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction readUint8Array(index, length, callback, onerror) {\r\n\t\t\tcallback(new Uint8Array(arrayBuffer.slice(index, index + length)));\r\n\t\t}\r\n\r\n\t\tthat.size = 0;\r\n\t\tthat.init = init;\r\n\t\tthat.readUint8Array = readUint8Array;\r\n\t}\r\n\tArrayBufferReader.prototype = new Reader();\r\n\tArrayBufferReader.prototype.constructor = ArrayBufferReader;\r\n\r\n\tfunction ArrayBufferWriter() {\r\n\t\tvar array, that = this;\r\n\r\n\t\tfunction init(callback, onerror) {\r\n\t\t\tarray = new Uint8Array();\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction writeUint8Array(arr, callback, onerror) {\r\n\t\t\tvar tmpArray = new Uint8Array(array.length + arr.length);\r\n\t\t\ttmpArray.set(array);\r\n\t\t\ttmpArray.set(arr, array.length);\r\n\t\t\tarray = tmpArray;\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\tfunction getData(callback) {\r\n\t\t\tcallback(array.buffer);\r\n\t\t}\r\n\r\n\t\tthat.init = init;\r\n\t\tthat.writeUint8Array = writeUint8Array;\r\n\t\tthat.getData = getData;\r\n\t}\r\n\tArrayBufferWriter.prototype = new Writer();\r\n\tArrayBufferWriter.prototype.constructor = ArrayBufferWriter;\r\n\r\n\tfunction FileWriter(fileEntry, contentType) {\r\n\t\tvar writer, that = this;\r\n\r\n\t\tfunction init(callback, onerror) {\r\n\t\t\tfileEntry.createWriter(function(fileWriter) {\r\n\t\t\t\twriter = fileWriter;\r\n\t\t\t\tcallback();\r\n\t\t\t}, onerror);\r\n\t\t}\r\n\r\n\t\tfunction writeUint8Array(array, callback, onerror) {\r\n\t\t\tvar blob = new Blob([ appendABViewSupported ? array : array.buffer ], {\r\n\t\t\t\ttype : contentType\r\n\t\t\t});\r\n\t\t\twriter.onwrite = function() {\r\n\t\t\t\twriter.onwrite = null;\r\n\t\t\t\tcallback();\r\n\t\t\t};\r\n\t\t\twriter.onerror = onerror;\r\n\t\t\twriter.write(blob);\r\n\t\t}\r\n\r\n\t\tfunction getData(callback) {\r\n\t\t\tfileEntry.file(callback);\r\n\t\t}\r\n\r\n\t\tthat.init = init;\r\n\t\tthat.writeUint8Array = writeUint8Array;\r\n\t\tthat.getData = getData;\r\n\t}\r\n\tFileWriter.prototype = new Writer();\r\n\tFileWriter.prototype.constructor = FileWriter;\r\n\r\n\tzip.FileWriter = FileWriter;\r\n\tzip.HttpReader = HttpReader;\r\n\tzip.HttpRangeReader = HttpRangeReader;\r\n\tzip.ArrayBufferReader = ArrayBufferReader;\r\n\tzip.ArrayBufferWriter = ArrayBufferWriter;\r\n\r\n\tif (zip.fs) {\r\n\t\tZipDirectoryEntry = zip.fs.ZipDirectoryEntry;\r\n\t\tZipDirectoryEntry.prototype.addHttpContent = function(name, URL, useRangeHeader) {\r\n\t\t\tfunction addChild(parent, name, params, directory) {\r\n\t\t\t\tif (parent.directory)\r\n\t\t\t\t\treturn directory ? new ZipDirectoryEntry(parent.fs, name, params, parent) : new zip.fs.ZipFileEntry(parent.fs, name, params, parent);\r\n\t\t\t\telse\r\n\t\t\t\t\tthrow \"Parent entry is not a directory.\";\r\n\t\t\t}\r\n\r\n\t\t\treturn addChild(this, name, {\r\n\t\t\t\tdata : URL,\r\n\t\t\t\tReader : useRangeHeader ? HttpRangeReader : HttpReader\r\n\t\t\t});\r\n\t\t};\r\n\t\tZipDirectoryEntry.prototype.importHttpContent = function(URL, useRangeHeader, onend, onerror) {\r\n\t\t\tthis.importZip(useRangeHeader ? new HttpRangeReader(URL) : new HttpReader(URL), onend, onerror);\r\n\t\t};\r\n\t\tzip.fs.FS.prototype.importHttpContent = function(URL, useRangeHeader, onend, onerror) {\r\n\t\t\tthis.entries = [];\r\n\t\t\tthis.root = new ZipDirectoryEntry(this);\r\n\t\t\tthis.root.importHttpContent(URL, useRangeHeader, onend, onerror);\r\n\t\t};\r\n\t}\r\n\r\n})();\r\n\ndefine(\"zip-ext\", [\"zip-fs\"], (function (global) {\n    return function () {\n        var ret, fn;\n        return ret || global.zip;\n    };\n}(this)));\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/zip_resource_fetcher',['jquery', 'URIjs', './discover_content_type', 'zip-ext'], function ($, URI, ContentTypeDiscovery, zip) {\r\n\r\n    var ZipResourceFetcher = function(parentFetcher, baseUrl, libDir) {\r\n\r\n        var _checkCrc32 = false;\r\n        var _zipFs;\r\n\r\n        // INTERNAL FUNCTIONS\r\n\r\n        // Description: perform a function with an initialized zip filesystem, making sure that such filesystem is initialized.\r\n        // Note that due to a race condition, more than one zip filesystem may be instantiated.\r\n        // However, the last one to be set on the model object will prevail and others would be garbage collected later.\r\n        function withZipFsPerform(callback, onerror) {\r\n\r\n            if (_zipFs) {\r\n\r\n                callback(_zipFs, onerror);\r\n\r\n            } else {\r\n\r\n                // The Web Worker requires standalone z-worker/inflate/deflate.js files in libDir (i.e. cannot be aggregated/minified/optimised in the final generated single-file build)\r\n                zip.useWebWorkers = true; // (true by default)\r\n                zip.workerScriptsPath = libDir;\r\n                \r\n                _zipFs = new zip.fs.FS();\r\n                _zipFs.importHttpContent(\r\n                    baseUrl,\r\n                    true,\r\n                    function () {\r\n                        callback(_zipFs, onerror);\r\n                    },\r\n                    onerror\r\n                );\r\n            }\r\n        }\r\n\r\n        function fetchFileContents (relativePathRelativeToPackageRoot, readCallback, onerror) {\r\n\r\n            if (typeof relativePathRelativeToPackageRoot === 'undefined') {\r\n                throw 'Fetched file relative path is undefined!';\r\n            }\r\n\r\n            withZipFsPerform(\r\n                function (zipFs, onerror) {\r\n                    var entry = zipFs.find(relativePathRelativeToPackageRoot);\r\n                    \r\n                    if (typeof entry === 'undefined' || entry === null) {\r\n                        onerror(new Error('Entry ' + relativePathRelativeToPackageRoot + ' not found in zip ' + baseUrl));\r\n                    } else {\r\n                        if (entry.directory) {\r\n                            onerror(new Error('Entry ' + relativePathRelativeToPackageRoot + ' is a directory while a file has been expected'));\r\n                        } else {\r\n                            readCallback(entry);\r\n                        }\r\n                    }\r\n                },\r\n                function() {\r\n                    console.log(\"ERROR\");\r\n                    console.log(arguments);\r\n                    onerror(arguments);\r\n                }\r\n            );\r\n        }\r\n\r\n\r\n        // PUBLIC API\r\n\r\n        this.getPackageUrl = function() {\r\n            return baseUrl;\r\n        };\r\n\r\n        this.fetchFileContentsText = function(relativePathRelativeToPackageRoot, fetchCallback, onerror) {\r\n\r\n            fetchFileContents(relativePathRelativeToPackageRoot, function (entry) {\r\n                entry.getText(fetchCallback, undefined, _checkCrc32);\r\n            }, onerror)\r\n        };\r\n\r\n        this.fetchFileContentsData64Uri = function(relativePathRelativeToPackageRoot, fetchCallback, onerror) {\r\n            fetchFileContents(relativePathRelativeToPackageRoot, function (entry) {\r\n                entry.getData64URI(ContentTypeDiscovery.identifyContentTypeFromFileName(relativePathRelativeToPackageRoot),\r\n                    fetchCallback, undefined, _checkCrc32);\r\n            }, onerror)\r\n        };\r\n\r\n        this.fetchFileContentsBlob = function(relativePathRelativeToPackageRoot, fetchCallback, onerror) {\r\n            var decryptionFunction = parentFetcher.getDecryptionFunctionForRelativePath(relativePathRelativeToPackageRoot);\r\n            if (decryptionFunction) {\r\n                var origFetchCallback = fetchCallback;\r\n                fetchCallback = function (unencryptedBlob) {\r\n                    decryptionFunction(unencryptedBlob, function (decryptedBlob) {\r\n                        origFetchCallback(decryptedBlob);\r\n                    });\r\n                };\r\n            }\r\n            fetchFileContents(relativePathRelativeToPackageRoot, function (entry) {\r\n                entry.getBlob(ContentTypeDiscovery.identifyContentTypeFromFileName(relativePathRelativeToPackageRoot), fetchCallback,\r\n                    undefined, _checkCrc32);\r\n            }, onerror)\r\n        };\r\n\r\n    };\r\n\r\n    return ZipResourceFetcher;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine(\r\n    'epub-fetch/content_document_fetcher',['jquery', 'underscore', 'URIjs', './discover_content_type'],\r\n    function ($, _, URI, ContentTypeDiscovery) {\r\n\r\n\r\n        var ContentDocumentFetcher = function (publicationFetcher, spineItem, loadedDocumentUri, publicationResourcesCache, contentDocumentTextPreprocessor) {\r\n\r\n            var self = this;\r\n\r\n            var _contentDocumentPathRelativeToPackage = spineItem.href;\r\n            var _publicationFetcher = publicationFetcher;\r\n            var _contentDocumentText;\r\n            var _srcMediaType = spineItem.media_type;\r\n            var _contentDocumentDom;\r\n            var _publicationResourcesCache = publicationResourcesCache;\r\n            var _contentDocumentTextPreprocessor = contentDocumentTextPreprocessor;\r\n\r\n            // PUBLIC API\r\n\r\n            this.fetchContentDocumentAndResolveDom = function (contentDocumentResolvedCallback, errorCallback) {\r\n                _publicationFetcher.relativeToPackageFetchFileContents(_contentDocumentPathRelativeToPackage, 'text',\r\n                    function (contentDocumentText) {\r\n                        _contentDocumentText = contentDocumentText;\r\n                        if (_contentDocumentTextPreprocessor) {\r\n                            _contentDocumentText = _contentDocumentTextPreprocessor(loadedDocumentUri, _contentDocumentText);\r\n                        }\r\n                        self.resolveInternalPackageResources(contentDocumentResolvedCallback, errorCallback);\r\n                    }, errorCallback\r\n                );\r\n            };\r\n\r\n            this.resolveInternalPackageResources = function (resolvedDocumentCallback, onerror) {\r\n\r\n                _contentDocumentDom = _publicationFetcher.markupParser.parseMarkup(_contentDocumentText, _srcMediaType);\r\n                setBaseUri(_contentDocumentDom, loadedDocumentUri);\r\n\r\n                var resolutionDeferreds = [];\r\n\r\n                if (_publicationFetcher.shouldFetchMediaAssetsProgrammatically()) {\r\n                    resolveDocumentImages(resolutionDeferreds, onerror);\r\n                    resolveDocumentAudios(resolutionDeferreds, onerror);\r\n                    resolveDocumentVideos(resolutionDeferreds, onerror);\r\n                }\r\n                // TODO: recursive fetching, parsing and DOM construction of documents in IFRAMEs,\r\n                // with CSS preprocessing and obfuscated font handling\r\n                resolveDocumentIframes(resolutionDeferreds, onerror);\r\n                // TODO: resolution (e.g. using DOM mutation events) of scripts loaded dynamically by scripts\r\n                resolveDocumentScripts(resolutionDeferreds, onerror);\r\n                resolveDocumentLinkStylesheets(resolutionDeferreds, onerror);\r\n                resolveDocumentEmbeddedStylesheets(resolutionDeferreds, onerror);\r\n\r\n                $.when.apply($, resolutionDeferreds).done(function () {\r\n                    resolvedDocumentCallback(_contentDocumentDom);\r\n                });\r\n\r\n            };\r\n\r\n            // INTERNAL FUNCTIONS\r\n\r\n            function setBaseUri(documentDom, baseURI) {\r\n                var baseElem = documentDom.getElementsByTagName('base')[0];\r\n                if (!baseElem) {\r\n                    baseElem = documentDom.createElement('base');\r\n\r\n                    var anchor = documentDom.getElementsByTagName('head')[0];\r\n                    if (anchor) {\r\n                        anchor.insertBefore(baseElem, anchor.childNodes[0]);\r\n                    }\r\n                }\r\n                baseElem.setAttribute('href', baseURI);\r\n            }\r\n\r\n            function _handleError(err) {\r\n                if (err) {\r\n                    if (err.message) {\r\n                        console.error(err.message);\r\n                    }\r\n                    if (err.stack) {\r\n                        console.error(err.stack);\r\n                    }\r\n                }\r\n                console.error(err);\r\n            }\r\n\r\n            function fetchResourceForElement(resolvedElem, refAttrOrigVal, refAttr, fetchMode, resolutionDeferreds,\r\n                                             onerror, resourceDataPreprocessing) {\r\n                var resourceUriRelativeToPackageDocument = (new URI(refAttrOrigVal)).absoluteTo(_contentDocumentPathRelativeToPackage).toString();\r\n\r\n                var cachedResourceUrl = _publicationResourcesCache.getResourceURL(resourceUriRelativeToPackageDocument);\r\n\r\n                function replaceRefAttrInElem(newResourceUrl) {\r\n                    // Store original refAttrVal in a special attribute to provide access to the original href:\r\n                    $(resolvedElem).data('epubZipOrigHref', refAttrOrigVal);\r\n                    $(resolvedElem).attr(refAttr, newResourceUrl);\r\n                }\r\n\r\n                if (cachedResourceUrl) {\r\n                    replaceRefAttrInElem(cachedResourceUrl);\r\n                } else {\r\n                    var resolutionDeferred = $.Deferred();\r\n                    resolutionDeferreds.push(resolutionDeferred);\r\n\r\n                    _publicationFetcher.relativeToPackageFetchFileContents(resourceUriRelativeToPackageDocument,\r\n                        fetchMode,\r\n                        function (resourceData) {\r\n\r\n                            // Generate a function to replace element's resource URL with URL of fetched data.\r\n                            // The function will either be called directly, immediately (if no preprocessing of resourceData is in effect)\r\n                            // or indirectly, later after resourceData preprocessing finishes:\r\n                            var replaceResourceURL = function (finalResourceData) {\r\n                                // Creating an object URL requires a Blob object, so resource data fetched in text mode needs to be wrapped in a Blob:\r\n                                if (fetchMode === 'text') {\r\n                                    var textResourceContentType = ContentTypeDiscovery.identifyContentTypeFromFileName(resourceUriRelativeToPackageDocument);\r\n                                    var declaredType = $(resolvedElem).attr('type');\r\n                                    if (declaredType) {\r\n                                        textResourceContentType = declaredType;\r\n                                    }\r\n                                    finalResourceData = new Blob([finalResourceData], {type: textResourceContentType});\r\n                                }\r\n                                //noinspection JSUnresolvedVariable,JSUnresolvedFunction\r\n                                var resourceObjectURL = window.URL.createObjectURL(finalResourceData);\r\n                                _publicationResourcesCache.putResource(resourceUriRelativeToPackageDocument,\r\n                                    resourceObjectURL, finalResourceData);\r\n                                // TODO: take care of releasing object URLs when no longer needed\r\n                                replaceRefAttrInElem(resourceObjectURL);\r\n                                resolutionDeferred.resolve();\r\n                            };\r\n\r\n                            if (resourceDataPreprocessing) {\r\n                                resourceDataPreprocessing(resourceData, resourceUriRelativeToPackageDocument,\r\n                                    replaceResourceURL);\r\n                            } else {\r\n                                replaceResourceURL(resourceData);\r\n                            }\r\n                        }, onerror);\r\n                }\r\n            }\r\n\r\n            function fetchResourceForCssUrlMatch(cssUrlMatch, cssResourceDownloadDeferreds,\r\n                                                 styleSheetUriRelativeToPackageDocument, stylesheetCssResourceUrlsMap,\r\n                                                 isStyleSheetResource) {\r\n                var origMatchedUrlString = cssUrlMatch[0];\r\n\r\n                var extractedUrlCandidates = cssUrlMatch.slice(2);\r\n                var extractedUrl = _.find(extractedUrlCandidates, function(matchGroup){ return typeof matchGroup !== 'undefined' });\r\n\r\n                var extractedUri = new URI(extractedUrl);\r\n                var isCssUrlRelative = extractedUri.scheme() === '';\r\n                if (!isCssUrlRelative) {\r\n                    // Absolute URLs don't need programmatic fetching\r\n                    return;\r\n                }\r\n                var resourceUriRelativeToPackageDocument = (new URI(extractedUrl)).absoluteTo(styleSheetUriRelativeToPackageDocument).toString();\r\n\r\n                var cachedResourceURL = _publicationResourcesCache.getResourceURL(resourceUriRelativeToPackageDocument);\r\n\r\n\r\n                if (cachedResourceURL) {\r\n                    stylesheetCssResourceUrlsMap[origMatchedUrlString] = {\r\n                        isStyleSheetResource: isStyleSheetResource,\r\n                        resourceObjectURL: cachedResourceURL\r\n                    };\r\n                } else {\r\n                    var cssUrlFetchDeferred = $.Deferred();\r\n                    cssResourceDownloadDeferreds.push(cssUrlFetchDeferred);\r\n\r\n                    var processedBlobCallback = function (resourceDataBlob) {\r\n                        //noinspection JSUnresolvedVariable,JSUnresolvedFunction\r\n                        var resourceObjectURL = window.URL.createObjectURL(resourceDataBlob);\r\n                        stylesheetCssResourceUrlsMap[origMatchedUrlString] = {\r\n                            isStyleSheetResource: isStyleSheetResource,\r\n                            resourceObjectURL: resourceObjectURL\r\n                        };\r\n                        _publicationResourcesCache.putResource(resourceUriRelativeToPackageDocument,\r\n                            resourceObjectURL, resourceDataBlob);\r\n                        cssUrlFetchDeferred.resolve();\r\n                    };\r\n                    var fetchErrorCallback = function (error) {\r\n                        _handleError(error);\r\n                        cssUrlFetchDeferred.resolve();\r\n                    };\r\n\r\n                    var fetchMode;\r\n                    var fetchCallback;\r\n                    if (isStyleSheetResource) {\r\n                        // TODO: test whether recursion works for nested @import rules with arbitrary indirection depth.\r\n                        fetchMode = 'text';\r\n                        fetchCallback = function (styleSheetResourceData) {\r\n                            preprocessCssStyleSheetData(styleSheetResourceData, resourceUriRelativeToPackageDocument,\r\n                                function (preprocessedStyleSheetData) {\r\n                                    var resourceDataBlob = new Blob([preprocessedStyleSheetData], {type: 'text/css'});\r\n                                    processedBlobCallback(resourceDataBlob);\r\n                                })\r\n                        }\r\n                    } else {\r\n                        fetchMode = 'blob';\r\n                        fetchCallback = processedBlobCallback;\r\n                    }\r\n\r\n                    _publicationFetcher.relativeToPackageFetchFileContents(resourceUriRelativeToPackageDocument,\r\n                        fetchMode,\r\n                        fetchCallback, fetchErrorCallback);\r\n                }\r\n            }\r\n\r\n            function preprocessCssStyleSheetData(styleSheetResourceData, styleSheetUriRelativeToPackageDocument,\r\n                                                 callback) {\r\n                var cssUrlRegexp = /[Uu][Rr][Ll]\\(\\s*([']([^']+)[']|[\"]([^\"]+)[\"]|([^)]+))\\s*\\)/g;\r\n                var nonUrlCssImportRegexp = /@[Ii][Mm][Pp][Oo][Rr][Tt]\\s*('([^']+)'|\"([^\"]+)\")/g;\r\n                var stylesheetCssResourceUrlsMap = {};\r\n                var cssResourceDownloadDeferreds = [];\r\n                // Go through the stylesheet text using all regexps and process according to those regexp matches, if any:\r\n                [nonUrlCssImportRegexp, cssUrlRegexp].forEach(function (processingRegexp) {\r\n                    // extract all URL references in the CSS sheet,\r\n                    var cssUrlMatch = processingRegexp.exec(styleSheetResourceData);\r\n                    while (cssUrlMatch != null) {\r\n                        // then fetch and replace them with corresponding object URLs:\r\n                        var isStyleSheetResource = false;\r\n                        // Special handling of @import-ed stylesheet files - recursive preprocessing:\r\n                        // TODO: will not properly handle @import url(...):\r\n                        if (processingRegexp == nonUrlCssImportRegexp) {\r\n                            // This resource URL points to an @import-ed CSS stylesheet file. Need to preprocess its text\r\n                            // after fetching but before making an object URL of it:\r\n                            isStyleSheetResource = true;\r\n                        }\r\n                        fetchResourceForCssUrlMatch(cssUrlMatch, cssResourceDownloadDeferreds,\r\n                            styleSheetUriRelativeToPackageDocument, stylesheetCssResourceUrlsMap, isStyleSheetResource);\r\n                        cssUrlMatch = processingRegexp.exec(styleSheetResourceData);\r\n                    }\r\n\r\n                });\r\n\r\n                if (cssResourceDownloadDeferreds.length > 0) {\r\n                    $.when.apply($, cssResourceDownloadDeferreds).done(function () {\r\n                        for (var origMatchedUrlString in stylesheetCssResourceUrlsMap) {\r\n                            var processedResourceDescriptor = stylesheetCssResourceUrlsMap[origMatchedUrlString];\r\n\r\n\r\n                            var processedUrlString;\r\n                            if (processedResourceDescriptor.isStyleSheetResource) {\r\n                                processedUrlString = '@import \"' + processedResourceDescriptor.resourceObjectURL + '\"';\r\n                            } else {\r\n                                processedUrlString = \"url('\" + processedResourceDescriptor.resourceObjectURL + \"')\";\r\n                            }\r\n                            var origMatchedUrlStringEscaped = origMatchedUrlString.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\r\n                                \"\\\\$&\");\r\n                            var origMatchedUrlStringRegExp = new RegExp(origMatchedUrlStringEscaped, 'g');\r\n                            //noinspection JSCheckFunctionSignatures\r\n                            styleSheetResourceData =\r\n                                styleSheetResourceData.replace(origMatchedUrlStringRegExp, processedUrlString, 'g');\r\n\r\n                        }\r\n                        callback(styleSheetResourceData);\r\n                    });\r\n                } else {\r\n                    callback(styleSheetResourceData);\r\n                }\r\n            }\r\n\r\n\r\n            function resolveResourceElements(elemName, refAttr, fetchMode, resolutionDeferreds, onerror,\r\n                                             resourceDataPreprocessing) {\r\n\r\n                var resolvedElems = $(elemName + '[' + refAttr.replace(':', '\\\\:') + ']', _contentDocumentDom);\r\n\r\n                resolvedElems.each(function (index, resolvedElem) {\r\n                    var refAttrOrigVal = $(resolvedElem).attr(refAttr);\r\n                    var refAttrUri = new URI(refAttrOrigVal);\r\n\r\n                    if (refAttrUri.scheme() === '') {\r\n                        // Relative URI, fetch from packed EPUB archive:\r\n\r\n                        fetchResourceForElement(resolvedElem, refAttrOrigVal, refAttr, fetchMode, resolutionDeferreds,\r\n                            onerror, resourceDataPreprocessing);\r\n                    }\r\n                });\r\n            }\r\n\r\n            function resolveDocumentImages(resolutionDeferreds, onerror) {\r\n                resolveResourceElements('img', 'src', 'blob', resolutionDeferreds, onerror);\r\n                resolveResourceElements('image', 'xlink:href', 'blob', resolutionDeferreds, onerror);\r\n            }\r\n\r\n            function resolveDocumentAudios(resolutionDeferreds, onerror) {\r\n                resolveResourceElements('audio', 'src', 'blob', resolutionDeferreds, onerror);\r\n            }\r\n\r\n            function resolveDocumentVideos(resolutionDeferreds, onerror) {\r\n                resolveResourceElements('video', 'src', 'blob', resolutionDeferreds, onerror);\r\n                resolveResourceElements('video', 'poster', 'blob', resolutionDeferreds, onerror);\r\n            }\r\n\r\n            function resolveDocumentScripts(resolutionDeferreds, onerror) {\r\n                resolveResourceElements('script', 'src', 'blob', resolutionDeferreds, onerror);\r\n            }\r\n\r\n            function resolveDocumentIframes(resolutionDeferreds, onerror) {\r\n                resolveResourceElements('iframe', 'src', 'blob', resolutionDeferreds, onerror);\r\n            }\r\n\r\n            function resolveDocumentLinkStylesheets(resolutionDeferreds, onerror) {\r\n                resolveResourceElements('link', 'href', 'text', resolutionDeferreds, onerror,\r\n                    preprocessCssStyleSheetData);\r\n            }\r\n\r\n            function resolveDocumentEmbeddedStylesheets(resolutionDeferreds, onerror) {\r\n                var resolvedElems = $('style', _contentDocumentDom);\r\n                resolvedElems.each(function (index, resolvedElem) {\r\n                    var resolutionDeferred = $.Deferred();\r\n                    resolutionDeferreds.push(resolutionDeferred);\r\n                    var styleSheetData = $(resolvedElem).text();\r\n                    preprocessCssStyleSheetData(styleSheetData, _contentDocumentPathRelativeToPackage,\r\n                        function (resolvedStylesheetData) {\r\n                            $(resolvedElem).text(resolvedStylesheetData);\r\n                            resolutionDeferred.resolve();\r\n                        });\r\n                });\r\n            }\r\n\r\n        };\r\n\r\n        return ContentDocumentFetcher;\r\n\r\n    }\r\n);\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/resource_cache',['underscore'], function (_) {\r\n\r\n        var ResourceCache = function(sourceWindow, configuredCacheSizeEvictThreshold) {\r\n\r\n            var self = this;\r\n            var _resourcesHash = {};\r\n            var _orderingByLastUseTimestamp = [];\r\n            var _cacheSize = 0;\r\n            var CACHE_SIZE_EVICT_THRESHOLD_DEFAULT = 100000000;\r\n            var cacheSizeEvictThreshold = determineCacheSizeThreshold();\r\n\r\n            function getTimestamp() {\r\n                return new Date().getTime();\r\n            }\r\n\r\n            function getBrowserHeapLimitInBytes() {\r\n                if (window.performance && window.performance.memory && window.performance.memory.jsHeapSizeLimit) {\r\n                    return window.performance.memory.jsHeapSizeLimit;\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            function determineCacheSizeThreshold() {\r\n                if (configuredCacheSizeEvictThreshold) {\r\n                    return configuredCacheSizeEvictThreshold;\r\n                }\r\n                var browserHeapLimitInBytes = getBrowserHeapLimitInBytes();\r\n                if (browserHeapLimitInBytes && browserHeapLimitInBytes / 10 > CACHE_SIZE_EVICT_THRESHOLD_DEFAULT) {\r\n                    return browserHeapLimitInBytes / 10;\r\n                } else {\r\n                    return  CACHE_SIZE_EVICT_THRESHOLD_DEFAULT;\r\n                }\r\n            }\r\n\r\n            this.getResourceURL = function(resourceAbsoluteHref) {\r\n                var resourceObjectUrl = null;\r\n                var resourceData = _resourcesHash[resourceAbsoluteHref];\r\n                if (resourceData) {\r\n                    resourceObjectUrl = resourceData.url;\r\n                    resourceData.lastUseTimestamp = getTimestamp();\r\n                    updateOrderedIndex(resourceData);\r\n                }\r\n                return resourceObjectUrl;\r\n            };\r\n\r\n            function removeCacheEntryFromOrderedIndex(cacheEntry) {\r\n                // Remove the previous entry from the ordered index, if present:\r\n                if (typeof cacheEntry.orderingByLastUseTimestampIdx !== 'undefined') {\r\n                    var orderingByLastUseTimestampIdx = cacheEntry.orderingByLastUseTimestampIdx;\r\n                    _orderingByLastUseTimestamp.splice(orderingByLastUseTimestampIdx, 1);\r\n                    // Decrement index values for all downshifted entries:\r\n                    for (var i = orderingByLastUseTimestampIdx; i < _orderingByLastUseTimestamp.length; i++) {\r\n                        var downshiftedEntry = _orderingByLastUseTimestamp[i];\r\n                        // Assertion\r\n                        if ((downshiftedEntry.orderingByLastUseTimestampIdx - 1) != i) {\r\n                            console.error('algorithm incorrect: downshiftedEntry.orderingByLastUseTimestampIdx: ' +\r\n                                downshiftedEntry.orderingByLastUseTimestampIdx + ', i: ' + i);\r\n                        }\r\n                        downshiftedEntry.orderingByLastUseTimestampIdx = i;\r\n                    }\r\n                }\r\n            }\r\n\r\n            function updateOrderedIndex(cacheEntry) {\r\n                removeCacheEntryFromOrderedIndex(cacheEntry);\r\n                var insertIdx = _.sortedIndex(_orderingByLastUseTimestamp, cacheEntry, 'lastUseTimestamp');\r\n                _orderingByLastUseTimestamp.splice(insertIdx, 0, cacheEntry);\r\n                cacheEntry.orderingByLastUseTimestampIdx = insertIdx;\r\n            }\r\n\r\n            this.putResource = function(resourceAbsoluteHref, resourceObjectUrl, resourceDataBlob) {\r\n                this.trimCache();\r\n                var currentTimestamp = getTimestamp();\r\n                var cacheEntry = {\r\n                    url: resourceObjectUrl,\r\n                    absoluteHref: resourceAbsoluteHref,\r\n                    blob: resourceDataBlob,\r\n                    blobSize: resourceDataBlob.size,\r\n                    creationTimestamp: currentTimestamp,\r\n                    lastUseTimestamp: currentTimestamp,\r\n                    pinned: true\r\n                };\r\n                _resourcesHash[resourceAbsoluteHref] = cacheEntry;\r\n                updateOrderedIndex(cacheEntry);\r\n                _cacheSize += resourceDataBlob.size;\r\n            };\r\n\r\n            this.evictResource = function(resourceAbsoluteHref) {\r\n                var resourceData = _resourcesHash[resourceAbsoluteHref];\r\n                if (resourceData) {\r\n                    sourceWindow.URL.revokeObjectURL(resourceData.url);\r\n                    _cacheSize -= resourceData.blobSize;\r\n                    removeCacheEntryFromOrderedIndex(resourceData);\r\n                    delete _resourcesHash[resourceAbsoluteHref];\r\n                }\r\n            };\r\n\r\n            this.flushCache = function() {\r\n                // TODO: more efficient, but less code reuse: iterate over _sortedIndex first,\r\n                // then assert an empty cache and perform backup cleanup if assertion failed\r\n                for (var resourceAbsoluteHref in _resourcesHash) {\r\n                    this.evictResource(resourceAbsoluteHref);\r\n                }\r\n                // Assertion\r\n                if (_cacheSize != 0) {\r\n                    console.error('cacheSize accounting error! cacheSize: ' + _cacheSize + ', _resourcesHash:');\r\n                    console.error(_resourcesHash);\r\n                }\r\n                _orderingByLastUseTimestamp = [];\r\n                //console.log('Cache contents:');\r\n                //console.log(_resourcesHash);\r\n                //console.log('_orderingByLastUseTimestamp:');\r\n                //console.log(_orderingByLastUseTimestamp);\r\n                //console.log('Cache size:' + _cacheSize);\r\n            };\r\n\r\n            this.unPinResources = function() {\r\n                for (var resourceAbsoluteHref in _resourcesHash) {\r\n                    var resourceData = _resourcesHash[resourceAbsoluteHref];\r\n                    resourceData.pinned = false;\r\n                }\r\n            };\r\n\r\n            function orderingByLastUseTimestampToString() {\r\n                return _orderingByLastUseTimestamp.reduce(function(previousValue, currentValue) {\r\n                    return previousValue + (previousValue.length > 1 ? ', ' : '') + '[' +\r\n                        currentValue.absoluteHref + ', pinned: ' + currentValue.pinned +\r\n                        ', orderingByLastUseTimestampIdx: ' + currentValue.orderingByLastUseTimestampIdx + ']'\r\n                }, '');\r\n            }\r\n\r\n            this.trimCache = function() {\r\n                if (_cacheSize < cacheSizeEvictThreshold) {\r\n                    return;\r\n                }\r\n                console.log('Trimming cache. Current cache size: ' + _cacheSize);\r\n\r\n                // Loop through ordered index (by last use timestamp) starting from the least recently used entries.\r\n                // evict unpinned resources until either:\r\n                // 1) cache size drops below CACHE_SIZE_EVICT_THRESHOLD\r\n                // 2) there are no more unpinned resources to evict\r\n                for (var i = 0; i < _orderingByLastUseTimestamp.length; i++) {\r\n                    if (_cacheSize < cacheSizeEvictThreshold) {\r\n                        break;\r\n                    }\r\n                    var cacheEntry = _orderingByLastUseTimestamp[i];\r\n                    if (!cacheEntry.pinned) {\r\n                        var resourceAbsoluteHref = cacheEntry.absoluteHref;\r\n                        //console.log('Preparing to evict ' + resourceAbsoluteHref);\r\n                        //console.log('_orderingByLastUseTimestamp:');\r\n                        //console.log(orderingByLastUseTimestampToString());\r\n                        this.evictResource(resourceAbsoluteHref);\r\n                        //console.log('Evicted ' + resourceAbsoluteHref);\r\n                        //console.log('Current cache size: ' + _cacheSize);\r\n                        //console.log('_orderingByLastUseTimestamp:');\r\n                        //console.log(orderingByLastUseTimestampToString());\r\n                        //console.log('i: ' + i);\r\n\r\n                        // The consequent array elements have downshifted by one position.\r\n                        // The i variable now points to a different element - the evicted element's successor\r\n                        // (if not beyond array's end).\r\n                        // Make the i variable remain in place - compensate for its upcoming incrementation:\r\n                        i--;\r\n                    }\r\n                }\r\n                console.log('Cache size after trimming: ' + _cacheSize);\r\n            };\r\n        };\r\n\r\n        return ResourceCache;\r\n    });\r\n\n",
    ";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory();\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine('cryptoJs/core',[], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\troot.CryptoJS = factory();\n\t}\n}(this, function () {\n\n\t/**\n\t * CryptoJS core components.\n\t */\n\tvar CryptoJS = CryptoJS || (function (Math, undefined) {\n\t    /**\n\t     * CryptoJS namespace.\n\t     */\n\t    var C = {};\n\n\t    /**\n\t     * Library namespace.\n\t     */\n\t    var C_lib = C.lib = {};\n\n\t    /**\n\t     * Base object for prototypal inheritance.\n\t     */\n\t    var Base = C_lib.Base = (function () {\n\t        function F() {}\n\n\t        return {\n\t            /**\n\t             * Creates a new object that inherits from this object.\n\t             *\n\t             * @param {Object} overrides Properties to copy into the new object.\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         field: 'value',\n\t             *\n\t             *         method: function () {\n\t             *         }\n\t             *     });\n\t             */\n\t            extend: function (overrides) {\n\t                // Spawn\n\t                F.prototype = this;\n\t                var subtype = new F();\n\n\t                // Augment\n\t                if (overrides) {\n\t                    subtype.mixIn(overrides);\n\t                }\n\n\t                // Create default initializer\n\t                if (!subtype.hasOwnProperty('init')) {\n\t                    subtype.init = function () {\n\t                        subtype.$super.init.apply(this, arguments);\n\t                    };\n\t                }\n\n\t                // Initializer's prototype is the subtype object\n\t                subtype.init.prototype = subtype;\n\n\t                // Reference supertype\n\t                subtype.$super = this;\n\n\t                return subtype;\n\t            },\n\n\t            /**\n\t             * Extends this object and runs the init method.\n\t             * Arguments to create() will be passed to init().\n\t             *\n\t             * @return {Object} The new object.\n\t             *\n\t             * @static\n\t             *\n\t             * @example\n\t             *\n\t             *     var instance = MyType.create();\n\t             */\n\t            create: function () {\n\t                var instance = this.extend();\n\t                instance.init.apply(instance, arguments);\n\n\t                return instance;\n\t            },\n\n\t            /**\n\t             * Initializes a newly created object.\n\t             * Override this method to add some logic when your objects are created.\n\t             *\n\t             * @example\n\t             *\n\t             *     var MyType = CryptoJS.lib.Base.extend({\n\t             *         init: function () {\n\t             *             // ...\n\t             *         }\n\t             *     });\n\t             */\n\t            init: function () {\n\t            },\n\n\t            /**\n\t             * Copies properties into this object.\n\t             *\n\t             * @param {Object} properties The properties to mix in.\n\t             *\n\t             * @example\n\t             *\n\t             *     MyType.mixIn({\n\t             *         field: 'value'\n\t             *     });\n\t             */\n\t            mixIn: function (properties) {\n\t                for (var propertyName in properties) {\n\t                    if (properties.hasOwnProperty(propertyName)) {\n\t                        this[propertyName] = properties[propertyName];\n\t                    }\n\t                }\n\n\t                // IE won't copy toString using the loop above\n\t                if (properties.hasOwnProperty('toString')) {\n\t                    this.toString = properties.toString;\n\t                }\n\t            },\n\n\t            /**\n\t             * Creates a copy of this object.\n\t             *\n\t             * @return {Object} The clone.\n\t             *\n\t             * @example\n\t             *\n\t             *     var clone = instance.clone();\n\t             */\n\t            clone: function () {\n\t                return this.init.prototype.extend(this);\n\t            }\n\t        };\n\t    }());\n\n\t    /**\n\t     * An array of 32-bit words.\n\t     *\n\t     * @property {Array} words The array of 32-bit words.\n\t     * @property {number} sigBytes The number of significant bytes in this word array.\n\t     */\n\t    var WordArray = C_lib.WordArray = Base.extend({\n\t        /**\n\t         * Initializes a newly created word array.\n\t         *\n\t         * @param {Array} words (Optional) An array of 32-bit words.\n\t         * @param {number} sigBytes (Optional) The number of significant bytes in the words.\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.create();\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607]);\n\t         *     var wordArray = CryptoJS.lib.WordArray.create([0x00010203, 0x04050607], 6);\n\t         */\n\t        init: function (words, sigBytes) {\n\t            words = this.words = words || [];\n\n\t            if (sigBytes != undefined) {\n\t                this.sigBytes = sigBytes;\n\t            } else {\n\t                this.sigBytes = words.length * 4;\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts this word array to a string.\n\t         *\n\t         * @param {Encoder} encoder (Optional) The encoding strategy to use. Default: CryptoJS.enc.Hex\n\t         *\n\t         * @return {string} The stringified word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     var string = wordArray + '';\n\t         *     var string = wordArray.toString();\n\t         *     var string = wordArray.toString(CryptoJS.enc.Utf8);\n\t         */\n\t        toString: function (encoder) {\n\t            return (encoder || Hex).stringify(this);\n\t        },\n\n\t        /**\n\t         * Concatenates a word array to this word array.\n\t         *\n\t         * @param {WordArray} wordArray The word array to append.\n\t         *\n\t         * @return {WordArray} This word array.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray1.concat(wordArray2);\n\t         */\n\t        concat: function (wordArray) {\n\t            // Shortcuts\n\t            var thisWords = this.words;\n\t            var thatWords = wordArray.words;\n\t            var thisSigBytes = this.sigBytes;\n\t            var thatSigBytes = wordArray.sigBytes;\n\n\t            // Clamp excess bits\n\t            this.clamp();\n\n\t            // Concat\n\t            if (thisSigBytes % 4) {\n\t                // Copy one byte at a time\n\t                for (var i = 0; i < thatSigBytes; i++) {\n\t                    var thatByte = (thatWords[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                    thisWords[(thisSigBytes + i) >>> 2] |= thatByte << (24 - ((thisSigBytes + i) % 4) * 8);\n\t                }\n\t            } else if (thatWords.length > 0xffff) {\n\t                // Copy one word at a time\n\t                for (var i = 0; i < thatSigBytes; i += 4) {\n\t                    thisWords[(thisSigBytes + i) >>> 2] = thatWords[i >>> 2];\n\t                }\n\t            } else {\n\t                // Copy all words at once\n\t                thisWords.push.apply(thisWords, thatWords);\n\t            }\n\t            this.sigBytes += thatSigBytes;\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Removes insignificant bits.\n\t         *\n\t         * @example\n\t         *\n\t         *     wordArray.clamp();\n\t         */\n\t        clamp: function () {\n\t            // Shortcuts\n\t            var words = this.words;\n\t            var sigBytes = this.sigBytes;\n\n\t            // Clamp\n\t            words[sigBytes >>> 2] &= 0xffffffff << (32 - (sigBytes % 4) * 8);\n\t            words.length = Math.ceil(sigBytes / 4);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this word array.\n\t         *\n\t         * @return {WordArray} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = wordArray.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone.words = this.words.slice(0);\n\n\t            return clone;\n\t        },\n\n\t        /**\n\t         * Creates a word array filled with random bytes.\n\t         *\n\t         * @param {number} nBytes The number of random bytes to generate.\n\t         *\n\t         * @return {WordArray} The random word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.lib.WordArray.random(16);\n\t         */\n\t        random: function (nBytes) {\n\t            var words = [];\n\n\t            var r = (function (m_w) {\n\t                var m_w = m_w;\n\t                var m_z = 0x3ade68b1;\n\t                var mask = 0xffffffff;\n\n\t                return function () {\n\t                    m_z = (0x9069 * (m_z & 0xFFFF) + (m_z >> 0x10)) & mask;\n\t                    m_w = (0x4650 * (m_w & 0xFFFF) + (m_w >> 0x10)) & mask;\n\t                    var result = ((m_z << 0x10) + m_w) & mask;\n\t                    result /= 0x100000000;\n\t                    result += 0.5;\n\t                    return result * (Math.random() > .5 ? 1 : -1);\n\t                }\n\t            });\n\n\t            for (var i = 0, rcache; i < nBytes; i += 4) {\n\t                var _r = r((rcache || Math.random()) * 0x100000000);\n\n\t                rcache = _r() * 0x3ade67b7;\n\t                words.push((_r() * 0x100000000) | 0);\n\t            }\n\n\t            return new WordArray.init(words, nBytes);\n\t        }\n\t    });\n\n\t    /**\n\t     * Encoder namespace.\n\t     */\n\t    var C_enc = C.enc = {};\n\n\t    /**\n\t     * Hex encoding strategy.\n\t     */\n\t    var Hex = C_enc.Hex = {\n\t        /**\n\t         * Converts a word array to a hex string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The hex string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var hexString = CryptoJS.enc.Hex.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var hexChars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                hexChars.push((bite >>> 4).toString(16));\n\t                hexChars.push((bite & 0x0f).toString(16));\n\t            }\n\n\t            return hexChars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a hex string to a word array.\n\t         *\n\t         * @param {string} hexStr The hex string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Hex.parse(hexString);\n\t         */\n\t        parse: function (hexStr) {\n\t            // Shortcut\n\t            var hexStrLength = hexStr.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < hexStrLength; i += 2) {\n\t                words[i >>> 3] |= parseInt(hexStr.substr(i, 2), 16) << (24 - (i % 8) * 4);\n\t            }\n\n\t            return new WordArray.init(words, hexStrLength / 2);\n\t        }\n\t    };\n\n\t    /**\n\t     * Latin1 encoding strategy.\n\t     */\n\t    var Latin1 = C_enc.Latin1 = {\n\t        /**\n\t         * Converts a word array to a Latin1 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The Latin1 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var latin1String = CryptoJS.enc.Latin1.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            // Shortcuts\n\t            var words = wordArray.words;\n\t            var sigBytes = wordArray.sigBytes;\n\n\t            // Convert\n\t            var latin1Chars = [];\n\t            for (var i = 0; i < sigBytes; i++) {\n\t                var bite = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\n\t                latin1Chars.push(String.fromCharCode(bite));\n\t            }\n\n\t            return latin1Chars.join('');\n\t        },\n\n\t        /**\n\t         * Converts a Latin1 string to a word array.\n\t         *\n\t         * @param {string} latin1Str The Latin1 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Latin1.parse(latin1String);\n\t         */\n\t        parse: function (latin1Str) {\n\t            // Shortcut\n\t            var latin1StrLength = latin1Str.length;\n\n\t            // Convert\n\t            var words = [];\n\t            for (var i = 0; i < latin1StrLength; i++) {\n\t                words[i >>> 2] |= (latin1Str.charCodeAt(i) & 0xff) << (24 - (i % 4) * 8);\n\t            }\n\n\t            return new WordArray.init(words, latin1StrLength);\n\t        }\n\t    };\n\n\t    /**\n\t     * UTF-8 encoding strategy.\n\t     */\n\t    var Utf8 = C_enc.Utf8 = {\n\t        /**\n\t         * Converts a word array to a UTF-8 string.\n\t         *\n\t         * @param {WordArray} wordArray The word array.\n\t         *\n\t         * @return {string} The UTF-8 string.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var utf8String = CryptoJS.enc.Utf8.stringify(wordArray);\n\t         */\n\t        stringify: function (wordArray) {\n\t            try {\n\t                return decodeURIComponent(escape(Latin1.stringify(wordArray)));\n\t            } catch (e) {\n\t                throw new Error('Malformed UTF-8 data');\n\t            }\n\t        },\n\n\t        /**\n\t         * Converts a UTF-8 string to a word array.\n\t         *\n\t         * @param {string} utf8Str The UTF-8 string.\n\t         *\n\t         * @return {WordArray} The word array.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var wordArray = CryptoJS.enc.Utf8.parse(utf8String);\n\t         */\n\t        parse: function (utf8Str) {\n\t            return Latin1.parse(unescape(encodeURIComponent(utf8Str)));\n\t        }\n\t    };\n\n\t    /**\n\t     * Abstract buffered block algorithm template.\n\t     *\n\t     * The property blockSize must be implemented in a concrete subtype.\n\t     *\n\t     * @property {number} _minBufferSize The number of blocks that should be kept unprocessed in the buffer. Default: 0\n\t     */\n\t    var BufferedBlockAlgorithm = C_lib.BufferedBlockAlgorithm = Base.extend({\n\t        /**\n\t         * Resets this block algorithm's data buffer to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm.reset();\n\t         */\n\t        reset: function () {\n\t            // Initial values\n\t            this._data = new WordArray.init();\n\t            this._nDataBytes = 0;\n\t        },\n\n\t        /**\n\t         * Adds new data to this block algorithm's buffer.\n\t         *\n\t         * @param {WordArray|string} data The data to append. Strings are converted to a WordArray using UTF-8.\n\t         *\n\t         * @example\n\t         *\n\t         *     bufferedBlockAlgorithm._append('data');\n\t         *     bufferedBlockAlgorithm._append(wordArray);\n\t         */\n\t        _append: function (data) {\n\t            // Convert string to WordArray, else assume WordArray already\n\t            if (typeof data == 'string') {\n\t                data = Utf8.parse(data);\n\t            }\n\n\t            // Append\n\t            this._data.concat(data);\n\t            this._nDataBytes += data.sigBytes;\n\t        },\n\n\t        /**\n\t         * Processes available data blocks.\n\t         *\n\t         * This method invokes _doProcessBlock(offset), which must be implemented by a concrete subtype.\n\t         *\n\t         * @param {boolean} doFlush Whether all blocks and partial blocks should be processed.\n\t         *\n\t         * @return {WordArray} The processed data.\n\t         *\n\t         * @example\n\t         *\n\t         *     var processedData = bufferedBlockAlgorithm._process();\n\t         *     var processedData = bufferedBlockAlgorithm._process(!!'flush');\n\t         */\n\t        _process: function (doFlush) {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\t            var dataSigBytes = data.sigBytes;\n\t            var blockSize = this.blockSize;\n\t            var blockSizeBytes = blockSize * 4;\n\n\t            // Count blocks ready\n\t            var nBlocksReady = dataSigBytes / blockSizeBytes;\n\t            if (doFlush) {\n\t                // Round up to include partial blocks\n\t                nBlocksReady = Math.ceil(nBlocksReady);\n\t            } else {\n\t                // Round down to include only full blocks,\n\t                // less the number of blocks that must remain in the buffer\n\t                nBlocksReady = Math.max((nBlocksReady | 0) - this._minBufferSize, 0);\n\t            }\n\n\t            // Count words ready\n\t            var nWordsReady = nBlocksReady * blockSize;\n\n\t            // Count bytes ready\n\t            var nBytesReady = Math.min(nWordsReady * 4, dataSigBytes);\n\n\t            // Process blocks\n\t            if (nWordsReady) {\n\t                for (var offset = 0; offset < nWordsReady; offset += blockSize) {\n\t                    // Perform concrete-algorithm logic\n\t                    this._doProcessBlock(dataWords, offset);\n\t                }\n\n\t                // Remove processed words\n\t                var processedWords = dataWords.splice(0, nWordsReady);\n\t                data.sigBytes -= nBytesReady;\n\t            }\n\n\t            // Return processed words\n\t            return new WordArray.init(processedWords, nBytesReady);\n\t        },\n\n\t        /**\n\t         * Creates a copy of this object.\n\t         *\n\t         * @return {Object} The clone.\n\t         *\n\t         * @example\n\t         *\n\t         *     var clone = bufferedBlockAlgorithm.clone();\n\t         */\n\t        clone: function () {\n\t            var clone = Base.clone.call(this);\n\t            clone._data = this._data.clone();\n\n\t            return clone;\n\t        },\n\n\t        _minBufferSize: 0\n\t    });\n\n\t    /**\n\t     * Abstract hasher template.\n\t     *\n\t     * @property {number} blockSize The number of 32-bit words this hasher operates on. Default: 16 (512 bits)\n\t     */\n\t    var Hasher = C_lib.Hasher = BufferedBlockAlgorithm.extend({\n\t        /**\n\t         * Configuration options.\n\t         */\n\t        cfg: Base.extend(),\n\n\t        /**\n\t         * Initializes a newly created hasher.\n\t         *\n\t         * @param {Object} cfg (Optional) The configuration options to use for this hash computation.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hasher = CryptoJS.algo.SHA256.create();\n\t         */\n\t        init: function (cfg) {\n\t            // Apply config defaults\n\t            this.cfg = this.cfg.extend(cfg);\n\n\t            // Set initial values\n\t            this.reset();\n\t        },\n\n\t        /**\n\t         * Resets this hasher to its initial state.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.reset();\n\t         */\n\t        reset: function () {\n\t            // Reset data buffer\n\t            BufferedBlockAlgorithm.reset.call(this);\n\n\t            // Perform concrete-hasher logic\n\t            this._doReset();\n\t        },\n\n\t        /**\n\t         * Updates this hasher with a message.\n\t         *\n\t         * @param {WordArray|string} messageUpdate The message to append.\n\t         *\n\t         * @return {Hasher} This hasher.\n\t         *\n\t         * @example\n\t         *\n\t         *     hasher.update('message');\n\t         *     hasher.update(wordArray);\n\t         */\n\t        update: function (messageUpdate) {\n\t            // Append\n\t            this._append(messageUpdate);\n\n\t            // Update the hash\n\t            this._process();\n\n\t            // Chainable\n\t            return this;\n\t        },\n\n\t        /**\n\t         * Finalizes the hash computation.\n\t         * Note that the finalize operation is effectively a destructive, read-once operation.\n\t         *\n\t         * @param {WordArray|string} messageUpdate (Optional) A final message update.\n\t         *\n\t         * @return {WordArray} The hash.\n\t         *\n\t         * @example\n\t         *\n\t         *     var hash = hasher.finalize();\n\t         *     var hash = hasher.finalize('message');\n\t         *     var hash = hasher.finalize(wordArray);\n\t         */\n\t        finalize: function (messageUpdate) {\n\t            // Final message update\n\t            if (messageUpdate) {\n\t                this._append(messageUpdate);\n\t            }\n\n\t            // Perform concrete-hasher logic\n\t            var hash = this._doFinalize();\n\n\t            return hash;\n\t        },\n\n\t        blockSize: 512/32,\n\n\t        /**\n\t         * Creates a shortcut function to a hasher's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to create a helper for.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var SHA256 = CryptoJS.lib.Hasher._createHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHelper: function (hasher) {\n\t            return function (message, cfg) {\n\t                return new hasher.init(cfg).finalize(message);\n\t            };\n\t        },\n\n\t        /**\n\t         * Creates a shortcut function to the HMAC's object interface.\n\t         *\n\t         * @param {Hasher} hasher The hasher to use in this HMAC helper.\n\t         *\n\t         * @return {Function} The shortcut function.\n\t         *\n\t         * @static\n\t         *\n\t         * @example\n\t         *\n\t         *     var HmacSHA256 = CryptoJS.lib.Hasher._createHmacHelper(CryptoJS.algo.SHA256);\n\t         */\n\t        _createHmacHelper: function (hasher) {\n\t            return function (message, key) {\n\t                return new C_algo.HMAC.init(hasher, key).finalize(message);\n\t            };\n\t        }\n\t    });\n\n\t    /**\n\t     * Algorithm namespace.\n\t     */\n\t    var C_algo = C.algo = {};\n\n\t    return C;\n\t}(Math));\n\n\n\treturn CryptoJS;\n\n}));\ndefine('cryptoJs', ['cryptoJs/core'], function (main) { return main; });\n\n",
    ";(function (root, factory) {\n\tif (typeof exports === \"object\") {\n\t\t// CommonJS\n\t\tmodule.exports = exports = factory(require(\"./core\"));\n\t}\n\telse if (typeof define === \"function\" && define.amd) {\n\t\t// AMD\n\t\tdefine('cryptoJs/sha1',[\"./core\"], factory);\n\t}\n\telse {\n\t\t// Global (browser)\n\t\tfactory(root.CryptoJS);\n\t}\n}(this, function (CryptoJS) {\n\n\t(function () {\n\t    // Shortcuts\n\t    var C = CryptoJS;\n\t    var C_lib = C.lib;\n\t    var WordArray = C_lib.WordArray;\n\t    var Hasher = C_lib.Hasher;\n\t    var C_algo = C.algo;\n\n\t    // Reusable object\n\t    var W = [];\n\n\t    /**\n\t     * SHA-1 hash algorithm.\n\t     */\n\t    var SHA1 = C_algo.SHA1 = Hasher.extend({\n\t        _doReset: function () {\n\t            this._hash = new WordArray.init([\n\t                0x67452301, 0xefcdab89,\n\t                0x98badcfe, 0x10325476,\n\t                0xc3d2e1f0\n\t            ]);\n\t        },\n\n\t        _doProcessBlock: function (M, offset) {\n\t            // Shortcut\n\t            var H = this._hash.words;\n\n\t            // Working variables\n\t            var a = H[0];\n\t            var b = H[1];\n\t            var c = H[2];\n\t            var d = H[3];\n\t            var e = H[4];\n\n\t            // Computation\n\t            for (var i = 0; i < 80; i++) {\n\t                if (i < 16) {\n\t                    W[i] = M[offset + i] | 0;\n\t                } else {\n\t                    var n = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n\t                    W[i] = (n << 1) | (n >>> 31);\n\t                }\n\n\t                var t = ((a << 5) | (a >>> 27)) + e + W[i];\n\t                if (i < 20) {\n\t                    t += ((b & c) | (~b & d)) + 0x5a827999;\n\t                } else if (i < 40) {\n\t                    t += (b ^ c ^ d) + 0x6ed9eba1;\n\t                } else if (i < 60) {\n\t                    t += ((b & c) | (b & d) | (c & d)) - 0x70e44324;\n\t                } else /* if (i < 80) */ {\n\t                    t += (b ^ c ^ d) - 0x359d3e2a;\n\t                }\n\n\t                e = d;\n\t                d = c;\n\t                c = (b << 30) | (b >>> 2);\n\t                b = a;\n\t                a = t;\n\t            }\n\n\t            // Intermediate hash value\n\t            H[0] = (H[0] + a) | 0;\n\t            H[1] = (H[1] + b) | 0;\n\t            H[2] = (H[2] + c) | 0;\n\t            H[3] = (H[3] + d) | 0;\n\t            H[4] = (H[4] + e) | 0;\n\t        },\n\n\t        _doFinalize: function () {\n\t            // Shortcuts\n\t            var data = this._data;\n\t            var dataWords = data.words;\n\n\t            var nBitsTotal = this._nDataBytes * 8;\n\t            var nBitsLeft = data.sigBytes * 8;\n\n\t            // Add padding\n\t            dataWords[nBitsLeft >>> 5] |= 0x80 << (24 - nBitsLeft % 32);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 14] = Math.floor(nBitsTotal / 0x100000000);\n\t            dataWords[(((nBitsLeft + 64) >>> 9) << 4) + 15] = nBitsTotal;\n\t            data.sigBytes = dataWords.length * 4;\n\n\t            // Hash final blocks\n\t            this._process();\n\n\t            // Return final computed hash\n\t            return this._hash;\n\t        },\n\n\t        clone: function () {\n\t            var clone = Hasher.clone.call(this);\n\t            clone._hash = this._hash.clone();\n\n\t            return clone;\n\t        }\n\t    });\n\n\t    /**\n\t     * Shortcut function to the hasher's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     *\n\t     * @return {WordArray} The hash.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hash = CryptoJS.SHA1('message');\n\t     *     var hash = CryptoJS.SHA1(wordArray);\n\t     */\n\t    C.SHA1 = Hasher._createHelper(SHA1);\n\n\t    /**\n\t     * Shortcut function to the HMAC's object interface.\n\t     *\n\t     * @param {WordArray|string} message The message to hash.\n\t     * @param {WordArray|string} key The secret key.\n\t     *\n\t     * @return {WordArray} The HMAC.\n\t     *\n\t     * @static\n\t     *\n\t     * @example\n\t     *\n\t     *     var hmac = CryptoJS.HmacSHA1(message, key);\n\t     */\n\t    C.HmacSHA1 = Hasher._createHmacHelper(SHA1);\n\t}());\n\n\n\treturn CryptoJS.SHA1;\n\n}));\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/encryption_handler',['cryptoJs/sha1'], function (SHA1) {\r\n\r\n    var EncryptionHandler = function (encryptionData) {\r\n        var self = this;\r\n\r\n        var ENCRYPTION_METHODS = {\r\n            'http://www.idpf.org/2008/embedding': embeddedFontDeobfuscateIdpf,\r\n            'http://ns.adobe.com/pdf/enc#RC': embeddedFontDeobfuscateAdobe\r\n        };\r\n\r\n        // INTERNAL FUNCTIONS\r\n\r\n        function blob2BinArray(blob, callback) {\r\n            var fileReader = new FileReader();\r\n            fileReader.onload = function () {\r\n                var arrayBuffer = this.result;\r\n                callback(new Uint8Array(arrayBuffer));\r\n            };\r\n            fileReader.readAsArrayBuffer(blob);\r\n        }\r\n\r\n        function xorObfuscatedBlob(obfuscatedResourceBlob, prefixLength, xorKey, callback) {\r\n            var obfuscatedPrefixBlob = obfuscatedResourceBlob.slice(0, prefixLength);\r\n            blob2BinArray(obfuscatedPrefixBlob, function (bytes) {\r\n                var masklen = xorKey.length;\r\n                for (var i = 0; i < prefixLength; i++) {\r\n                    bytes[i] = bytes[i] ^ (xorKey[i % masklen]);\r\n                }\r\n                var deobfuscatedPrefixBlob = new Blob([bytes], { type: obfuscatedResourceBlob.type });\r\n                var remainderBlob = obfuscatedResourceBlob.slice(prefixLength);\r\n                var deobfuscatedBlob = new Blob([deobfuscatedPrefixBlob, remainderBlob],\r\n                    { type: obfuscatedResourceBlob.type });\r\n\r\n                callback(deobfuscatedBlob);\r\n            });\r\n        }\r\n\r\n        function embeddedFontDeobfuscateIdpf(obfuscatedResourceBlob, callback) {\r\n\r\n            var prefixLength = 1040;\r\n            // Shamelessly copied from\r\n            // https://github.com/readium/readium-chrome-extension/blob/26d4b0cafd254cfa93bf7f6225887b83052642e0/scripts/models/path_resolver.js#L102 :\r\n            xorObfuscatedBlob(obfuscatedResourceBlob, prefixLength, encryptionData.uidHash, callback);\r\n        }\r\n\r\n        function urnUuidToByteArray(id) {\r\n            var uuidRegexp = /(urn:uuid:)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/i;\r\n            var matchResults = uuidRegexp.exec(id);\r\n            var rawUuid = matchResults[2] + matchResults[3] + matchResults[4] + matchResults[5] + matchResults[6];\r\n            if (!rawUuid || rawUuid.length != 32) {\r\n                console.error('Bad UUID format for ID :' + id);\r\n            }\r\n            var byteArray = [];\r\n            for (var i = 0; i < 16; i++) {\r\n                var byteHex = rawUuid.substr(i * 2, 2);\r\n                var byteNumber = parseInt(byteHex, 16);\r\n                byteArray.push(byteNumber);\r\n            }\r\n            return byteArray;\r\n        }\r\n\r\n        function embeddedFontDeobfuscateAdobe(obfuscatedResourceBlob, callback) {\r\n\r\n            // extract the UUID and convert to big-endian binary form (16 bytes):\r\n            var uidWordArray = urnUuidToByteArray(encryptionData.uid);\r\n            var prefixLength = 1024;\r\n            xorObfuscatedBlob(obfuscatedResourceBlob, prefixLength, uidWordArray, callback)\r\n        }\r\n\r\n\r\n        // PUBLIC API\r\n\r\n        this.isEncryptionSpecified = function () {\r\n            return encryptionData && encryptionData.encryptions;\r\n        };\r\n\r\n\r\n        this.getEncryptionMethodForRelativePath = function (pathRelativeToRoot) {\r\n            if (self.isEncryptionSpecified()) {\r\n                return encryptionData.encryptions[pathRelativeToRoot];\r\n            } else {\r\n                return undefined;\r\n            }\r\n        };\r\n\r\n        this.getDecryptionFunctionForRelativePath = function (pathRelativeToRoot) {\r\n            var encryptionMethod = self.getEncryptionMethodForRelativePath(pathRelativeToRoot);\r\n            if (encryptionMethod && ENCRYPTION_METHODS[encryptionMethod]) {\r\n                return ENCRYPTION_METHODS[encryptionMethod];\r\n            } else {\r\n                return undefined;\r\n            }\r\n        };\r\n\r\n    };\r\n\r\n    EncryptionHandler.CreateEncryptionData =  function(id, encryptionDom) {\r\n\r\n        var encryptionData = {\r\n            uid: id,\r\n            uidHash: SHA1(unescape(encodeURIComponent(id.trim())), { asBytes: true }),\r\n            encryptions: undefined\r\n        };\r\n\r\n        var encryptedData = $('EncryptedData', encryptionDom);\r\n        encryptedData.each(function (index, encryptedData) {\r\n            var encryptionAlgorithm = $('EncryptionMethod', encryptedData).first().attr('Algorithm');\r\n\r\n            // For some reason, jQuery selector \"\" against XML DOM sometimes doesn't match properly\r\n            var cipherReference = $('CipherReference', encryptedData);\r\n            cipherReference.each(function (index, CipherReference) {\r\n                var cipherReferenceURI = $(CipherReference).attr('URI');\r\n                console.log('Encryption/obfuscation algorithm ' + encryptionAlgorithm + ' specified for ' +\r\n                    cipherReferenceURI);\r\n\r\n                if(!encryptionData.encryptions) {\r\n                    encryptionData.encryptions = {};\r\n                }\r\n\r\n                encryptionData.encryptions[cipherReferenceURI] = encryptionAlgorithm;\r\n            });\r\n        });\r\n\r\n        return encryptionData;\r\n    };\r\n\r\n    return EncryptionHandler;\r\n});\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/publication_fetcher',['jquery', 'URIjs', './markup_parser', './plain_resource_fetcher', './zip_resource_fetcher',\r\n    './content_document_fetcher', './resource_cache', './encryption_handler'],\r\n    function ($, URI, MarkupParser, PlainResourceFetcher, ZipResourceFetcher, ContentDocumentFetcher,\r\n              ResourceCache, EncryptionHandler) {\r\n\r\n    var PublicationFetcher = function(bookRoot, jsLibRoot, sourceWindow, cacheSizeEvictThreshold, contentDocumentTextPreprocessor) {\r\n\r\n        var self = this;\r\n\r\n        self.contentTypePackageReadStrategyMap = {\r\n            'application/oebps-package+xml': 'exploded',\r\n            'application/epub+zip': 'zipped',\r\n            'application/zip': 'zipped'\r\n        };\r\n\r\n        var _shouldConstructDomProgrammatically;\r\n        var _resourceFetcher;\r\n        var _encryptionHandler;\r\n        var _packageFullPath;\r\n        var _packageDom;\r\n        var _packageDomInitializationDeferred;\r\n        var _publicationResourcesCache = new ResourceCache(sourceWindow, cacheSizeEvictThreshold);\r\n\r\n        var _contentDocumentTextPreprocessor = contentDocumentTextPreprocessor;\r\n\r\n        this.markupParser = new MarkupParser();\r\n\r\n        this.initialize =  function(callback) {\r\n\r\n            var isEpubExploded = isExploded();\r\n\r\n            // Non exploded EPUBs (i.e. zipped .epub documents) should be fetched in a programmatical manner:\r\n            _shouldConstructDomProgrammatically = !isEpubExploded;\r\n            createResourceFetcher(isEpubExploded, callback);\r\n        };\r\n\r\n\r\n\r\n        // INTERNAL FUNCTIONS\r\n\r\n        function _handleError(err) {\r\n            if (err) {\r\n                if (err.message) {\r\n                    console.error(err.message);\r\n                }\r\n                if (err.stack) {\r\n                    console.error(err.stack);\r\n                }\r\n            }\r\n            console.error(err);\r\n        }\r\n\r\n        function isExploded() {\r\n\r\n            var ext = \".epub\";\r\n            return bookRoot.indexOf(ext, bookRoot.length - ext.length) === -1;\r\n        }\r\n\r\n        function createResourceFetcher(isExploded, callback) {\r\n            if (isExploded) {\r\n                console.log('using new PlainResourceFetcher');\r\n                _resourceFetcher = new PlainResourceFetcher(self, bookRoot);\r\n                _resourceFetcher.initialize(function () {\r\n                    callback(_resourceFetcher);\r\n                });\r\n                return;\r\n            } else {\r\n                console.log('using new ZipResourceFetcher');\r\n                _resourceFetcher = new ZipResourceFetcher(self, bookRoot, jsLibRoot);\r\n                callback(_resourceFetcher);\r\n            }\r\n        }\r\n\r\n        // PUBLIC API\r\n\r\n        /**\r\n         * Determine whether the documents fetched using this fetcher require special programmatic handling.\r\n         * (resolving of internal resource references).\r\n         * @returns {*} true if documents fetched using this fetcher require special programmatic handling\r\n         * (resolving of internal resource references). Typically needed for zipped EPUBs or exploded EPUBs that contain\r\n         * encrypted resources specified in META-INF/encryption.xml.\r\n         *\r\n         * false if documents can be fed directly into a window or iframe by src URL without using special fetching logic.\r\n         */\r\n        this.shouldConstructDomProgrammatically = function (){\r\n            return _shouldConstructDomProgrammatically;\r\n        };\r\n\r\n        /**\r\n         * Determine whether the media assets (audio, video, images) within content documents require special\r\n         * programmatic handling.\r\n         * @returns {*} true if content documents fetched using this fetcher require programmatic fetching\r\n         * of media assets. Typically needed for zipped EPUBs.\r\n         *\r\n         * false if paths to media assets are accessible directly for the browser through their paths relative to\r\n         * the base URI of their content document.\r\n         */\r\n        this.shouldFetchMediaAssetsProgrammatically = function() {\r\n            return _shouldConstructDomProgrammatically && !isExploded();\r\n        };\r\n\r\n        this.getBookRoot = function() {\r\n            return bookRoot;\r\n        };\r\n\r\n        this.getJsLibRoot = function() {\r\n            return jsLibRoot;\r\n        };\r\n\r\n        this.flushCache = function() {\r\n            _publicationResourcesCache.flushCache();\r\n        };\r\n\r\n        this.getPackageUrl = function() {\r\n            return _resourceFetcher.getPackageUrl();\r\n        };\r\n\r\n        this.fetchContentDocument = function (attachedData, loadedDocumentUri, contentDocumentResolvedCallback, errorCallback) {\r\n\r\n            // Resources loaded for previously fetched document no longer need to be pinned:\r\n            _publicationResourcesCache.unPinResources();\r\n            var contentDocumentFetcher = new ContentDocumentFetcher(self, attachedData.spineItem, loadedDocumentUri, _publicationResourcesCache, _contentDocumentTextPreprocessor);\r\n            contentDocumentFetcher.fetchContentDocumentAndResolveDom(contentDocumentResolvedCallback, function (err) {\r\n                _handleError(err);\r\n                errorCallback(err);\r\n            });\r\n        };\r\n\r\n        this.getFileContentsFromPackage = function(filePathRelativeToPackageRoot, callback, onerror) {\r\n\r\n            _resourceFetcher.fetchFileContentsText(filePathRelativeToPackageRoot, function (fileContents) {\r\n                callback(fileContents);\r\n            }, onerror);\r\n        };\r\n\r\n\r\n\r\n        this.getXmlFileDom = function (xmlFilePathRelativeToPackageRoot, callback, onerror) {\r\n            self.getFileContentsFromPackage(xmlFilePathRelativeToPackageRoot, function (xmlFileContents) {\r\n                var fileDom = self.markupParser.parseXml(xmlFileContents);\r\n                callback(fileDom);\r\n            }, onerror);\r\n        };\r\n\r\n        this.getPackageFullPath = function(callback, onerror) {\r\n            self.getXmlFileDom('META-INF/container.xml', function (containerXmlDom) {\r\n                var packageFullPath = self.getRootFile(containerXmlDom);\r\n                callback(packageFullPath);\r\n            }, onerror);\r\n        };\r\n\r\n        this.getRootFile = function(containerXmlDom) {\r\n            var rootFile = $('rootfile', containerXmlDom);\r\n            var packageFullPath = rootFile.attr('full-path');\r\n            return packageFullPath;\r\n        };\r\n\r\n        this.getPackageDom = function (callback, onerror) {\r\n            if (_packageDom) {\r\n                callback(_packageDom);\r\n            } else {\r\n                // TODO: use jQuery's Deferred\r\n                // Register all callbacks interested in initialized packageDom, launch its instantiation only once\r\n                // and broadcast to all callbacks registered during the initialization once it's done:\r\n                if (_packageDomInitializationDeferred) {\r\n                    _packageDomInitializationDeferred.done(callback);\r\n                } else {\r\n                    _packageDomInitializationDeferred = $.Deferred();\r\n                    _packageDomInitializationDeferred.done(callback);\r\n                    self.getPackageFullPath(function (packageFullPath) {\r\n                        _packageFullPath = packageFullPath;\r\n                        self.getXmlFileDom(packageFullPath, function (packageDom) {\r\n                            _packageDom = packageDom;\r\n                            _packageDomInitializationDeferred.resolve(packageDom);\r\n                            _packageDomInitializationDeferred = undefined;\r\n                        })\r\n                    }, onerror);\r\n                }\r\n            }\r\n        };\r\n\r\n        this.convertPathRelativeToPackageToRelativeToBase = function (relativeToPackagePath) {\r\n            return new URI(relativeToPackagePath).absoluteTo(_packageFullPath).toString();\r\n        };\r\n\r\n        this.relativeToPackageFetchFileContents = function(relativeToPackagePath, fetchMode, fetchCallback, onerror) {\r\n\r\n            if (! onerror) {\r\n                onerror = _handleError;\r\n            }\r\n\r\n            var pathRelativeToEpubRoot = decodeURIComponent(self.convertPathRelativeToPackageToRelativeToBase(relativeToPackagePath));\r\n            // In case we received an absolute path, convert it to relative form or the fetch will fail:\r\n            if (pathRelativeToEpubRoot.charAt(0) === '/') {\r\n                pathRelativeToEpubRoot = pathRelativeToEpubRoot.substr(1);\r\n            }\r\n            var fetchFunction = _resourceFetcher.fetchFileContentsText;\r\n            if (fetchMode === 'blob') {\r\n                fetchFunction = _resourceFetcher.fetchFileContentsBlob;\r\n            } else if (fetchMode === 'data64uri') {\r\n                fetchFunction = _resourceFetcher.fetchFileContentsData64Uri;\r\n            }\r\n            fetchFunction.call(_resourceFetcher, pathRelativeToEpubRoot, fetchCallback, onerror);\r\n        };\r\n\r\n\r\n\r\n        this.getRelativeXmlFileDom = function (filePath, callback, errorCallback) {\r\n            self.getXmlFileDom(self.convertPathRelativeToPackageToRelativeToBase(filePath), callback, errorCallback);\r\n        };\r\n\r\n        function readEncriptionData(callback) {\r\n            self.getXmlFileDom('META-INF/encryption.xml', function (encryptionDom, error) {\r\n\r\n                if(error) {\r\n                    console.log(error);\r\n                    console.log(\"Document doesn't make use of encryption.\");\r\n                    _encryptionHandler = new EncryptionHandler(undefined);\r\n                    callback();\r\n                }\r\n                else {\r\n\r\n                    var encryptions = [];\r\n\r\n\r\n                    var encryptedData = $('EncryptedData', encryptionDom);\r\n                    encryptedData.each(function (index, encryptedData) {\r\n                        var encryptionAlgorithm = $('EncryptionMethod', encryptedData).first().attr('Algorithm');\r\n\r\n                        encryptions.push({algorithm: encryptionAlgorithm});\r\n\r\n                        // For some reason, jQuery selector \"\" against XML DOM sometimes doesn't match properly\r\n                        var cipherReference = $('CipherReference', encryptedData);\r\n                        cipherReference.each(function (index, CipherReference) {\r\n                            var cipherReferenceURI = $(CipherReference).attr('URI');\r\n                            console.log('Encryption/obfuscation algorithm ' + encryptionAlgorithm + ' specified for ' +\r\n                                cipherReferenceURI);\r\n                            encryptions[cipherReferenceURI] = encryptionAlgorithm;\r\n                        });\r\n                    });\r\n                }\r\n\r\n            });\r\n        }\r\n\r\n        // Currently needed for deobfuscating fonts\r\n        this.setPackageMetadata = function(packageMetadata, settingFinishedCallback) {\r\n\r\n            self.getXmlFileDom('META-INF/encryption.xml', function (encryptionDom) {\r\n\r\n                var encryptionData = EncryptionHandler.CreateEncryptionData(packageMetadata.id, encryptionDom);\r\n\r\n                _encryptionHandler = new EncryptionHandler(encryptionData);\r\n\r\n                if (_encryptionHandler.isEncryptionSpecified()) {\r\n                    // EPUBs that use encryption for any resources should be fetched in a programmatical manner:\r\n                    _shouldConstructDomProgrammatically = true;\r\n                }\r\n\r\n                settingFinishedCallback();\r\n\r\n\r\n            }, function(error){\r\n\r\n                console.log(\"Document doesn't make use of encryption.\");\r\n                _encryptionHandler = new EncryptionHandler(undefined);\r\n\r\n                settingFinishedCallback();\r\n            });\r\n        };\r\n\r\n        this.getDecryptionFunctionForRelativePath = function(pathRelativeToRoot) {\r\n            return _encryptionHandler.getDecryptionFunctionForRelativePath(pathRelativeToRoot);\r\n        }\r\n    };\r\n\r\n    return PublicationFetcher\r\n\r\n});\r\n\ndefine('epub-fetch', ['epub-fetch/publication_fetcher'], function (main) { return main; });\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-model/package_document',['jquery', 'underscore', 'URIjs'],\r\n    function ($, _, URI) {\r\n\r\n    // Description: This model provides an interface for navigating an EPUB's package document\r\n    var PackageDocument = function(packageDocumentURL, resourceFetcher, metadata, spine, manifest) {\r\n\r\n        var _page_prog_dir;\r\n\r\n        this.manifest = manifest;\r\n\r\n        this.getSharedJsPackageData = function () {\r\n\r\n            var packageDocRoot = packageDocumentURL.substr(0, packageDocumentURL.lastIndexOf(\"/\"));\r\n            return {\r\n                rootUrl : packageDocRoot,\r\n                rendition_viewport : metadata.rendition_viewport,\r\n                rendition_layout : metadata.rendition_layout,\r\n                rendition_orientation : metadata.rendition_orientation,\r\n                rendition_flow : metadata.rendition_flow,\r\n                rendition_spread : metadata.rendition_spread,\r\n                media_overlay : metadata.media_overlay,\r\n                spine : {\r\n                    direction : this.getPageProgressionDirection(),\r\n                    items : spine\r\n                }\r\n            };\r\n        };\r\n\r\n        /**\r\n         * Get spine item data in readium-shared-js accepted format.\r\n         * @param spineIndex the index of the item within the spine\r\n         * @returns Spine item data in readium-shared-js accepted format.\r\n         */\r\n        this.getSpineItem = function(spineIndex) {\r\n            var spineItem = spine[spineIndex];\r\n            return spineItem;\r\n        };\r\n\r\n        this.setPageProgressionDirection = function(page_prog_dir) {\r\n            _page_prog_dir = page_prog_dir;\r\n        };\r\n\r\n\r\n        this.getPageProgressionDirection = function() {\r\n            if (_page_prog_dir === \"rtl\") {\r\n                return \"rtl\";\r\n            }\r\n            else if (_page_prog_dir === \"default\") {\r\n                return \"default\";\r\n            }\r\n            else {\r\n                return \"ltr\";\r\n            }\r\n        };\r\n\r\n        this.spineLength = function() {\r\n            return spine.length;\r\n        };\r\n\r\n        this.getMetadata = function() {\r\n            return metadata;\r\n        };\r\n\r\n        this.getToc = function() {\r\n            var item = getTocItem();\r\n            if (item) {\r\n                return item.href;\r\n            }\r\n            return null;\r\n        };\r\n\r\n        this.getTocText = function(callback) {\r\n            var toc = this.getToc();\r\n\r\n            resourceFetcher.relativeToPackageFetchFileContents(toc, 'text', function (tocDocumentText) {\r\n                callback(tocDocumentText)\r\n            }, function (err) {\r\n                console.error('ERROR fetching TOC from [' + toc + ']:');\r\n                console.error(err);\r\n                callback(undefined);\r\n            });\r\n        };\r\n\r\n        this.getTocDom = function(callback) {\r\n\r\n            this.getTocText(function (tocText) {\r\n                if (typeof tocText === 'string') {\r\n                    var tocDom = (new DOMParser()).parseFromString(tocText, \"text/xml\");\r\n                    callback(tocDom);\r\n                } else {\r\n                    callback(undefined);\r\n                }\r\n            });\r\n        };\r\n\r\n\r\n        // Used in EpubReader (readium-js-viewer)\r\n        // https://github.com/readium/readium-js-viewer/blob/develop/lib/EpubReader.js#L59\r\n        this.generateTocListDOM = function(callback) {\r\n            var that = this;\r\n            this.getTocDom(function (tocDom) {\r\n                if (tocDom) {\r\n                    if (tocIsNcx()) {\r\n                        var $ncxOrderedList;\r\n                        $ncxOrderedList = getNcxOrderedList($(\"navMap\", tocDom));\r\n                        callback($ncxOrderedList[0]);\r\n                    } else {\r\n                        var packageDocumentAbsoluteURL = new URI(packageDocumentURL).absoluteTo(document.URL);\r\n                        var tocDocumentAbsoluteURL = new URI(that.getToc()).absoluteTo(packageDocumentAbsoluteURL);\r\n                        // add a BASE tag to change the TOC document's baseURI.\r\n                        var oldBaseTag = $(tocDom).remove('base');\r\n                        var newBaseTag = $('<base></base>');\r\n                        $(newBaseTag).attr('href', tocDocumentAbsoluteURL);\r\n                        $(tocDom).find('head').append(newBaseTag);\r\n                        // TODO: fix TOC hrefs both for exploded in zipped EPUBs\r\n                        callback(tocDom);\r\n                    }\r\n                } else {\r\n                    callback(undefined);\r\n                }\r\n            });\r\n        };\r\n\r\n        function tocIsNcx() {\r\n\r\n            var tocItem = getTocItem();\r\n            var contentDocURI = tocItem.href;\r\n            var fileExtension = contentDocURI.substr(contentDocURI.lastIndexOf('.') + 1);\r\n\r\n            return fileExtension.trim().toLowerCase() === \"ncx\";\r\n        }\r\n\r\n        // ----------------------- PRIVATE HELPERS -------------------------------- //\r\n\r\n        function getNcxOrderedList($navMapDOM) {\r\n\r\n            var $ol = $(\"<ol></ol>\");\r\n            $.each($navMapDOM.children(\"navPoint\"), function (index, navPoint) {\r\n                addNavPointElements($(navPoint), $ol);\r\n            });\r\n            return $ol;\r\n        }\r\n\r\n        // Description: Constructs an html representation of NCX navPoints, based on an object of navPoint information\r\n        // Rationale: This is a recursive method, as NCX navPoint elements can nest 0 or more of themselves as children\r\n        function addNavPointElements($navPointDOM, $ol) {\r\n\r\n            // Add the current navPoint element to the TOC html\r\n            var navText = $navPointDOM.children(\"navLabel\").text().trim();\r\n            var navHref = $navPointDOM.children(\"content\").attr(\"src\");\r\n            var $navPointLi = $('<li class=\"nav-elem\"></li>').append(\r\n                $('<a></a>', { href: navHref, text: navText })\r\n            );\r\n\r\n            // Append nav point info\r\n            $ol.append($navPointLi);\r\n\r\n            // Append ordered list of nav points\r\n            if ($navPointDOM.children(\"navPoint\").length > 0 ) {\r\n\r\n                var $newLi = $(\"<li></li>\");\r\n                var $newOl = $(\"<ol></ol>\");\r\n                $.each($navPointDOM.children(\"navPoint\"), function (navIndex, navPoint) {\r\n                    $newOl.append(addNavPointElements($(navPoint), $newOl));\r\n                });\r\n\r\n                $newLi.append($newOl);\r\n                $ol.append($newLi);\r\n            }\r\n        }\r\n\r\n        function getTocItem(){\r\n\r\n            var item = manifest.getNavItem();\r\n            if (item) {\r\n                return item;\r\n            }\r\n\r\n            var spine_id = metadata.ncx;\r\n            if (spine_id && spine_id.length > 0) {\r\n                return manifest.getManifestItemByIdref(spine_id);\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n    };\r\n\r\n    return PackageDocument;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-model/smil_document_parser',['jquery', 'underscore'], function ($, _) {\r\n\r\n    // `SmilDocumentParser` is used to parse the xml of an epub package\r\n    // document and build a javascript object. The constructor accepts an\r\n    // instance of `URI` that is used to resolve paths during the process\r\n    var SmilDocumentParser = function(packageDocument, publicationFetcher) {\r\n\r\n        // Parse a media overlay manifest item XML\r\n        this.parse = function(spineItem, manifestItemSMIL, smilJson, deferred, callback, errorCallback) {\r\n            var that = this;\r\n            publicationFetcher.getRelativeXmlFileDom(manifestItemSMIL.href, function(xmlDom) {\r\n\r\n                var smil = $(\"smil\", xmlDom)[0];\r\n                smilJson.smilVersion = smil.getAttribute('version');\r\n\r\n                //var body = $(\"body\", xmlDom)[0];\r\n                smilJson.children = that.getChildren(smil);\r\n                smilJson.href = manifestItemSMIL.href;\r\n                smilJson.id = manifestItemSMIL.id;\r\n                smilJson.spineItemId = spineItem.idref;\r\n\r\n                var mediaItem = packageDocument.getMetadata().getMediaItemByRefinesId(manifestItemSMIL.id);\r\n                if (mediaItem) {\r\n                    smilJson.duration = mediaItem.duration;\r\n                }\r\n\r\n                callback(deferred, smilJson);\r\n            }, function(fetchError) {\r\n                errorCallback(deferred, fetchError);\r\n            });\r\n        };\r\n\r\n        var safeCopyProperty = function(property, fromNode, toItem, isRequired, defaultValue) {\r\n            var propParse = property.split(':');\r\n            var destProperty = propParse[propParse.length - 1];\r\n\r\n            if (destProperty === \"type\") {\r\n                destProperty = \"epubtype\";\r\n            }\r\n            \r\n            if (fromNode.getAttribute(property) != undefined) {\r\n                toItem[destProperty] = fromNode.getAttribute(property);\r\n            } else if (isRequired) {\r\n                if (defaultValue !== undefined) {\r\n                    toItem[destProperty] = defaultValue;\r\n                } else {\r\n                    console.log(\"Required property \" + property + \" not found in smil node \" + fromNode.nodeName);\r\n                }\r\n            }\r\n        };\r\n\r\n        this.getChildren = function(element) {\r\n            var that = this;\r\n            var children = [];\r\n\r\n            $.each(element.childNodes, function(elementIndex, currElement) {\r\n\r\n                if (currElement.nodeType === 1) { // ELEMENT\r\n                    var item = that.createItemFromElement(currElement);\r\n                    if (item) {\r\n                        children.push(item);\r\n                    }\r\n                }\r\n            });\r\n\r\n            return children;\r\n        }\r\n\r\n        this.createItemFromElement = function(element) {\r\n            var that = this;\r\n\r\n            var item = {};\r\n            item.nodeType = element.nodeName;\r\n            \r\n            var isBody = false;\r\n            if (item.nodeType === \"body\")\r\n            {\r\n                isBody = true;\r\n                item.nodeType = \"seq\";\r\n            }\r\n\r\n            if (item.nodeType === \"seq\") {\r\n\r\n                safeCopyProperty(\"epub:textref\", element, item, !isBody);\r\n                safeCopyProperty(\"id\", element, item);\r\n                safeCopyProperty(\"epub:type\", element, item);\r\n\r\n                item.children = that.getChildren(element);\r\n\r\n            } else if (item.nodeType === \"par\") {\r\n\r\n                safeCopyProperty(\"id\", element, item);\r\n                safeCopyProperty(\"epub:type\", element, item);\r\n\r\n                item.children = that.getChildren(element);\r\n\r\n            } else if (item.nodeType === \"text\") {\r\n\r\n                safeCopyProperty(\"src\", element, item, true);\r\n                var srcParts = item.src.split('#');\r\n                item.srcFile = srcParts[0];\r\n                item.srcFragmentId = (srcParts.length === 2) ? srcParts[1] : \"\";\r\n                safeCopyProperty(\"id\", element, item);\r\n                // safeCopyProperty(\"epub:textref\", element, item);\r\n\r\n            } else if (item.nodeType === \"audio\") {\r\n                safeCopyProperty(\"src\", element, item, true);\r\n                safeCopyProperty(\"id\", element, item);\r\n                item.clipBegin = SmilDocumentParser.resolveClockValue(element.getAttribute(\"clipBegin\"));\r\n                item.clipEnd = SmilDocumentParser.resolveClockValue(element.getAttribute(\"clipEnd\"));\r\n            }\r\n            else\r\n            {\r\n                return undefined;\r\n            }\r\n\r\n            return item;\r\n        }\r\n\r\n        function makeFakeSmilJson(spineItem) {\r\n            return {\r\n                id: \"\",\r\n                href: \"\",\r\n                spineItemId: spineItem.idref,\r\n                children: [{\r\n                    nodeType: 'seq',\r\n                    textref: spineItem.href,\r\n                    children: [{\r\n                        nodeType: 'par',\r\n                        children: [{\r\n                            nodeType: 'text',\r\n                            src: spineItem.href,\r\n                            srcFile: spineItem.href,\r\n                            srcFragmentId: \"\"\r\n                        }]\r\n                    }]\r\n                }]\r\n            };\r\n        }\r\n\r\n        this.fillSmilData = function(callback) {\r\n            var that = this;\r\n\r\n            if (packageDocument.spineLength() <= 0) {\r\n                callback();\r\n                return;\r\n            }\r\n\r\n            var allFakeSmil = true;\r\n            var mo_map = [];\r\n            var parsingDeferreds = [];\r\n\r\n            for (var spineIdx = 0; spineIdx < packageDocument.spineLength(); spineIdx++) {\r\n                var spineItem = packageDocument.getSpineItem(spineIdx);\r\n\r\n                if (spineItem.media_overlay_id) {\r\n                    var manifestItemSMIL = packageDocument.manifest.getManifestItemByIdref(spineItem.media_overlay_id);\r\n\r\n                    if (!manifestItemSMIL) {\r\n                        console.error(\"Cannot find SMIL manifest item for spine/manifest item?! \" + spineItem.media_overlay_id);\r\n                        continue;\r\n                    }\r\n                    //ASSERT manifestItemSMIL.media_type === \"application/smil+xml\"\r\n\r\n                    var parsingDeferred = $.Deferred();\r\n                    parsingDeferred.media_overlay_id = spineItem.media_overlay_id;\r\n                    parsingDeferreds.push(parsingDeferred);\r\n                    var smilJson = {};\r\n\r\n                    // Push the holder object onto the map early so that order isn't disturbed by asynchronicity:\r\n                    mo_map.push(smilJson);\r\n\r\n                    // The local parsingDeferred variable will have its value replaced on next loop iteration.\r\n                    // Must pass the parsingDeferred through async calls as an argument and it arrives back as myDeferred.\r\n                    that.parse(spineItem, manifestItemSMIL, smilJson, parsingDeferred, function(myDeferred, smilJson) {\r\n                        allFakeSmil = false;\r\n                        myDeferred.resolve();\r\n                    }, function(myDeferred, parseError) {\r\n                        console.log('Error when parsing SMIL manifest item ' + manifestItemSMIL.href + ':');\r\n                        console.log(parseError);\r\n                        myDeferred.resolve();\r\n                    });\r\n                } else {\r\n                    mo_map.push(makeFakeSmilJson(spineItem));\r\n                }\r\n            }\r\n\r\n            $.when.apply($, parsingDeferreds).done(function() {\r\n                packageDocument.getMetadata().setMoMap(mo_map);\r\n                if (allFakeSmil) {\r\n                    console.log(\"No Media Overlays\");\r\n                    packageDocument.getMetadata().setMoMap([]);\r\n                }\r\n                callback();\r\n            });\r\n        }\r\n    };\r\n\r\n    // parse the timestamp and return the value in seconds\r\n    // supports this syntax:\r\n    // http://idpf.org/epub/30/spec/epub30-mediaoverlays.html#app-clock-examples\r\n    SmilDocumentParser.resolveClockValue = function(value) {\r\n        if (!value) return 0;\r\n\r\n        var hours = 0;\r\n        var mins = 0;\r\n        var secs = 0;\r\n\r\n        if (value.indexOf(\"min\") != -1) {\r\n            mins = parseFloat(value.substr(0, value.indexOf(\"min\")));\r\n        } else if (value.indexOf(\"ms\") != -1) {\r\n            var ms = parseFloat(value.substr(0, value.indexOf(\"ms\")));\r\n            secs = ms / 1000;\r\n        } else if (value.indexOf(\"s\") != -1) {\r\n            secs = parseFloat(value.substr(0, value.indexOf(\"s\")));\r\n        } else if (value.indexOf(\"h\") != -1) {\r\n            hours = parseFloat(value.substr(0, value.indexOf(\"h\")));\r\n        } else {\r\n            // parse as hh:mm:ss.fraction\r\n            // this also works for seconds-only, e.g. 12.345\r\n            var arr = value.split(\":\");\r\n            secs = parseFloat(arr.pop());\r\n            if (arr.length > 0) {\r\n                mins = parseFloat(arr.pop());\r\n                if (arr.length > 0) {\r\n                    hours = parseFloat(arr.pop());\r\n                }\r\n            }\r\n        }\r\n        var total = hours * 3600 + mins * 60 + secs;\r\n        return total;\r\n    }\r\n    \r\n    return SmilDocumentParser;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-model/metadata',['underscore'],\r\n    function (_) {\r\n\r\n        var Metadata = function () {\r\n\r\n            var that = this;\r\n\r\n            var _mediaItemIndexByRefinesId = {};\r\n\r\n            /**\r\n             * Iterate over media items and apply callback (synchronously) on each one of them.\r\n             * @param iteratorCallback the iterator callback function, will be called once for each media item,\r\n             * and the item will be passed as the (one and only) argument.\r\n             * @returns the Metadata object for chaining.\r\n             */\r\n            this.eachMediaItem = function(iteratorCallback) {\r\n                if (that.mediaItems) {\r\n                    _.each(that.mediaItems, iteratorCallback);\r\n                }\r\n                return this;\r\n            };\r\n\r\n            this.getMediaItemByRefinesId = function(id) {\r\n                return _mediaItemIndexByRefinesId[id];\r\n            };\r\n\r\n            this.setMoMap = function(mediaOverlaysMap) {\r\n                that.media_overlay.smil_models = mediaOverlaysMap;\r\n            };\r\n\r\n            // Initialize indexes\r\n            this.eachMediaItem(function(item) {\r\n                var id = item.refines;\r\n                var hash = id.indexOf('#');\r\n                if (hash >= 0) {\r\n                    var start = hash+1;\r\n                    var end = id.length-1;\r\n                    id = id.substr(start, end);\r\n                }\r\n                id = id.trim();\r\n\r\n                _mediaItemIndexByRefinesId[id] = item;\r\n            });\r\n\r\n\r\n        };\r\n        return Metadata;\r\n    });\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-model/manifest',['underscore'],\r\n    function (_) {\r\n\r\n        var Manifest = function (manifestJson) {\r\n\r\n            var _manifestIndexById = {};\r\n            var _navItem;\r\n\r\n            this.manifestLength = function() {\r\n                return manifestJson.length;\r\n            };\r\n\r\n            this.getManifestItemByIdref = function (idref) {\r\n                return _manifestIndexById[idref];\r\n            };\r\n\r\n            /**\r\n             * Iterate over manifest items and apply callback (synchronously) on each one of them.\r\n             * @param iteratorCallback the iterator callback function, will be called once for each manifest item,\r\n             * and the item will be passed as the (one and only) argument.\r\n             * @returns the Manifest object for chaining.\r\n             */\r\n            this.each = function(iteratorCallback) {\r\n                _.each(manifestJson, iteratorCallback);\r\n                return this;\r\n            };\r\n\r\n            this.getNavItem = function () {\r\n                return _navItem;\r\n            };\r\n\r\n            // Initialize indexes\r\n            this.each(function(manifestItem) {\r\n                _manifestIndexById[manifestItem.id] = manifestItem;\r\n\r\n                if (manifestItem.properties && manifestItem.properties.indexOf(\"nav\") !== -1) {\r\n                    _navItem = manifestItem;\r\n                }\r\n            });\r\n\r\n        };\r\n        return Manifest;\r\n    });\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-model/package_document_parser',['jquery', 'underscore', 'epub-fetch/markup_parser', 'URIjs', './package_document',\r\n        './smil_document_parser', './metadata', './manifest'],\r\n    function($, _, MarkupParser, URI, PackageDocument, SmilDocumentParser, Metadata,\r\n             Manifest) {\r\n\r\n        // `PackageDocumentParser` is used to parse the xml of an epub package\r\n    // document and build a javascript object. The constructor accepts an\r\n    // instance of `URI` that is used to resolve paths during the process\r\n    var PackageDocumentParser = function(bookRoot, publicationFetcher) {\r\n\r\n        var _packageFetcher = publicationFetcher;\r\n        var _deferredXmlDom = $.Deferred();\r\n        var _xmlDom;\r\n\r\n        function onError(error) {\r\n            if (error) {\r\n                if (error.message) {\r\n                    console.error(error.message);\r\n                }\r\n                if (error.stack) {\r\n                    console.error(error.stack);\r\n                }\r\n            }\r\n        }\r\n\r\n        publicationFetcher.getPackageDom(function(packageDom){\r\n            _xmlDom = packageDom;\r\n            _deferredXmlDom.resolve(packageDom);\r\n        }, onError);\r\n\r\n        function fillSmilData(packageDocument, callback) {\r\n\r\n            var smilParser = new SmilDocumentParser(packageDocument, publicationFetcher);\r\n\r\n            smilParser.fillSmilData(function() {\r\n\r\n                // return the parse result\r\n                callback(packageDocument);\r\n            });\r\n\r\n        }\r\n\r\n        // Parse an XML package document into a javascript object\r\n        this.parse = function(callback) {\r\n\r\n            _deferredXmlDom.done(function (xmlDom) {\r\n                var metadata = getMetadata(xmlDom);\r\n\r\n                var spineElem = xmlDom.getElementsByTagNameNS(\"*\", \"spine\")[0];\r\n                var page_prog_dir = getElemAttr(xmlDom, 'spine', \"page-progression-direction\");\r\n\r\n                // TODO: Bindings are unused\r\n                var bindings = getJsonBindings(xmlDom);\r\n\r\n                var manifest = new Manifest(getJsonManifest(xmlDom));\r\n                var spine = getJsonSpine(xmlDom, manifest, metadata);\r\n\r\n                // try to find a cover image\r\n                var cover = getCoverHref(xmlDom);\r\n                if (cover) {\r\n                    metadata.cover_href = cover;\r\n                }\r\n\r\n                $.when(updateMetadataWithIBookProperties(metadata)).then(function() {\r\n\r\n                    _packageFetcher.setPackageMetadata(metadata, function () {\r\n                        var packageDocument = new PackageDocument(publicationFetcher.getPackageUrl(),\r\n                            publicationFetcher, metadata, spine, manifest);\r\n\r\n                        packageDocument.setPageProgressionDirection(page_prog_dir);\r\n                        fillSmilData(packageDocument, callback);\r\n                    });\r\n                });\r\n\r\n            });\r\n        };\r\n\r\n        function updateMetadataWithIBookProperties(metadata) {\r\n\r\n            var dff = $.Deferred();\r\n\r\n            //if layout not set\r\n            if(!metadata.rendition_layout)\r\n            {\r\n                var pathToIBooksSpecificXml = \"/META-INF/com.apple.ibooks.display-options.xml\";\r\n\r\n                publicationFetcher.relativeToPackageFetchFileContents(pathToIBooksSpecificXml, 'text', function (ibookPropText) {\r\n                    if(ibookPropText) {\r\n                        var parser = new MarkupParser();\r\n                        var propModel = parser.parseXml(ibookPropText);\r\n                        var fixLayoutProp = $(\"option[name=fixed-layout]\", propModel)[0];\r\n                        if(fixLayoutProp) {\r\n                            var fixLayoutVal = $(fixLayoutProp).text();\r\n                            if(fixLayoutVal === \"true\") {\r\n                                metadata.rendition_layout = \"pre-paginated\";\r\n                                console.log(\"using com.apple.ibooks.display-options.xml fixed-layout property\");\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    dff.resolve();\r\n\r\n                }, function (err) {\r\n\r\n                    console.log(\"com.apple.ibooks.display-options.xml not found\");\r\n                    dff.resolve();\r\n                });\r\n            }\r\n            else {\r\n                dff.resolve();\r\n            }\r\n\r\n            return dff.promise();\r\n        }\r\n\r\n\r\n        function getJsonSpine(xmlDom, manifest, metadata) {\r\n\r\n            var $spineElements;\r\n            var jsonSpine = [];\r\n\r\n            $spineElements = $(findXmlElemByLocalNameAnyNS(xmlDom,\"spine\")).children();\r\n            $.each($spineElements, function (spineElementIndex, currSpineElement) {\r\n\r\n                var $currSpineElement = $(currSpineElement);\r\n                var idref = $currSpineElement.attr(\"idref\") ? $currSpineElement.attr(\"idref\") : \"\";\r\n                var manifestItem = manifest.getManifestItemByIdref(idref);\r\n\r\n                var id = $currSpineElement.attr(\"id\");\r\n                var viewport = undefined;\r\n                _.each(metadata.rendition_viewports, function(vp) {\r\n                    if (vp.refines == id) {\r\n                        viewport = vp.viewport;\r\n                        return true; // break\r\n                    }\r\n                });\r\n\r\n                var spineItem = {\r\n                    rendition_viewport: viewport,\r\n                    idref: idref,\r\n                    href: manifestItem.href,\r\n                    manifest_id: manifestItem.id,\r\n                    media_type: manifestItem.media_type,\r\n                    media_overlay_id: manifestItem.media_overlay_id,\r\n                    linear: $currSpineElement.attr(\"linear\") ? $currSpineElement.attr(\"linear\") : \"\",\r\n                    properties: $currSpineElement.attr(\"properties\") ? $currSpineElement.attr(\"properties\") : \"\"\r\n                };\r\n\r\n                var parsedProperties = parsePropertiesString(spineItem.properties);\r\n                _.extend(spineItem, parsedProperties);\r\n\r\n                jsonSpine.push(spineItem);\r\n            });\r\n\r\n            return jsonSpine;\r\n        }\r\n\r\n        function findXmlElemByLocalNameAnyNS(rootElement, localName, predicate) {\r\n            var elements = rootElement.getElementsByTagNameNS(\"*\", localName);\r\n            if (predicate) {\r\n                return _.find(elements, predicate);\r\n            } else {\r\n                return elements[0];\r\n            }\r\n        }\r\n\r\n        function filterXmlElemsByLocalNameAnyNS(rootElement, localName, predicate) {\r\n            var elements = rootElement.getElementsByTagNameNS(\"*\", localName);\r\n            return _.filter(elements, predicate);\r\n        }\r\n\r\n        function getElemText(rootElement, localName, predicate) {\r\n            var foundElement = findXmlElemByLocalNameAnyNS(rootElement, localName, predicate);\r\n            if (foundElement) {\r\n                return foundElement.textContent;\r\n            } else {\r\n                return '';\r\n            }\r\n        }\r\n\r\n        function getElemAttr(rootElement, localName, attrName, predicate) {\r\n            var foundElement = findXmlElemByLocalNameAnyNS(rootElement, localName, predicate);\r\n            if (foundElement) {\r\n                return foundElement.getAttribute(attrName);\r\n            } else {\r\n                return '';\r\n            }\r\n        }\r\n\r\n        function getMetaElemPropertyText(rootElement, attrPropertyValue) {\r\n\r\n            var foundElement = findXmlElemByLocalNameAnyNS(rootElement, \"meta\", function (element) {\r\n                return element.getAttribute(\"property\") === attrPropertyValue;\r\n            });\r\n\r\n            if (foundElement) {\r\n                return foundElement.textContent;\r\n            } else {\r\n                return '';\r\n            }\r\n        }\r\n\r\n\r\n        function getMetadata(xmlDom) {\r\n\r\n            var metadata = new Metadata();\r\n            var metadataElem = findXmlElemByLocalNameAnyNS(xmlDom, \"metadata\");\r\n            var packageElem = findXmlElemByLocalNameAnyNS(xmlDom, \"package\");\r\n            var spineElem = findXmlElemByLocalNameAnyNS(xmlDom, \"spine\");\r\n\r\n\r\n            metadata.author = getElemText(metadataElem, \"creator\");\r\n            metadata.description = getElemText(metadataElem, \"description\");\r\n            metadata.epub_version =\r\n                packageElem.getAttribute(\"version\") ? packageElem.getAttribute(\"version\") : \"\";\r\n            metadata.id = getElemText(metadataElem,\"identifier\");\r\n            metadata.language = getElemText(metadataElem, \"language\");\r\n            metadata.modified_date = getMetaElemPropertyText(metadataElem, \"dcterms:modified\");\r\n            metadata.ncx = spineElem.getAttribute(\"toc\") ? spineElem.getAttribute(\"toc\") : \"\";\r\n            metadata.pubdate = getElemText(metadataElem, \"date\");\r\n            metadata.publisher = getElemText(metadataElem, \"publisher\");\r\n            metadata.rights = getElemText(metadataElem, \"rights\");\r\n            metadata.title = getElemText(metadataElem, \"title\");\r\n\r\n            metadata.rendition_orientation = getMetaElemPropertyText(metadataElem, \"rendition:orientation\");\r\n            metadata.rendition_layout = getMetaElemPropertyText(metadataElem, \"rendition:layout\");\r\n            metadata.rendition_spread = getMetaElemPropertyText(metadataElem, \"rendition:spread\");\r\n            metadata.rendition_flow = getMetaElemPropertyText(metadataElem, \"rendition:flow\");\r\n\r\n\r\n\r\n\r\n\r\n\r\n            //http://www.idpf.org/epub/301/spec/epub-publications.html#fxl-property-viewport\r\n            \r\n            //metadata.rendition_viewport = getMetaElemPropertyText(metadataElem, \"rendition:viewport\");\r\n            metadata.rendition_viewport = getElemText(metadataElem, \"meta\", function (element) {\r\n                return element.getAttribute(\"property\") === \"rendition:viewport\" && !element.hasAttribute(\"refines\")\r\n            });\r\n\r\n            var viewports = [];\r\n            var viewportMetaElems = filterXmlElemsByLocalNameAnyNS(metadataElem, \"meta\", function (element) {\r\n                return element.getAttribute(\"property\") === \"rendition:viewport\" && element.hasAttribute(\"refines\");\r\n            });\r\n            _.each(viewportMetaElems, function(currItem) {\r\n                var id = currItem.getAttribute(\"refines\");\r\n                if (id) {\r\n                    var hash = id.indexOf('#');\r\n                    if (hash >= 0) {\r\n                        var start = hash+1;\r\n                        var end = id.length-1;\r\n                        id = id.substr(start, end);\r\n                    }\r\n                    id = id.trim();\r\n                }\r\n                \r\n                var vp = {\r\n                  refines: id,\r\n                  viewport: currItem.textContent\r\n                };\r\n                viewports.push(vp);\r\n            });\r\n            \r\n            metadata.rendition_viewports = viewports;\r\n\r\n            \r\n            \r\n            \r\n            \r\n            \r\n            // Media part\r\n            metadata.mediaItems = [];\r\n\r\n            var overlayElems = filterXmlElemsByLocalNameAnyNS(metadataElem, \"meta\", function (element) {\r\n                return element.getAttribute(\"property\") === \"media:duration\" && element.hasAttribute(\"refines\");\r\n            });\r\n\r\n            _.each(overlayElems, function(currItem) {\r\n                metadata.mediaItems.push({\r\n                  refines: currItem.getAttribute(\"refines\"),\r\n                  duration: SmilDocumentParser.resolveClockValue(currItem.textContent)\r\n               });\r\n            });\r\n\r\n            metadata.media_overlay = {\r\n                duration: SmilDocumentParser.resolveClockValue(\r\n                    getElemText(metadataElem, \"meta\", function (element) {\r\n                        return element.getAttribute(\"property\") === \"media:duration\" && !element.hasAttribute(\"refines\")\r\n                    })\r\n                ),\r\n                narrator: getMetaElemPropertyText(metadataElem, \"media:narrator\"),\r\n                activeClass: getMetaElemPropertyText(metadataElem, \"media:active-class\"),\r\n                playbackActiveClass: getMetaElemPropertyText(metadataElem, \"media:playback-active-class\"),\r\n                smil_models: [],\r\n                skippables: [\"sidebar\", \"practice\", \"marginalia\", \"annotation\", \"help\", \"note\", \"footnote\", \"rearnote\",\r\n                    \"table\", \"table-row\", \"table-cell\", \"list\", \"list-item\", \"pagebreak\"],\r\n                escapables: [\"sidebar\", \"bibliography\", \"toc\", \"loi\", \"appendix\", \"landmarks\", \"lot\", \"index\",\r\n                    \"colophon\", \"epigraph\", \"conclusion\", \"afterword\", \"warning\", \"epilogue\", \"foreword\",\r\n                    \"introduction\", \"prologue\", \"preface\", \"preamble\", \"notice\", \"errata\", \"copyright-page\",\r\n                    \"acknowledgments\", \"other-credits\", \"titlepage\", \"imprimatur\", \"contributors\", \"halftitlepage\",\r\n                    \"dedication\", \"help\", \"annotation\", \"marginalia\", \"practice\", \"note\", \"footnote\", \"rearnote\",\r\n                    \"footnotes\", \"rearnotes\", \"bridgehead\", \"page-list\", \"table\", \"table-row\", \"table-cell\", \"list\",\r\n                    \"list-item\", \"glossary\"]\r\n            };\r\n\r\n            return metadata;\r\n        }\r\n\r\n        function getJsonManifest(xmlDom) {\r\n\r\n            var $manifestItems = $(findXmlElemByLocalNameAnyNS(xmlDom, \"manifest\")).children();\r\n            var jsonManifest = [];\r\n\r\n            $.each($manifestItems, function (manifestElementIndex, currManifestElement) {\r\n\r\n                var $currManifestElement = $(currManifestElement);\r\n                var currManifestElementHref = $currManifestElement.attr(\"href\") ? $currManifestElement.attr(\"href\") :\r\n                    \"\";\r\n                var manifestItem = {\r\n\r\n                    href: currManifestElementHref,\r\n                    id: $currManifestElement.attr(\"id\") ? $currManifestElement.attr(\"id\") : \"\",\r\n                    media_overlay_id: $currManifestElement.attr(\"media-overlay\") ?\r\n                        $currManifestElement.attr(\"media-overlay\") : \"\",\r\n                    media_type: $currManifestElement.attr(\"media-type\") ? $currManifestElement.attr(\"media-type\") : \"\",\r\n                    properties: $currManifestElement.attr(\"properties\") ? $currManifestElement.attr(\"properties\") : \"\"\r\n                };\r\n                // console.log('pushing manifest item to JSON manifest. currManifestElementHref: [' + currManifestElementHref + \r\n                //     '], manifestItem.href: [' + manifestItem.href +\r\n                //     '], manifestItem:');\r\n                // console.log(manifestItem);\r\n                jsonManifest.push(manifestItem);\r\n            });\r\n\r\n            return jsonManifest;\r\n        }\r\n\r\n        function getJsonBindings(xmlDom) {\r\n\r\n            var $bindings = $(findXmlElemByLocalNameAnyNS(xmlDom, \"bindings\")).children();\r\n            var jsonBindings = [];\r\n\r\n            $.each($bindings, function (bindingElementIndex, currBindingElement) {\r\n\r\n                var $currBindingElement = $(currBindingElement);\r\n                var binding = {\r\n\r\n                    handler: $currBindingElement.attr(\"handler\") ? $currBindingElement.attr(\"handler\") : \"\",\r\n                    media_type: $currBindingElement.attr(\"media-type\") ? $currBindingElement.attr(\"media-type\") : \"\"\r\n                };\r\n\r\n                jsonBindings.push(binding);\r\n            });\r\n\r\n            return jsonBindings;\r\n        }\r\n\r\n        function getCoverHref(xmlDom) {\r\n\r\n            var manifest;\r\n            var $imageNode;\r\n            manifest = findXmlElemByLocalNameAnyNS(xmlDom, \"manifest\");\r\n\r\n            // epub3 spec for a cover image is like this:\r\n            /*<item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />*/\r\n            $imageNode = $(findXmlElemByLocalNameAnyNS(manifest, \"item\", function (element) {\r\n                var attr = element.getAttribute(\"properties\");\r\n                return attr && _.contains(attr.split(\" \"), \"cover-image\");\r\n            }));\r\n            if ($imageNode.length === 1 && $imageNode.attr(\"href\")) {\r\n                return $imageNode.attr(\"href\");\r\n            }\r\n\r\n            // some epub2's cover image is like this:\r\n            /*<meta name=\"cover\" content=\"cover-image-item-id\" />*/\r\n            var metaNode = $(findXmlElemByLocalNameAnyNS(xmlDom, \"meta\", function (element) {\r\n                return element.getAttribute(\"name\") === \"cover\";\r\n            }));\r\n            var contentAttr = metaNode.attr(\"content\");\r\n            if (metaNode.length === 1 && contentAttr) {\r\n                $imageNode = $(findXmlElemByLocalNameAnyNS(manifest, \"item\", function (element) {\r\n                    return element.getAttribute(\"id\") === contentAttr;\r\n                }));\r\n                if ($imageNode.length === 1 && $imageNode.attr(\"href\")) {\r\n                    return $imageNode.attr(\"href\");\r\n                }\r\n            }\r\n\r\n            // that didn't seem to work so, it think epub2 just uses item with id=cover\r\n            $imageNode = $(findXmlElemByLocalNameAnyNS(manifest, \"item\", function (element) {\r\n                return element.getAttribute(\"id\") === \"cover\";\r\n            }));\r\n            if ($imageNode.length === 1 && $imageNode.attr(\"href\")) {\r\n                return $imageNode.attr(\"href\");\r\n            }\r\n\r\n            // seems like there isn't one, thats ok...\r\n            return null;\r\n        }\r\n\r\n        function parsePropertiesString(str) {\r\n            var properties = {};\r\n            var allPropStrs = str.split(\" \"); // split it on white space\r\n            for (var i = 0; i < allPropStrs.length; i++) {\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_LANDSCAPE\r\n                if (allPropStrs[i] === \"rendition:orientation-landscape\") properties.rendition_orientation = \"landscape\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_PORTRAIT\r\n                if (allPropStrs[i] === \"rendition:orientation-portrait\") properties.rendition_orientation = \"portrait\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_ORIENTATION_AUTO\r\n                if (allPropStrs[i] === \"rendition:orientation-auto\") properties.rendition_orientation = \"auto\";\r\n\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_NONE\r\n                if (allPropStrs[i] === \"rendition:spread-none\") properties.rendition_spread = \"none\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_LANDSCAPE\r\n                if (allPropStrs[i] === \"rendition:spread-landscape\") properties.rendition_spread = \"landscape\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_PORTRAIT\r\n                if (allPropStrs[i] === \"rendition:spread-portrait\") properties.rendition_spread = \"portrait\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_BOTH\r\n                if (allPropStrs[i] === \"rendition:spread-both\") properties.rendition_spread = \"both\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_SPREAD_AUTO\r\n                if (allPropStrs[i] === \"rendition:spread-auto\") properties.rendition_spread = \"auto\";\r\n\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_FLOW_PAGINATED\r\n                if (allPropStrs[i] === \"rendition:flow-paginated\") properties.rendition_flow = \"paginated\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_CONTINUOUS\r\n                if (allPropStrs[i] === \"rendition:flow-scrolled-continuous\") properties.rendition_flow = \"scrolled-continuous\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_FLOW_SCROLLED_DOC\r\n                if (allPropStrs[i] === \"rendition:flow-scrolled-doc\") properties.rendition_flow = \"scrolled-doc\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_FLOW_AUTO\r\n                if (allPropStrs[i] === \"rendition:flow-auto\") properties.rendition_flow = \"auto\";\r\n\r\n\r\n\r\n                //ReadiumSDK.Models.SpineItem.SPREAD_CENTER\r\n                if (allPropStrs[i] === \"rendition:page-spread-center\") properties.page_spread = \"page-spread-center\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.SPREAD_LEFT\r\n                if (allPropStrs[i] === \"page-spread-left\") properties.page_spread = \"page-spread-left\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.SPREAD_RIGHT\r\n                if (allPropStrs[i] === \"page-spread-right\") properties.page_spread = \"page-spread-right\";\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_REFLOWABLE\r\n                if (allPropStrs[i] === \"rendition:layout-reflowable\") {\r\n                    properties.fixed_flow = false; // TODO: only used in spec tests!\r\n                    properties.rendition_layout = \"reflowable\";\r\n                }\r\n\r\n                //ReadiumSDK.Models.SpineItem.RENDITION_LAYOUT_PREPAGINATED\r\n                if (allPropStrs[i] === \"rendition:layout-pre-paginated\") {\r\n                    properties.fixed_flow = true; // TODO: only used in spec tests!\r\n                    properties.rendition_layout = \"pre-paginated\";\r\n                }\r\n            }\r\n            return properties;\r\n        }\r\n\r\n    };\r\n\r\n    return PackageDocumentParser;\r\n});\r\n\ndefine('epub-model', ['epub-model/package_document_parser'], function (main) { return main; });\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('epub-fetch/iframe_zip_loader',['URIjs', 'views/iframe_loader', 'underscore'], function(URI, IFrameLoader, _){\r\n\r\n    var zipIframeLoader = function( getCurrentResourceFetcher, contentDocumentTextPreprocessor) {\r\n\r\n        var basicIframeLoader = new IFrameLoader();\r\n\r\n        var self = this;\r\n        \r\n        var _contentDocumentTextPreprocessor = contentDocumentTextPreprocessor;\r\n\r\n        this.addIFrameEventListener = function (eventName, callback, context) {\r\n            basicIframeLoader.addIFrameEventListener(eventName, callback, context);\r\n        };\r\n\r\n        this.updateIframeEvents = function (iframe) {\r\n            basicIframeLoader.updateIframeEvents(iframe);\r\n        };\r\n        \r\n        this.loadIframe = function(iframe, src, callback, caller, attachedData) {\r\n\r\n            var loadedDocumentUri = new URI(src).absoluteTo(iframe.baseURI).search('').hash('').toString();\r\n\r\n            var shouldConstructDomProgrammatically = getCurrentResourceFetcher().shouldConstructDomProgrammatically();\r\n            if (shouldConstructDomProgrammatically) {\r\n\r\n                    getCurrentResourceFetcher().fetchContentDocument(attachedData, loadedDocumentUri,\r\n                        function (resolvedContentDocumentDom) {\r\n                            self._loadIframeWithDocument(iframe,\r\n                                attachedData,\r\n                                resolvedContentDocumentDom.documentElement.outerHTML,\r\n                                function () {\r\n                                    callback.call(caller, true, attachedData);\r\n                                });\r\n                        }, function (err) {\r\n                            callback.call(caller, false, attachedData);\r\n                        }\r\n                    );\r\n            } else {\r\n                fetchContentDocument(loadedDocumentUri, function (contentDocumentHtml) {\r\n                      if (!contentDocumentHtml) {\r\n                          //failed to load content document\r\n                          callback.call(caller, false, attachedData);\r\n                      } else {\r\n                          self._loadIframeWithDocument(iframe, attachedData, contentDocumentHtml, function () {\r\n                              callback.call(caller, true, attachedData);\r\n                          });\r\n                      }\r\n                });\r\n            }\r\n        };\r\n\r\n        this._loadIframeWithDocument = function (iframe, attachedData, contentDocumentData, callback) {\r\n\r\n            var isIE = (window.navigator.userAgent.indexOf(\"Trident\") > 0);\r\n            if (!isIE) {\r\n                var contentType = 'text/html';\r\n                if (attachedData.spineItem.media_type && attachedData.spineItem.media_type.length) {\r\n                    contentType = attachedData.spineItem.media_type;\r\n                }\r\n\r\n                var documentDataUri = window.URL.createObjectURL(\r\n                    new Blob([contentDocumentData], {'type': contentType})\r\n                );\r\n            } else {\r\n                // Internet Explorer doesn't handle loading documents from Blobs correctly.\r\n                // TODO: Currently using the document.write() approach only for IE, as it breaks CSS selectors\r\n                // with namespaces for some reason (e.g. the childrens-media-query sample EPUB)\r\n                iframe.contentWindow.document.open();\r\n                \r\n                // Currently not handled automatically by winstore-jscompat,\r\n                // so we're doing it manually. See:\r\n                // https://github.com/MSOpenTech/winstore-jscompat/\r\n                if (window.MSApp && window.MSApp.execUnsafeLocalFunction) {\r\n                    window.MSApp.execUnsafeLocalFunction(function() {\r\n                        iframe.contentWindow.document.write(contentDocumentData);\r\n                    });\r\n                } else {\r\n                    iframe.contentWindow.document.write(contentDocumentData);\r\n                }\r\n            }\r\n\r\n            iframe.onload = function () {\r\n\r\n                self.updateIframeEvents(iframe);\r\n\r\n                var mathJax = iframe.contentWindow.MathJax;\r\n                if (mathJax) {\r\n                    // If MathJax is being used, delay the callback until it has completed rendering\r\n                    var mathJaxCallback = _.once(callback);\r\n                    mathJax.Hub.Queue(mathJaxCallback);\r\n                    // Or at an 8 second timeout, which ever comes first\r\n                    // window.setTimeout(mathJaxCallback, 8000);\r\n                } else {\r\n                    callback();\r\n                }\r\n\r\n                if (!isIE) {\r\n                    window.URL.revokeObjectURL(documentDataUri);\r\n                }\r\n            };\r\n\r\n            if (!isIE) {\r\n                iframe.setAttribute(\"src\", documentDataUri);\r\n            } else {\r\n                iframe.contentWindow.document.close();\r\n            }\r\n        };\r\n\r\n        function fetchHtmlAsText(path, callback) {\r\n\r\n            $.ajax({\r\n                url: path,\r\n                dataType: 'html',\r\n                async: true,\r\n                success: function (result) {\r\n\r\n                    callback(result);\r\n                },\r\n                error: function (xhr, status, errorThrown) {\r\n                    console.error('Error when AJAX fetching ' + path);\r\n                    console.error(status);\r\n                    console.error(errorThrown);\r\n                    callback();\r\n                }\r\n            });\r\n        }\r\n\r\n        function fetchContentDocument(src, callback) {\r\n\r\n            fetchHtmlAsText(src, function (contentDocumentHtml) {\r\n\r\n                if (!contentDocumentHtml) {\r\n                    callback();\r\n                    return;\r\n                }\r\n\r\n                if (_contentDocumentTextPreprocessor) {\r\n                    contentDocumentHtml = _contentDocumentTextPreprocessor(src, contentDocumentHtml);\r\n                }\r\n\r\n                callback(contentDocumentHtml);\r\n            });\r\n        }\r\n    };\r\n\r\n    return zipIframeLoader;\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\n\r\ndefine('Readium',['text!version.json', 'jquery', 'underscore', 'views/reader_view', 'epub-fetch',\r\n        'epub-model/package_document_parser', 'epub-fetch/iframe_zip_loader', 'views/iframe_loader',\r\n        ],\r\n    function (versionText, $, _, ReaderView, PublicationFetcher,\r\n              PackageParser, IframeZipLoader, IframeLoader) {\r\n\r\n    var Readium = function(readiumOptions, readerOptions){\r\n\r\n        var _options = { mathJaxUrl: readerOptions.mathJaxUrl };\r\n\r\n        var _contentDocumentTextPreprocessor = function(src, contentDocumentHtml) {\r\n\r\n            function injectedScript() {\r\n\r\n                navigator.epubReadingSystem = window.parent.navigator.epubReadingSystem;\r\n                window.parent = window.self;\r\n                window.top = window.self;\r\n            }\r\n\r\n            var sourceParts = src.split(\"/\");\r\n            sourceParts.pop(); //remove source file name\r\n\r\n            var base = \"<base href=\\\"\" + sourceParts.join(\"/\") + \"/\" + \"\\\"/>\";\r\n\r\n            var scripts = \"<script type=\\\"text/javascript\\\">(\" + injectedScript.toString() + \")()<\\/script>\";\r\n            \r\n            if (_options && _options.mathJaxUrl && contentDocumentHtml.indexOf(\"<math\") >= 0) {\r\n                scripts += \"<script type=\\\"text/javascript\\\" src=\\\"\" + _options.mathJaxUrl + \"\\\"><\\/script>\";\r\n            }\r\n\r\n            return contentDocumentHtml.replace(/(<head.*?>)/, \"$1\" + base + scripts);\r\n        };\r\n        \r\n        var self = this;\r\n\r\n        var _currentPublicationFetcher;\r\n\r\n        var jsLibRoot = readiumOptions.jsLibRoot;\r\n\r\n        if (!readiumOptions.useSimpleLoader){\r\n            readerOptions.iframeLoader = new IframeZipLoader(function() { return _currentPublicationFetcher; }, _contentDocumentTextPreprocessor);\r\n        }\r\n        else{\r\n            readerOptions.iframeLoader = new IframeLoader();\r\n        }\r\n        \r\n\r\n        this.reader = new ReaderView(readerOptions);\r\n        ReadiumSDK.reader = this.reader;\r\n\r\n        this.openPackageDocument = function(bookRoot, callback, openPageRequest)  {\r\n            if (_currentPublicationFetcher) {\r\n                _currentPublicationFetcher.flushCache();\r\n            }\r\n\r\n            var cacheSizeEvictThreshold = null;\r\n            if (readiumOptions.cacheSizeEvictThreshold) {\r\n                cacheSizeEvictThreshold = readiumOptions.cacheSizeEvictThreshold;\r\n            }\r\n\r\n            _currentPublicationFetcher = new PublicationFetcher(bookRoot, jsLibRoot, window, cacheSizeEvictThreshold, _contentDocumentTextPreprocessor);\r\n\r\n            _currentPublicationFetcher.initialize(function() {\r\n\r\n                var _packageParser = new PackageParser(bookRoot, _currentPublicationFetcher);\r\n\r\n                _packageParser.parse(function(packageDocument){\r\n                    var openBookOptions = readiumOptions.openBookOptions || {};\r\n                    var openBookData = $.extend(packageDocument.getSharedJsPackageData(), openBookOptions);\r\n\r\n                    if (openPageRequest) {\r\n                        openBookData.openPageRequest = openPageRequest;\r\n                    }\r\n                    self.reader.openBook(openBookData);\r\n\r\n                    var options = {\r\n                        packageDocumentUrl : _currentPublicationFetcher.getPackageUrl(),\r\n                        metadata: packageDocument.getMetadata()\r\n                    };\r\n\r\n                    if (callback){\r\n                        // gives caller access to document metadata like the table of contents\r\n                        callback(packageDocument, options);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n\r\n        this.closePackageDocument = function() {\r\n            if (_currentPublicationFetcher) {\r\n                _currentPublicationFetcher.flushCache();\r\n            }\r\n        };\r\n\r\n        ReadiumSDK.emit(ReadiumSDK.Events.READER_INITIALIZED, ReadiumSDK.reader);\r\n    };\r\n    \r\n    Readium.version = JSON.parse(versionText);\r\n\r\n    return Readium;\r\n\r\n});\r\n\n",
    "//  Copyright (c) 2014 Readium Foundation and/or its licensees. All rights reserved.\r\n//  \r\n//  Redistribution and use in source and binary forms, with or without modification, \r\n//  are permitted provided that the following conditions are met:\r\n//  1. Redistributions of source code must retain the above copyright notice, this \r\n//  list of conditions and the following disclaimer.\r\n//  2. Redistributions in binary form must reproduce the above copyright notice, \r\n//  this list of conditions and the following disclaimer in the documentation and/or \r\n//  other materials provided with the distribution.\r\n//  3. Neither the name of the organization nor the names of its contributors may be \r\n//  used to endorse or promote products derived from this software without specific \r\n//  prior written permission.\r\n\r\ndefine('readium-js',['Readium'], function (Readium) {\r\n//noop\r\n});\r\n\n"
  ]
}